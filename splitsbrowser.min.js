/*!
 *  SplitsBrowser - Orienteering results analysis.
 *  
 *  Copyright (C) 2000-2020 Dave Ryder, Reinhard Balling, Andris Strazdins,
 *                          Ed Nash, Luke Woodward
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */
var SplitsBrowser={Version:"3.5.0",Model:{},Input:{},Controls:{},Messages:{}};!function(){"use strict";function e(t){this.name="InvalidData",this.message=t}function s(t){this.name="WrongFileFormat",this.message=t}SplitsBrowser.isTrue=function(t){return t},SplitsBrowser.isNotNull=function(t){return null!==t},SplitsBrowser.isNaNStrict=function(t){return t!=t},SplitsBrowser.isNotNullNorNaN=function(t){return null!==t&&t==t},e.prototype.toString=function(){return this.name+": "+this.message},SplitsBrowser.throwInvalidData=function(t){throw new e(t)},s.prototype.toString=function(){return this.name+": "+this.message},SplitsBrowser.throwWrongFileFormat=function(t){throw new s(t)},SplitsBrowser.hasProperty=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},SplitsBrowser.addIfNotNull=function(t,e){return null===t||null===e?null:t+e},SplitsBrowser.subtractIfNotNull=function(t,e){return null===t||null===e?null:t-e},SplitsBrowser.parseCourseLength=function(t){t=parseFloat(t.replace(",","."));return isFinite(t)?(500<=t&&(t/=1e3),t):null},SplitsBrowser.parseCourseClimb=function(t){t=parseInt(t,10);return SplitsBrowser.isNaNStrict(t)?null:t},SplitsBrowser.normaliseLineEndings=function(t){return t.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}}(),function(){"use strict";var r=SplitsBrowser.hasProperty,e=!1,s=function(t){window.alert(t)},n=null,i=null,o=SplitsBrowser.Messages;function l(t){e||(s(t),e=!0)}SplitsBrowser.setMessageAlerter=function(t){s=t},SplitsBrowser.tryGetMessage=function(t,e){return null!==n&&r(o[n],t)?SplitsBrowser.getMessage(t):e},SplitsBrowser.getMessage=function(t){return null===i&&SplitsBrowser.initialiseMessages(),null!==n?r(o[n],t)?o[n][t]:(l("Message not found for key '"+t+"' in language '"+n+"'"),"?????"):(l("No messages found.  Has a language file been loaded?"),"?????")},SplitsBrowser.getMessageWithFormatting=function(t,e){var s,n,i=SplitsBrowser.getMessage(t);for(s in e){r(e,s)&&(n=s.replace(/([.+*?|{}()^$[\]\\])/g,"\\$1"),i=i.replace(new RegExp(n,"g"),e[s]))}return i},SplitsBrowser.getAllLanguages=function(){return i.slice(0)},SplitsBrowser.getLanguage=function(){return n},SplitsBrowser.getLanguageName=function(t){return r(o,t)&&r(o[t],"Language")?o[t].Language:"?????"},SplitsBrowser.setLanguage=function(t){r(o,t)&&(n=t)},SplitsBrowser.initialiseMessages=function(t){for(var e in i=[],o!==SplitsBrowser.Messages&&l("You appear to have loaded a messages file in the old format.  This file, and all others loaded after it, will not work.\n\nPlease check the messages files."),o)r(o,e)&&i.push(e);0===i.length?l("No messages files were found."):n=t&&r(o,t)?t:i[0]}}(),function(){"use strict";SplitsBrowser.NULL_TIME_PLACEHOLDER="-----";var r=SplitsBrowser.isNaNStrict;function o(t){return t<10?"0"+t:t.toString()}SplitsBrowser.formatTime=function(t,e){if(null===t)return SplitsBrowser.NULL_TIME_PLACEHOLDER;if(r(t))return"???";var s="";t<0&&(s="-",t=-t);var n=Math.floor(t/3600),i=Math.floor(t/60)%60,t=t%60;return 0<n&&(s+=n.toString()+":"),s+=o(i)+":",t<10&&(s+="0"),s+="number"==typeof e?t.toFixed(e):Math.round(100*t)/100},SplitsBrowser.formatTimeOfDay=function(t){var e=Math.floor(t/3600%24),s=Math.floor(t/60)%60,t=Math.floor(t%60);return o(e)+":"+o(s)+":"+o(t)},SplitsBrowser.parseTime=function(t){if(t=t.trim(),/^(-?\d+:)?-?\d+:-?\d\d([,.]\d+)?$/.test(t)){var t=t.replace(",",".").split(":"),e=0;return t.forEach(function(t){e=60*e+parseFloat(t)}),e}return null}}(),function(){"use strict";var t=SplitsBrowser.isNotNull,i=SplitsBrowser.isNaNStrict,e=SplitsBrowser.hasProperty,l=SplitsBrowser.addIfNotNull,n=SplitsBrowser.subtractIfNotNull,u=SplitsBrowser.throwInvalidData;function a(t){if(!$.isArray(t))throw new TypeError("Cumulative times must be an array - got "+typeof t+" instead");0===t.length?u("Array of cumulative times must not be empty"):0!==t[0]?u("Array of cumulative times must have zero as its first item"):1===t.length&&u("Array of cumulative times must contain more than just a single zero");for(var e=[],s=0;s+1<t.length;s+=1)e.push(n(t[s+1],t[s]));return e}function h(t,e,s,n,i){"number"!=typeof t&&u("Result order must be a number, got "+typeof t+" '"+t+"' instead"),"number"!=typeof e&&null!==e&&u("Start time must be a number, got "+typeof e+" '"+e+"' instead"),this.order=t,this.startTime=e,this.owner=i,this.isOKDespiteMissingTimes=!1,this.isNonCompetitive=!1,this.isNonStarter=!1,this.isNonFinisher=!1,this.isDisqualified=!1,this.isOverMaxTime=!1,this.originalSplitTimes=s,this.originalCumTimes=n,this.splitTimes=null,this.cumTimes=null,this.splitRanks=null,this.cumRanks=null,this.timeLosses=null,this.className=null,this.offsets=null,this.totalTime=null===n||-1<n.indexOf(null)?null:n[n.length-1]}function c(t,e,s){for(var n=[0],i=0;i<t.length;i+=1)for(var r=s(t[i]),o=1;o<r.length;o+=1)n.push(l(e[i],r[o]));return n}SplitsBrowser.Model.compareResults=function(t,e){return t.isDisqualified!==e.isDisqualified?t.isDisqualified?1:-1:t.totalTime===e.totalTime?t.order-e.order:null===t.totalTime?null===e.totalTime?0:1:null===e.totalTime?-1:t.totalTime-e.totalTime},h.prototype.setOKDespiteMissingTimes=function(){this.isOKDespiteMissingTimes=!0,null!==this.originalCumTimes&&(this.totalTime=this.originalCumTimes[this.originalCumTimes.length-1])},h.prototype.setNonCompetitive=function(){this.isNonCompetitive=!0},h.prototype.setNonStarter=function(){this.isNonStarter=!0},h.prototype.setNonFinisher=function(){this.isNonFinisher=!0},h.prototype.disqualify=function(){this.isDisqualified=!0},h.prototype.setOverMaxTime=function(){this.isOverMaxTime=!0},h.prototype.setClassName=function(t){this.className=t},h.prototype.setOffsets=function(t){this.offsets=t},h.fromOriginalCumTimes=function(t,e,s,n){return new h(t,e,a(s),s,n)},h.fromCumTimes=function(t,e,s,n){n=h.fromOriginalCumTimes(t,e,s,n);return n.splitTimes=n.originalSplitTimes,n.cumTimes=n.originalCumTimes,n},h.prototype.setRepairedCumulativeTimes=function(t){this.cumTimes=t,this.splitTimes=a(t)},h.prototype.completed=function(){return null!==this.totalTime&&!this.isDisqualified&&!this.isOverMaxTime},h.prototype.hasAnyTimes=function(){return this.originalCumTimes.slice(1).some(t)},h.prototype.getSplitTimeTo=function(t){return 0===t?0:this.splitTimes[t-1]},h.prototype.getOriginalSplitTimeTo=function(t){return this.isNonStarter?null:0===t?0:this.originalSplitTimes[t-1]},h.prototype.isSplitTimeDubious=function(t){return 0<t&&this.originalSplitTimes[t-1]!==this.splitTimes[t-1]},h.prototype.getCumulativeTimeTo=function(t){return this.cumTimes[t]},h.prototype.getOriginalCumulativeTimeTo=function(t){return this.isNonStarter?null:this.originalCumTimes[t]},h.prototype.isCumulativeTimeDubious=function(t){return this.originalCumTimes[t]!==this.cumTimes[t]},h.prototype.getSplitRankTo=function(t){return null===this.splitRanks?null:this.splitRanks[t]},h.prototype.getCumulativeRankTo=function(t){return null===this.cumRanks?null:this.cumRanks[t]},h.prototype.getTimeLossAt=function(t){return 0===t||null===this.timeLosses?null:this.timeLosses[t-1]},h.prototype.getAllCumulativeTimes=function(){return this.cumTimes},h.prototype.getAllOriginalCumulativeTimes=function(){return this.originalCumTimes},h.prototype.getAllSplitTimes=function(){return this.splitTimes},h.prototype.lacksStartTime=function(){return null===this.startTime&&this.splitTimes.some(t)},h.prototype.setSplitAndCumulativeRanks=function(t,e){null===t[0]&&null===e[0]||u("Split and cumulative ranks arrays must both start with null"),this.splitRanks=t,this.cumRanks=e},h.prototype.getCumTimesAdjustedToReference=function(s){return s.length!==this.cumTimes.length?u("Cannot adjust cumulative times because the numbers of times are different ("+this.cumTimes.length+" and "+s.length+")"):-1<s.indexOf(null)&&u("Cannot adjust cumulative times because a null value is in the reference data"),this.cumTimes.map(function(t,e){return n(t,s[e])})},h.prototype.getCumTimesAdjustedToReferenceWithStartAdded=function(t){var t=this.getCumTimesAdjustedToReference(t),e=this.startTime;return t.map(function(t){return l(t,e)})},h.prototype.getSplitPercentsBehindReferenceCumTimes=function(n){n.length!==this.cumTimes.length?u("Cannot determine percentages-behind because the numbers of times are different ("+this.cumTimes.length+" and "+n.length+")"):-1<n.indexOf(null)&&u("Cannot determine percentages-behind because a null value is in the reference data");var i=[0];return this.splitTimes.forEach(function(t,e){var s;null!==t&&0<(s=n[e+1]-n[e])?i.push(100*(t-s)/s):i.push(null)}),i},h.prototype.determineTimeLosses=function(s){var t,e,n;this.completed()&&(s.length!==this.splitTimes.length?u("Cannot determine time loss with "+this.splitTimes.length+" split times using "+s.length+" fastest splits"):s.some(i)&&u("Cannot determine time loss when there is a NaN value in the fastest splits"),s.some(function(t){return 0===t})||this.isOKDespiteMissingTimes||this.splitTimes.some(i)?this.timeLosses=this.splitTimes.map(function(){return NaN}):((t=this.splitTimes.map(function(t,e){return t/s[e]})).sort(d3.ascending),n=t.length%2==1?t[(t.length-1)/2]:(t[(e=t.length/2)-1]+t[e])/2,this.timeLosses=this.splitTimes.map(function(t,e){return Math.round(t-s[e]*n)})))},h.prototype.crosses=function(t,e){t.cumTimes.length!==this.cumTimes.length&&u("Two results with different numbers of controls cannot cross");for(var s,n,i,r=!1,o=!1,l=null===e||null===this.offsets?(s=0,this.cumTimes.length):(s=this.offsets[e],e+1===this.offsets.length?this.cumTimes.length:this.offsets[e+1]+1),a=s;a<l;a+=1){null!==this.cumTimes[a]&&null!==t.cumTimes[a]&&((n=this.startTime+this.cumTimes[a])<(i=t.startTime+t.cumTimes[a])?r=!0:i<n&&(o=!0))}return r&&o},h.prototype.isTimeOmitted=function(t){return i(t)||this.isOKDespiteMissingTimes&&null===t},h.prototype.getIndexesAroundOmittedTimes=function(t){for(var e=[],s=1;s+1<t.length;)if(this.isTimeOmitted(t[s])){for(var n=s;n+1<t.length&&this.isTimeOmitted(t[n+1]);)n+=1;n+1<t.length&&null!==t[s-1]&&null!==t[n+1]&&e.push({start:s-1,end:n+1}),s=n+1}else s+=1;return e},h.prototype.getControlIndexesAroundOmittedCumulativeTimes=function(){return this.getIndexesAroundOmittedTimes(this.cumTimes)},h.prototype.getControlIndexesAroundOmittedSplitTimes=function(){return this.getIndexesAroundOmittedTimes([0].concat(this.splitTimes))},h.prototype.getOwnerNameForLeg=function(t){return(e(this.owner,"members")&&null!==t?this.owner.members[t]:this.owner).name},h.prototype.determineAggregateStatus=function(t){if(t.some(function(t){return t.isDisqualified}))this.isDisqualified=!0;else if(t.every(function(t){return t.isNonStarter}))this.isNonStarter=!0;else{for(var e=-1;e+1<t.length;e+=1){var s=t[e+1];if(s.isNonStarter||s.isNonFinisher||!s.completed())break}for(var n=t.length;0<n;--n){if(!t[n-1].isNonStarter)break}if(e<t.length-1){if(e+1===n)return void(this.isNonFinisher=!0);if(e+2===n&&t[e+1].isNonFinisher)return void(this.isNonFinisher=!0)}t.some(function(t){return t.isOverMaxTime})?this.isOverMaxTime=!0:(t.some(function(t){return t.isNonCompetitive})&&(this.isNonCompetitive=!0),t.some(function(t){return t.isOKDespiteMissingTimes})&&this.setOKDespiteMissingTimes())}},h.createTeamResult=function(t,e,s){e.length<2&&u("Team results can only be created from at least two other results");var n,i,r=(i=[0],(n=e).forEach(function(t,e){var s=i[i.length-1],e=e+1<n.length?n[e+1]:null,e=null!==s&&null!==t.totalTime?s+t.totalTime:null!==e&&null!==e.startTime&&null!==n[0].startTime?e.startTime-n[0].startTime:null;i.push(e)}),i.slice(0,i.length-1));s.setMembers(e.map(function(t){return t.owner}));var o=c(e,r,function(t){return t.originalCumTimes}),s=h.fromOriginalCumTimes(t,e[0].startTime,o,s);return e.every(function(t){return null!==t.cumTimes})&&(s.cumTimes=c(e,r,function(t){return t.cumTimes}),s.splitTimes=a(s.cumTimes)),s.determineAggregateStatus(e),s},SplitsBrowser.Model.Result=h}(),function(){"use strict";function t(t,e){this.name=t,this.club=e,this.yearOfBirth=null,this.gender=null}t.prototype.setYearOfBirth=function(t){this.yearOfBirth=t},t.prototype.setGender=function(t){this.gender=t},SplitsBrowser.Model.Competitor=t}(),function(){"use strict";function t(t,e){this.name=t,this.club=e}t.prototype.setMembers=function(t){this.members=t},SplitsBrowser.Model.Team=t}(),function(){"use strict";var r=SplitsBrowser.isNotNullNorNaN,t=SplitsBrowser.throwInvalidData;function e(e,t,s){this.name=e,this.numControls=t,this.numbersOfControls=null,this.offsets=null,this.results=s,this.course=null,this.hasDubiousData=!1,this.isTeamClass=!1,this.results.forEach(function(t){t.setClassName(e)})}e.prototype.recordHasDubiousData=function(){this.hasDubiousData=!0},e.prototype.setIsTeamClass=function(t){this.isTeamClass=!0,this.numbersOfControls=t,this.offsets=[0];for(var e=1;e<t.length;e+=1)this.offsets.push(this.offsets[e-1]+t[e-1]+1);this.results.forEach(function(t){t.setOffsets(this.offsets)},this)},e.prototype.determineTimeLosses=function(){var e=d3.range(1,this.numControls+2).map(function(t){t=this.getFastestSplitTo(t);return null===t?null:t.split},this);this.results.forEach(function(t){t.determineTimeLosses(e)})},e.prototype.isEmpty=function(){return 0===this.results.length},e.prototype.setCourse=function(t){this.course=t},e.prototype.getFastestSplitTo=function(s){("number"!=typeof s||s<1||s>this.numControls+1)&&t("Cannot return splits to leg '"+s+"' in a course with "+this.numControls+" control(s)");var n=null,i=null;return this.results.forEach(function(t){var e=t.getSplitTimeTo(s);r(e)&&(null===n||e<n)&&(n=e,i=t)}),null===n?null:{split:n,name:i.owner.name}},e.prototype.getResultsAtControlInTimeRange=function(s,n,i){("number"!=typeof s||isNaN(s)||s<0||s>this.numControls+1)&&t("Control number must be a number between 0 and "+this.numControls+" inclusive");var r=[];return this.results.forEach(function(t){var e=t.getCumulativeTimeTo(s);null!==e&&null!==t.startTime&&(e=e+t.startTime,n<=e&&e<=i&&r.push({name:t.owner.name,time:e}))}),r},SplitsBrowser.Model.CourseClass=e}(),function(){"use strict";var h=SplitsBrowser.isNotNull,u=SplitsBrowser.isNaNStrict,c=SplitsBrowser.isNotNullNorNaN,o=SplitsBrowser.throwInvalidData,n=SplitsBrowser.Model.compareResults;function t(t){var e=t.filter(c);e.sort(d3.ascending);var s=new d3.map;return e.forEach(function(t,e){s.has(t)||s.set(t,e+1)}),t.map(function(t){return c(t)?s.get(t):t})}function e(t){this.allResults=function(t){if(0===t.length)return[];var e=[],s=t[0].numControls;return t.forEach(function(t){t.numControls!==s&&o("Cannot merge classes with "+s+" and "+t.numControls+" controls"),t.results.forEach(function(t){t.isNonStarter||e.push(t)})}),e.sort(n),e}(t),this.classes=t,this.numControls=0<t.length?t[0].numControls:null,this.computeRanks()}function p(t,e){for(var s=[],n=1;n+1<t.length;)if(c(t[n]))n+=1;else{for(var i=n;i+1<t.length&&!c(t[i+1]);)i+=1;(i+1<t.length||e)&&s.push({start:n-1,end:i+1}),n=i+1}return s}function s(t){for(var e=p(t=t.slice(0),!1),s=0;s<e.length;s+=1)for(var n=e[s],i=t[n.start],r=(t[n.end]-i)/(n.end-n.start),o=n.start+1;o<n.end;o+=1)t[o]=i+(o-n.start)*r;for(var l=t.length;0<=l&&u(t[l-1]);)--l;if(0<l)for(var a=l;a<t.length;a+=1)t[a]=t[a-1]+(a===t.length-1?60:180);return t}e.prototype.isEmpty=function(){return 0===this.allResults.length},e.prototype.getCourse=function(){return 0<this.classes.length?this.classes[0].course:null},e.prototype.getPrimaryClassName=function(){return 0<this.classes.length?this.classes[0].name:null},e.prototype.getNumClasses=function(){return this.classes.length},e.prototype.hasDubiousData=function(){return this.classes.some(function(t){return t.hasDubiousData})},e.prototype.hasTeamData=function(){return 0<this.classes.length&&this.classes.every(function(t){return t.isTeamClass})},e.prototype.getLegCount=function(){for(var t=null,e=0;e<this.classes.length;e+=1){if(!this.classes[e].isTeamClass)return null;var s=this.classes[e].numbersOfControls.length;if(null===t)t=s;else if(t!==s)return null}return t},e.prototype.getWinnerCumTimes=function(){if(0===this.allResults.length)return null;var t=this.allResults[0];return t.completed()?s(t.cumTimes):null},e.prototype.getFastestCumTimes=function(){return this.getFastestCumTimesPlusPercentage(0)},e.prototype.getFastestCumTimesPlusPercentage=function(t){if(null===this.numControls)return null;var s=1+t/100,r=new Array(this.numControls+1);r[0]=0;for(var o,e=1;e<=this.numControls+1;e+=1){for(var n=null,i=0;i<this.allResults.length;i+=1){var l=this.allResults[i].getSplitTimeTo(e);c(l)&&(null===n||l<n)&&(n=l)}r[e]=n}if(r.every(h)||(t=p(r,!0),o=[],this.allResults.forEach(function(e){p(e.getAllCumulativeTimes(),!1).forEach(function(t){o.push({start:t.start,end:t.end,size:t.end-t.start,overallSplit:e.getCumulativeTimeTo(t.end)-e.getCumulativeTimeTo(t.start)})})}),t.forEach(function(e){var t=o.filter(function(t){return t.start<=e.start&&e.end<=t.end+1}),s=null,n=null;if(t.forEach(function(t){(null===s||t.size<s)&&(s=t.size,n=null),(null===n||t.overallSplit<n)&&(n=t.overallSplit)}),null!==s&&null!==n)for(var i=e.start+1;i<e.end;i+=1)r[i]=n/s})),!r.every(h))for(var a=0;a<r.length;a+=1)null===r[a]&&(r[a]=a===r.length-1?60:180);var u=new Array(this.numControls+1);return r.forEach(function(t,e){u[e]=0===e?0:u[e-1]+t*s}),u},e.prototype.getCumulativeTimesForResult=function(t){return s(this.allResults[t].getAllCumulativeTimes())},e.prototype.computeRanks=function(){var n,i;0!==this.allResults.length&&(n=[],i=[],this.allResults.forEach(function(){n.push([null]),i.push([null])}),d3.range(1,this.numControls+2).forEach(function(e){var s=t(this.allResults.map(function(t){return t.getSplitTimeTo(e)}));this.allResults.forEach(function(t,e){n[e].push(s[e])})},this),d3.range(1,this.numControls+2).forEach(function(s){var n=t(this.allResults.map(function(t,e){return 1<s&&null===i[e][s-1]&&!t.isOKDespiteMissingTimes?null:t.getCumulativeTimeTo(s)}));this.allResults.forEach(function(t,e){i[e].push(n[e])})},this),this.allResults.forEach(function(t,e){t.setSplitAndCumulativeRanks(n[e],i[e])}))},e.prototype.getFastestSplitsTo=function(t,i,e){if("number"!=typeof t||t<=0)o("The number of splits must be a positive integer");else{if(!("number"!=typeof i||i<=0||i>this.numControls+1)){var s=this.allResults.filter(function(t){return t.completed()&&!u(t.getSplitTimeTo(i))});s.sort(function(t,e){var s=t.getSplitTimeTo(i),n=e.getSplitTimeTo(i);return s===n?d3.ascending(t.totalTime,e.totalTime):d3.ascending(s,n)});for(var n=[],r=0;r<s.length&&r<t;r+=1)n.push({name:s[r].getOwnerNameForLeg(e),split:s[r].getSplitTimeTo(i)});return n}o("Control "+i+" out of range")}},e.prototype.sliceForLegIndex=function(t,e){if(this.hasTeamData()&&null!==e){var s=this.classes[0].numbersOfControls[e]+2,e=this.classes[0].offsets[e];return t.slice(e,e+s)}return t.slice(0)},e.prototype.getChartData=function(e,t,s,n){if(void 0===e)throw new TypeError("referenceCumTimes undefined or missing");if(void 0===t)throw new TypeError("currentIndexes undefined or missing");if(void 0===s)throw new TypeError("chartType undefined or missing");if(void 0===n)throw new TypeError("legIndex undefined or missing");var i,r=this.allResults.map(function(t){return s.dataSelector(t,e)}),o=t.map(function(t){return r[t]});this.hasTeamData()&&null!==n?(o=o.map(function(t){return this.sliceForLegIndex(t,n)},this),i=this.classes[0].numbersOfControls[n],e=this.sliceForLegIndex(e,n)):i=this.numControls;var l,a,u=d3.min(e),h=d3.max(e);a=0===t.length?this.isEmpty()?(l=0,60):(p=r[0],l=d3.min(p),d3.max(p)):(l=d3.min(o.map(function(t){return d3.min(t)})),d3.max(o.map(function(t){return d3.max(t)}))),Math.abs(a-l)<1e-8&&(a=l+1);var c=this.hasTeamData()&&null!==n?this.classes[0].offsets[n]:0,p=t.map(function(t){return s.indexesAroundOmittedTimesFunc(this.allResults[t]).filter(function(t){return t.start>=c&&t.end<=c+i+2}).map(function(t){return{start:t.start-c,end:t.end-c}})},this),o=d3.transpose(o),o=d3.zip(e,o),t=t.map(function(t){return this.allResults[t].getOwnerNameForLeg(n)},this);return{dataColumns:o.map(function(t){return{x:t[0],ys:t[1]}}),resultNames:t,numControls:i,xExtent:[u,h],yExtent:[l,a],dubiousTimesInfo:p}},SplitsBrowser.Model.CourseClassSet=e}(),function(){"use strict";var r=SplitsBrowser.throwInvalidData;function t(t,e,s,n,i){this.name=t,this.classes=e,this.length=s,this.climb=n,this.controls=i}var l=t.START="__START__",a=t.FINISH="__FINISH__";t.prototype.getOtherClasses=function(e){var t=this.classes.filter(function(t){return t!==e});if(t.length!==this.classes.length)return t;r("Course.getOtherClasses: given class is not in this course")},t.prototype.getNumClasses=function(){return this.classes.length},t.prototype.hasControls=function(){return null!==this.controls},t.prototype.getControlCode=function(t){return 0===t?l:1<=t&&t<=this.controls.length?this.controls[t-1]:t===this.controls.length+1?a:void r("Cannot get control code of control "+t+" because it is out of range")},t.prototype.usesLeg=function(t,e){return 0<=this.getLegNumber(t,e)},t.prototype.getLegNumber=function(t,e){if(null===this.controls)return-1;if(t===l&&e===a)return 0===this.controls.length?1:-1;if(t===l)return 0<this.controls.length&&this.controls[0]===e?1:-1;if(e===a)return 0<this.controls.length&&this.controls[this.controls.length-1]===t?this.controls.length+1:-1;for(var s=1;s<this.controls.length;s+=1)if(this.controls[s-1]===t&&this.controls[s]===e)return s+1;return-1},t.prototype.getFastestSplitsForLeg=function(t,e){null===this.legs&&r("Cannot determine fastest splits for a leg because leg information is not available");var s=this.getLegNumber(t,e);s<0&&r("Leg from "+((t===l?"start":t)+" to "+(e===a?"end":e))+" not found in course "+this.name);var n=s,i=[];return this.classes.forEach(function(t){var e=t.getFastestSplitTo(n);null!==e&&i.push({name:e.name,className:t.name,split:e.split})}),i},t.prototype.getResultsAtControlInTimeRange=function(t,e,s){if(null===this.controls)return[];if(t===l)return this.getResultsAtControlNumInTimeRange(0,e,s);if(t===a)return this.getResultsAtControlNumInTimeRange(this.controls.length+1,e,s);for(var n=-1,i=[],r=function(t){i.push(t)};;){var o=this.controls.indexOf(t,n+1);if(o<0)return i;this.getResultsAtControlNumInTimeRange(o+1,e,s).forEach(r),n=o}},t.prototype.getResultsAtControlNumInTimeRange=function(t,s,n){var i=[];return this.classes.forEach(function(e){e.getResultsAtControlInTimeRange(t,s,n).forEach(function(t){i.push({name:t.name,time:t.time,className:e.name})})}),i},t.prototype.hasControl=function(t){return null!==this.controls&&-1<this.controls.indexOf(t)},t.prototype.getNextControls=function(t){if(null===this.controls)r("Course has no controls");else if(t===a)r("Cannot fetch next control after the finish");else{if(t===l)return[0===this.controls.length?a:this.controls[0]];for(var e=-1,s=[];;){var n=this.controls.indexOf(t,e+1);if(-1===n)break;n===this.controls.length-1?s.push(a):s.push(this.controls[n+1]),e=n}if(0!==s.length)return s;r("Control '"+t+"' not found on course "+this.name)}},SplitsBrowser.Model.Course=t}(),function(){"use strict";var s=SplitsBrowser.Model.Course;function t(t,e,s){this.classes=t,this.courses=e,this.warnings=s}t.prototype.determineTimeLosses=function(){this.classes.forEach(function(t){t.determineTimeLosses()})},t.prototype.needsRepair=function(){return this.classes.some(function(t){return t.results.some(function(t){return null===t.getAllCumulativeTimes()})})},t.prototype.getFastestSplitsForLeg=function(e,s){var n=[];return this.courses.forEach(function(t){t.usesLeg(e,s)&&(n=n.concat(t.getFastestSplitsForLeg(e,s)))}),n.sort(function(t,e){return d3.ascending(t.split,e.split)}),n},t.prototype.getResultsAtControlInTimeRange=function(e,s,n){var i=[];return this.courses.forEach(function(t){t.getResultsAtControlInTimeRange(e,s,n).forEach(function(t){i.push(t)})}),i.sort(function(t,e){return d3.ascending(t.time,e.time)}),i},t.prototype.getNextControlsAfter=function(e){var t=this.courses;return e!==s.START&&(t=t.filter(function(t){return t.hasControl(e)})),t.map(function(t){return{course:t,nextControls:t.getNextControls(e)}})},SplitsBrowser.Model.Event=t}(),function(){function s(t){return null===t?null:t/60}function t(t){return t.getControlIndexesAroundOmittedCumulativeTimes()}function e(t){return t.getControlIndexesAroundOmittedSplitTimes()}SplitsBrowser.Model.ChartTypes={SplitsGraph:{nameKey:"SplitsGraphChartType",dataSelector:function(t,e){return t.getCumTimesAdjustedToReference(e).map(s)},yAxisLabelKey:"SplitsGraphYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundOmittedTimesFunc:t},RaceGraph:{nameKey:"RaceGraphChartType",dataSelector:function(t,e){return t.getCumTimesAdjustedToReferenceWithStartAdded(e).map(s)},yAxisLabelKey:"RaceGraphYAxisLabel",isRaceGraph:!0,isResultsTable:!1,minViewableControl:0,indexesAroundOmittedTimesFunc:t},PositionAfterLeg:{nameKey:"PositionAfterLegChartType",dataSelector:function(t){return t.cumRanks},yAxisLabelKey:"PositionYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundOmittedTimesFunc:t},SplitPosition:{nameKey:"SplitPositionChartType",dataSelector:function(t){return t.splitRanks},yAxisLabelKey:"PositionYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundOmittedTimesFunc:e},PercentBehind:{nameKey:"PercentBehindChartType",dataSelector:function(t,e){return t.getSplitPercentsBehindReferenceCumTimes(e)},yAxisLabelKey:"PercentBehindYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundOmittedTimesFunc:e},ResultsTable:{nameKey:"ResultsTableChartType",dataSelector:null,yAxisLabelKey:null,isRaceGraph:!1,isResultsTable:!0,minViewableControl:1,indexesAroundOmittedTimesFunc:null}}}(),function(){"use strict";var i="number",r=SplitsBrowser.throwInvalidData;function t(t){typeof t!=i?r("Result count must be a number"):t<0&&r("Result count must be a non-negative number"),this.count=t,this.currentIndexes=[],this.changeHandlers=[]}t.prototype.isSelected=function(t){return-1<this.currentIndexes.indexOf(t)},t.prototype.isSingleRunnerSelected=function(){return 1===this.currentIndexes.length},t.prototype.getSingleRunnerIndex=function(){return this.isSingleRunnerSelected()?this.currentIndexes[0]:null},t.prototype.selectCrossingRunners=function(t,s){var n;this.isSingleRunnerSelected()&&(n=t[this.currentIndexes[0]].result,t.forEach(function(t,e){t.visible&&t.result.crosses(n,s)&&this.currentIndexes.push(e)},this),this.currentIndexes.sort(d3.ascending),this.fireChangeHandlers())},t.prototype.fireChangeHandlers=function(){this.changeHandlers.forEach(function(t){t(this.currentIndexes.slice(0))},this)},t.prototype.selectAll=function(){this.currentIndexes=d3.range(this.count),this.fireChangeHandlers()},t.prototype.selectNone=function(){this.currentIndexes=[],this.fireChangeHandlers()},t.prototype.getSelectedIndexes=function(){return this.currentIndexes.slice(0)},t.prototype.setSelectedIndexes=function(t){t.every(function(t){return 0<=t&&t<this.count},this)&&(this.currentIndexes=t,this.fireChangeHandlers())},t.prototype.registerChangeHandler=function(t){-1===this.changeHandlers.indexOf(t)&&this.changeHandlers.push(t)},t.prototype.deregisterChangeHandler=function(t){t=this.changeHandlers.indexOf(t);-1<t&&this.changeHandlers.splice(t,1)},t.prototype.toggle=function(t){var e;typeof t==i?0<=t&&t<this.count?(-1===(e=this.currentIndexes.indexOf(t))?(this.currentIndexes.push(t),this.currentIndexes.sort(d3.ascending)):this.currentIndexes.splice(e,1),this.fireChangeHandlers()):r("Index '"+t+"' is out of range"):r("Index is not a number")},t.prototype.bulkSelect=function(t){t.some(function(t){return typeof t!=i||t<0||t>=this.count},this)&&r("Indexes not all numeric and in range");var e=d3.set(this.currentIndexes);0<(t=t.filter(function(t){return!e.has(t)})).length&&(this.currentIndexes=this.currentIndexes.concat(t),this.currentIndexes.sort(d3.ascending),this.fireChangeHandlers())},t.prototype.bulkDeselect=function(t){t.some(function(t){return typeof t!=i||t<0||t>=this.count},this)&&r("Indexes not all numeric and in range");for(var e=d3.set(this.currentIndexes),s=!1,n=0;n<t.length;n+=1)e.has(t[n])&&(e.remove(t[n]),s=!0);s&&(this.currentIndexes=e.values().map(function(t){return parseInt(t,10)}),this.currentIndexes.sort(d3.ascending),this.fireChangeHandlers())},t.prototype.migrate=function(e,t){$.isArray(e)?$.isArray(t)?e.length!==this.count?r("ResultSelection.migrate: oldResults list must have the same length as the current count"):0===t.length&&0<this.currentIndexes.length&&r("ResultSelection.migrate: newResults list must not be empty if current list has results selected"):r("ResultSelection.migrate: newResults not an array"):r("ResultSelection.migrate: oldResults not an array");var s=this.currentIndexes.map(function(t){return e[t]});this.count=t.length,this.currentIndexes=[],t.forEach(function(t,e){0<=s.indexOf(t)&&this.currentIndexes.push(e)},this)},SplitsBrowser.Model.ResultSelection=t}(),function(){"use strict";function e(){this.madeAnyChanges=!1}var a=SplitsBrowser.isNotNullNorNaN,i=SplitsBrowser.throwInvalidData;function u(t){0!==t.length&&0===t[0]||i("cumulative times array does not start with a zero cumulative time");for(var e=0,s=1;s<t.length;s+=1){var n=t[s];if(a(n)){if(n<=t[e])return{first:e,second:s};e=s}}return null}e.prototype.removeCumulativeTimesEqualToPrevious=function(t){for(var e=t[0],s=1;s+1<t.length;s+=1)null!==t[s]&&(t[s]===e?(t[s]=NaN,this.madeAnyChanges=!0):e=t[s])},e.prototype.removeCumulativeTimesCausingNegativeSplits=function(t){for(var e=u(t);null!==e&&e.second+1<t.length;){for(var s=e.first,n=e.second,i=!1,r=1;r<=3;r+=1){var o=t.slice();if(3!==r||1!==s&&a(t[s-1])){1===r?o[n]=NaN:2===r?o[s]=NaN:3===r&&(o[s]=NaN,o[s-1]=NaN);var l=u(o);if(null===l||l.first>n){i=!0,t=o,this.madeAnyChanges=!0,e=l;break}}else;}if(!i)break}return t},e.prototype.removeFinishTimeIfAbsurd=function(t){var e=t[t.length-1],s=t[t.length-2];a(e)&&a(s)&&e<=s-300&&(t[t.length-1]=NaN,this.madeAnyChanges=!0)},e.prototype.repairResult=function(t){var e=t.originalCumTimes.slice(0);this.removeCumulativeTimesEqualToPrevious(e),e=this.removeCumulativeTimesCausingNegativeSplits(e),t.completed()||this.removeFinishTimeIfAbsurd(e),t.setRepairedCumulativeTimes(e)},e.prototype.repairCourseClass=function(t){this.madeAnyChanges=!1,t.results.forEach(function(t){this.repairResult(t)},this),this.madeAnyChanges&&t.recordHasDubiousData()},e.prototype.repairEventData=function(t){t.classes.forEach(function(t){this.repairCourseClass(t)},this)},SplitsBrowser.DataRepair={repairEventData:function(t){(new e).repairEventData(t)},transferResultData:function(t){t.classes.forEach(function(t){t.results.forEach(function(t){t.setRepairedCumulativeTimes(t.getAllOriginalCumulativeTimes())})})}}}(),function(){"use strict";var o=SplitsBrowser.isTrue,l=SplitsBrowser.isNotNull,a=SplitsBrowser.throwInvalidData,u=SplitsBrowser.throwWrongFileFormat,r=SplitsBrowser.normaliseLineEndings,h=SplitsBrowser.parseTime,c=SplitsBrowser.Model.Result.fromCumTimes,p=SplitsBrowser.Model.Competitor,d=SplitsBrowser.Model.compareResults,m=SplitsBrowser.Model.CourseClass,f=SplitsBrowser.Model.Course,g=SplitsBrowser.Model.Event;function C(t,s){var e=t.split(/\r?\n/).filter(o);0===e.length&&a("parseCourseClass got an empty list of lines");var n=e.shift().split(",");if(2===n.length){var i=n.shift(),t=n.shift(),r=parseInt(t,10);if(isNaN(r))a("Could not read control count: '"+t+"'");else{if(!(r<0&&0<e.length)){e=e.map(function(t,e){return function(t,e,s,n,i){for(var r=e.split(",");r.length>s+5&&r[3].match(/[^0-9.,:-]/);)r[2]+=","+r[3],r.splice(3,1);var o=r.length,l=((r.shift()||"")+" "+(r.shift()||"")).trim()||"<name unknown>";if(o!==s+5)return o=(o-=s+5)<0?-o+" too few":o+" too many",i.push("Competitor '"+l+"' appears to have the wrong number of split times - "+o+" (row "+(t+1)+" of class '"+n+"')"),null;var o=r.shift(),n=r.shift();0===(e=h(n))?e=null:n.match(/^\d+:\d\d:\d\d$/)||(e*=60);var a=[0],u=0;return r.map(function(t){t=h(t);null!==t&&0<t?(u+=t,a.push(u)):a.push(null)}),o=c(t+1,e,a,new p(l,o)),0===u&&o.setNonStarter(),o}(e,t,r,i,s)}).filter(l);return e.sort(d),new m(i,r,e)}a("Expected a non-negative control count, got "+r+" instead")}}else u("Expected first line to have two parts (class name and number of controls), got "+n.length+" part(s) instead")}SplitsBrowser.Input.CSV={parseEventData:function(t){/<html/i.test(t)&&u("Cannot parse this file as CSV as it appears to be HTML");var t=(t=(t=r(t)).replace(/,+\n/g,"\n").replace(/,+$/,"")).split(/\n\n/).map(function(t){return t.trim()}).filter(o),e=[],s=t.map(function(t){return C(t,e)});0===(s=s.filter(function(t){return!t.isEmpty()})).length&&a("No competitor data was found");for(var n=s.map(function(t){return new f(t.name,[t],null,null,null)}),i=0;i<s.length;i+=1)s[i].setCourse(n[i]);return new g(s,n,e)}}}(),function(){"use strict";var n=SplitsBrowser.throwInvalidData,
i=SplitsBrowser.throwWrongFileFormat,u=SplitsBrowser.isNaNStrict,h=SplitsBrowser.hasProperty,r=SplitsBrowser.parseCourseLength,o=SplitsBrowser.parseCourseClimb,e=SplitsBrowser.normaliseLineEndings,c=SplitsBrowser.parseTime,p=SplitsBrowser.Model.Result.fromOriginalCumTimes,d=SplitsBrowser.Model.Competitor,s=SplitsBrowser.Model.CourseClass,C=SplitsBrowser.Model.Course,l=SplitsBrowser.Model.Event,a=[";",",","\t","\\"],m={};[44,46,60].forEach(function(t){m[t]={course:t-7,distance:t-6,climb:t-5,controlCount:t-4,placing:t-3,startPunch:t-2,finish:t-1,control1:t}}),[44,46].forEach(function(t){m[t].nonCompetitive=t-38,m[t].startTime=t-37,m[t].time=t-35,m[t].classifier=t-34,m[t].club=t-31,m[t].className=t-28}),m[44].combinedName=3,m[44].yearOfBirth=4,m[46].forename=4,m[46].surname=3,m[46].yearOfBirth=5,m[46].gender=6,m[60].forename=6,m[60].surname=5,m[60].yearOfBirth=7,m[60].gender=8,m[60].combinedName=3,m[60].nonCompetitive=10,m[60].startTime=11,m[60].time=13,m[60].classifier=14,m[60].club=20,m[60].className=26,m[60].classNameFallback=m[60].course,m[60].clubFallback=18;function f(t){return'"'===t[0]&&'"'===t[t.length-1]&&(t=t.substring(1,t.length-1).replace(/""/g,'"').trim()),t}function g(t){this.data=e(t),this.classes=d3.map(),this.courseDetails=d3.map(),this.classCoursePairs=[],this.columnIndexes=null,this.warnings=[]}g.prototype.identifyDelimiter=function(){this.lines.length<=1&&i("No data found to read");for(var t=this.lines[1],e=0;e<a.length;e+=1){var s=a[e];if(37<t.split(s).length)return s}i("Data appears not to be in the OE CSV format")},g.prototype.identifyFormatVariation=function(t){var e,s=this.lines[1].split(t),n=/^[A-Za-z0-9]+$/;for(e in m){if(h(m,e))if((e=parseInt(e,10))<s.length&&n.test(s[e])&&(""===s[e-2].trim()||null!==c(s[e-2]))&&(""===s[e-1].trim()||null!==c(s[e-1])))if(""!==s[m[e].controlCount].trim())return void(this.columnIndexes=m[e])}i("Did not find control 1 at any of the supported indexes")},g.prototype.getClassName=function(t){var e=t[this.columnIndexes.className];return""===e&&h(this.columnIndexes,"classNameFallback")&&(e=t[this.columnIndexes.classNameFallback]),e},g.prototype.getStartTime=function(t){var e=t[this.columnIndexes.startPunch];return""===e&&(e=t[this.columnIndexes.startTime]),c(e)},g.prototype.getNumControls=function(t,e){var s,n=this.getClassName(t);if(""===n.trim())return s=this.getName(t)||"<name unknown>",this.warnings.push("Could not find a class for competitor '"+s+"' (line "+e+")"),null;if(this.classes.has(n))return this.classes.get(n).numControls;n=parseInt(t[this.columnIndexes.controlCount],10);return isFinite(n)?n:(s=this.getName(t)||"<name unknown>",this.warnings.push("Could not read the control count '"+t[this.columnIndexes.controlCount]+"' for competitor '"+s+"' from line "+e),null)},g.prototype.readCumulativeTimes=function(t,e,s){for(var n=[0],i=0;i<s;i+=1){var r=this.columnIndexes.control1+1+2*i,r=r<t.length?t[r]:null,r=null===r?null:c(r);n.push(r)}var o,l,a=c(t[this.columnIndexes.time]);return null===a&&(o=this.getStartTime(t),l=c(t[this.columnIndexes.finish]),null!==o&&null!==l&&(a=l-o)),n.push(a),n},g.prototype.createClassIfNecessary=function(t,e){t=this.getClassName(t);this.classes.has(t)||this.classes.set(t,{numControls:e,results:[]})},g.prototype.createCourseIfNecessary=function(e,t){var s=e[this.columnIndexes.course];this.courseDetails.has(s)||(t=d3.range(0,t).map(function(t){return e[this.columnIndexes.control1+2*t]},this),this.courseDetails.set(s,{length:r(e[this.columnIndexes.distance]),climb:o(e[this.columnIndexes.climb]),controls:t}))},g.prototype.createClassCoursePairIfNecessary=function(t){var e=this.getClassName(t),s=t[this.columnIndexes.course];this.classCoursePairs.some(function(t){return t[0]===e&&t[1]===s})||this.classCoursePairs.push([e,s])},g.prototype.getName=function(t){var e="";return h(this.columnIndexes,"forename")&&h(this.columnIndexes,"surname")&&(e=(t[this.columnIndexes.forename]+" "+t[this.columnIndexes.surname]).trim()),""===e&&h(this.columnIndexes,"combinedName")&&(e=t[this.columnIndexes.combinedName]),e},g.prototype.addCompetitor=function(t,e){var s=this.getClassName(t),n=t[this.columnIndexes.placing],i=t[this.columnIndexes.club];""===i&&h(this.columnIndexes,"clubFallback")&&(i=t[this.columnIndexes.clubFallback]);var r=this.getStartTime(t),o=this.getName(t),l=""!==n&&u(parseInt(n,10));l&&o.substring(o.length-n.length)===n&&(o=o.substring(0,o.length-n.length).trim());var a,n=this.classes.get(s).results.length+1,o=new d(o,i),i=t[this.columnIndexes.yearOfBirth];""!==i&&(a=parseInt(i,10),u(a)||o.setYearOfBirth(a)),h(this.columnIndexes,"gender")&&("M"!==(a=t[this.columnIndexes.gender])&&"F"!==a||o.setGender(a));o=p(n,r,e,o);("1"===t[this.columnIndexes.nonCompetitive]||l)&&o.completed()&&o.setNonCompetitive();t=t[this.columnIndexes.classifier];""!==t?"0"===t&&0<=e.indexOf(null)&&null!==e[e.length-1]?o.setOKDespiteMissingTimes():"1"===t?o.setNonStarter():"2"===t?o.setNonFinisher():"4"===t?o.disqualify():"5"===t&&o.setOverMaxTime():o.hasAnyTimes()||o.setNonStarter(),this.classes.get(s).results.push(o)},g.prototype.readLine=function(t,e,s){""!==t.trim()&&((t=t.split(s).map(function(t){return t.trim()}).map(f)).length<37&&n("Too few items on line "+e+" of the input file: expected at least 37, got "+t.length),null!==(s=this.getNumControls(t,e))&&(e=this.readCumulativeTimes(t,e,s),this.createClassIfNecessary(t,s),this.createCourseIfNecessary(t,s),this.createClassCoursePairIfNecessary(t),this.addCompetitor(t,e)))},g.prototype.getMapsBetweenClassesAndCourses=function(){var s=d3.map(),n=d3.map();return this.classCoursePairs.forEach(function(t){var e=t[0],t=t[1];s.has(e)?s.get(e).push(t):s.set(e,[t]),n.has(t)?n.get(t).push(e):n.set(t,[e])}),{classesToCourses:s,coursesToClasses:n}},g.prototype.createClasses=function(){var t=this.classes.keys();return t.sort(),t.map(function(t){var e=this.classes.get(t);return new s(t,e.numControls,e.results)},this)},g.prototype.createCourseFromLinkedClassesAndCourses=function(t,e,s,n){for(var i,r,o=[t],l=[],a=[],u=[];0<o.length||0<l.length;){for(;0<o.length;){i=o.shift();for(var h=e.coursesToClasses.get(i),c=0;c<h.length;c+=1)r=h[c],l.indexOf(r)<0&&u.indexOf(r)<0&&l.push(r);a.push(i)}for(;0<l.length;){r=l.shift();for(var p=e.classesToCourses.get(r),d=0;d<p.length;d+=1)i=p[d],o.indexOf(i)<0&&a.indexOf(i)<0&&o.push(i);u.push(r)}}a.forEach(function(t){s.add(t)});var m=u.map(function(t){return n.get(t)}),f=this.courseDetails.get(t),g=new C(t,m,f.length,f.climb,f.controls);return m.forEach(function(t){t.setCourse(g)}),g},g.prototype.determineCourses=function(t){var e=this.getMapsBetweenClassesAndCourses(),s=d3.set(),n=d3.map();t.forEach(function(t){n.set(t.name,t)});var i=[];return e.coursesToClasses.keys().forEach(function(t){s.has(t)||(t=this.createCourseFromLinkedClassesAndCourses(t,e,s,n),i.push(t))},this),i},g.prototype.parseEventData=function(){this.warnings=[],this.lines=this.data.split(/\n/);var s=this.identifyDelimiter();this.identifyFormatVariation(s),this.lines.shift(),this.lines.forEach(function(t,e){this.readLine(t,e+1,s)},this);var t=this.createClasses();0===t.length&&0<this.warnings.length&&i("This file may have looked vaguely like an OE CSV file but no data could be read out of it");var e=this.determineCourses(t);return new l(t,e,this.warnings)},SplitsBrowser.Input.OE={},SplitsBrowser.Input.OE.parseEventData=function(t){return new g(t).parseEventData()}}(),function(){"use strict";var a=SplitsBrowser.isNotNull,h=SplitsBrowser.throwInvalidData,n=SplitsBrowser.throwWrongFileFormat,e=SplitsBrowser.parseCourseLength,i=SplitsBrowser.normaliseLineEndings,c=SplitsBrowser.parseTime,s=SplitsBrowser.Model.Result.fromOriginalCumTimes,r=SplitsBrowser.Model.Competitor,u=SplitsBrowser.Model.CourseClass,p=SplitsBrowser.Model.Course,d=SplitsBrowser.Model.Event,o=/<[^>]+>/g,l=/([0-9.,]+)\s*(?:Km|km)/,m=/(\d+)\s*(?:Cm|Hm|hm|m)/;function f(t){return null!==t&&""!==t}function g(t){return""!==(t=t.trim())&&isFinite(t)}function C(t){return t.split(/\s+/g).filter(f)}function v(t){return t.replace(o,"")}function S(t,e){for(var s,n=[];null!==(s=t.exec(e));)n.push(v(s[1]));return n}function y(t){return S(/<font[^>]*>(.*?)<\/font>/g,t)}function T(t){return S(/<td[^>]*>(.*?)<\/td>/g,t).map(function(t){return t.trim()})}function x(t){return T(t).filter(function(t){return""!==t})}function w(t){t=l.exec(t);return null===t?null:e(t[1])}function b(t){t=m.exec(t);return null===t?null:parseInt(t[1],10)}function L(t){for(var e=[],s=0;s<t.length;s+=1){var n=t[s],i=n.indexOf("(");-1<i&&")"===n[n.length-1]?(i=n.substring(i+1,n.length-1),e.push(i)):s+1===t.length?e.push(null):h("Unrecognised control header label: '"+n+"'")}return e}function D(t,e){for(;0<e.length&&"*"===e[e.length-1][0];)e.splice(e.length-1,1),t.splice(t.length-1,1)}function R(t,e,s,n,i,r){this.name=t,this.club=e,this.className=s,this.totalTime=n,this.cumTimes=i,this.competitive=r}R.prototype.isContinuation=function(){return""===this.name&&""===this.club&&null===this.className&&""===this.totalTime&&!this.competitive},R.prototype.append=function(t){if(!t.isContinuation())throw new Error("Can only append a continuation CompetitorParseRecord");this.cumTimes=this.cumTimes.concat(t.cumTimes)},R.prototype.toResult=function(t){var e=[0].concat(this.cumTimes),e=s(t,null,e,new r(this.name,this.club));return e.completed()&&!this.competitive&&e.setNonCompetitive(),e.hasAnyTimes()||e.setNonStarter(),e};function t(){this.precedingColumnCount=null}t.prototype.isTextOfThisFormat=function(t){return 0<=t.indexOf("<pre>")&&0<=t.indexOf("<font")},t.prototype.preprocess=function(t){var e=t.indexOf("<pre>");if(-1===e)throw new Error("Cannot find opening pre tag");var s=t.indexOf("\n",e),e=(t=(t=t.substring(s+1)).replace(/\n{2,}/g,"\n")).lastIndexOf("</pre>");return-1===e&&h("Found opening <pre> but no closing </pre>"),s=t.lastIndexOf("\n",e),(t=t.substring(0,s)).trim()},t.prototype.canIgnoreThisLine=function(t){return""===t},t.prototype.isCourseHeaderLine=function(t){return 2===y(t).length},t.prototype.parseCourseHeaderLine=function(t){var e=y(t);if(2!==e.length)throw new Error("Course header line should have two parts");var s=e[0],t=e[1],e=s.indexOf("("),e=-1<e?s.substring(0,e):s,s=w(t),t=b(t);return{name:e.trim(),distance:s,climb:t}},t.prototype.parseControlsLine=function(t){var e=t.lastIndexOf("</font>");return L(C((-1===e?t:t.substring(e+"</font>".length)).trim()))},t.prototype.readCompetitorSplitDataLine=function(t){for(var e=0;e<this.precedingColumnCount;e+=1){var s=t.indexOf("</font>");t=t.substring(s+"</font>".length)}return C(v(t))},t.prototype.parseCompetitor=function(t,e){var s=y(t),n=y(e);null===this.precedingColumnCount&&(l=s[1].trim(),this.precedingColumnCount=l.match(/^\d*$/)?4:3);var i=g(s[0]),r=s[this.precedingColumnCount-2].trim(),o=s[this.precedingColumnCount-1].trim(),l=n[this.precedingColumnCount-2].trim(),s=this.readCompetitorSplitDataLine(t),n=this.readCompetitorSplitDataLine(e);D(s=s.map(c),n);e=null;if(null!==r&&""!==r){for(var a=-1,u=0;u<this.precedingColumnCount;u+=1)a=t.indexOf("</font>",a+1);n=C(t.substring(0,a+"</font>".length).replace(/<font[^>]*>(.*?)<\/font>/g,""));0<n.length&&(e=n[0])}return new R(r,l,e,o,s,i)};function I(){this.timesOffset=null}I.prototype.isTextOfThisFormat=function(t){for(var e=-1,s=0;s<5;s+=1)if(-1===(e=t.indexOf("<table",e+1)))return!1;return!0},I.prototype.preprocess=function(t){var e=t.indexOf("</table>");-1===e&&h("Could not find any closing </table> tags");var s=(t=t.substring(e+"</table>".length)).indexOf("</div>"),e=t.indexOf("<table");return-1<s&&s<e&&(t=t.substring(s+"</div>".length)),(t=(t=(t=(t=(t=(t=t.replace(/>\n+</g,"><").replace(/><tr>/g,">\n<tr>").replace(/<\/tr></g,"</tr>\n<").replace(/><table/g,">\n<table").replace(/<\/table></g,"</table>\n<")).replace(/<\/col[^>]*>/g,"")).replace(/<tr[^>]*><td[^>]*>(?:<nobr>)?&nbsp;?(?:<\/nobr>)?<\/td><\/tr>/g,"")).replace(/<a id="[^"]*"><\/a>/g,"")).replace(/<div id="navigation">[\s\S]*?<\/div>/g,"")).replace("</body></html>","")).trim()},I.prototype.canIgnoreThisLine=function(t){if(-1<t.indexOf("<th>")){var e=S(/<th[^>]*>(.*?)<\/th>/g,t).filter(function(t){return""!==t});return this.timesOffset=e.length,!0}return""===t||-1<t.indexOf("<table")||-1<t.indexOf("</table>")},I.prototype.isCourseHeaderLine=function(t){return-1<t.indexOf('<td id="header"')},I.prototype.parseCourseHeaderLine=function(t){var e=x(t);0===e.length&&h("No parts found in course header line");var s=e[0],t=s.indexOf("(");-1<t&&(s=s.substring(0,t)),s=s.trim();for(var n=null,i=null,r=1;r<e.length;r+=1)null===n&&(n=w(e[r])),null===i&&(i=b(e[r]));return{name:s,distance:n,climb:i}},I.prototype.parseControlsLine=function(t){return L(x(t))},I.prototype.readCompetitorSplitDataLine=function(t){for(var e=T(t),t=this.timesOffset,s=e.length;0<s&&""===e[s-1];)--s;return e.slice(t,s).filter(f)},I.prototype.parseCompetitor=function(t,e){var s=T(t),n=T(e),i=g(s[0]),r=3===this.timesOffset?1:2,o=s[r],l=s[this.timesOffset-1],n=n[r],r=5===this.timesOffset&&""!==o?s[3]:null,s=this.readCompetitorSplitDataLine(t),t=this.readCompetitorSplitDataLine(e);D(s=s.map(c),t);e=s.filter(a).length;return e!==t.length&&h("Cumulative and split times do not have the same length: "+e+" cumulative times, "+t.length+" split times"),new R(o,n,r,l,s,i)};function N(){this.usesClasses=!1}function O(t,e,s){this.name=t,this.distance=e,this.climb=s,this.controls=[],this.competitors=[]}function B(t){this.recognizer=t,this.courses=[],this.currentCourse=null,this.lines=null,this.linePos=-1,this.currentCompetitor=null}N.prototype.isTextOfThisFormat=function(t){var e=t.indexOf("<table");if(0<=e){e=t.indexOf("<table",e+1);if(0<=e)if(t.indexOf("<table",e+1)<0)return!0}return!1},N.prototype.preprocess=function(t){var e=t.indexOf("</table>");return-1===e&&h("Could not find any closing </table> tags"),0<=t.indexOf('<td colspan="25">')&&(this.usesClasses=!0),(t=(t=(t=(t=t.substring(e+"</table>".length)).replace(/<tr[^>]*><td colspan=[^>]*>&nbsp;<\/td><\/tr>/g,"")).replace(/\n{2,}/g,"\n")).replace("</body>","").replace("</html>","")).trim()},N.prototype.canIgnoreThisLine=function(t){return""===t||-1<t.indexOf("<table")||-1<t.indexOf("</table>")||-1<t.indexOf("<hr>")},N.prototype.isCourseHeaderLine=function(t){return-1<t.indexOf('<tr class="clubName"')},N.prototype.parseCourseHeaderLine=function(t){var e=x(t);0===e.length&&h("No parts found in course header line");var s,n,t=e[0],e=/^(.*?)\s+\((\d+)m,\s*(\d+)m\)$/.exec(t),e=null===e?(s=t,n=null):(s=e[1],n=parseInt(e[2],10)/1e3,parseInt(e[3],10));return{name:s.trim(),distance:n,climb:e}},N.prototype.parseControlsLine=function(t){return x(t).map(function(t){var e=t.indexOf("-");return-1===e?null:t.substring(e+1)})},N.prototype.readCompetitorSplitDataLine=function(t){for(var e=this.usesClasses?5:4,s=t.length;0<s&&""===t[s-1];)--s;for(var n=[],i=e;i<s;i+=2){var r=t[i];f(r)&&n.push(r)}return n},N.prototype.parseCompetitor=function(t,e){for(var s=T(t),n=T(e),i=g(s[0]),r=s[2],o=s[this.usesClasses?4:3],l=this.usesClasses&&""!==r?s[3]:null,a=n[2],u=this.usesClasses?5:4;u<s.length&&u<n.length;u+=2)""!==s[u]&&""===n[u]&&(n[u]="----");t=this.readCompetitorSplitDataLine(s),e=this.readCompetitorSplitDataLine(n);return D(t=t.map(c),e),t.length!==e.length&&h("Cumulative and split times do not have the same length: "+t.length+" cumulative times, "+e.length+" split times"),new R(r,a,l,o,t,i)},O.prototype.addControls=function(t){this.controls=this.controls.concat(t)},O.prototype.hasAllControls=function(){return 0<this.controls.length&&null===this.controls[this.controls.length-1]},O.prototype.addCompetitor=function(t){if(t.competitive||t.cumTimes.length!==this.controls.length-1||t.cumTimes.push(null),null===c(t.totalTime)&&0===t.cumTimes.length)for(;t.cumTimes.length<this.controls.length;)t.cumTimes.push(null);t.cumTimes.length===this.controls.length?this.competitors.push(t):h("Competitor '"+t.name+"' should have "+this.controls.length+" cumulative times, but has "+t.cumTimes.length+" times")},B.prototype.tryGetLine=function(){return this.linePos+1<this.lines.length?(this.linePos+=1,this.lines[this.linePos]):null},B.prototype.addCurrentCompetitorIfNecessary=function(){null!==this.currentCompetitor&&(this.currentCourse.addCompetitor(this.currentCompetitor),this.currentCompetitor=null)},B.prototype.addCurrentCompetitorAndCourseIfNecessary=function(){this.addCurrentCompetitorIfNecessary(),null!==this.currentCourse&&this.courses.push(this.currentCourse)},B.prototype.readCompetitorLines=function(t){var e=this.tryGetLine();null===e&&h("Hit end of input data unexpectedly while parsing competitor: first line was '"+t+"'");e=this.recognizer.parseCompetitor(t,e);e.isContinuation()?null===this.currentCompetitor?h("First row of competitor data has no name nor time"):this.currentCompetitor.append(e):(this.addCurrentCompetitorIfNecessary(),this.currentCompetitor=e)},B.prototype.areClassesUniqueWithinCourses=function(){for(var t=d3.map(),e=0;e<this.courses.length;e+=1)for(var s=this.courses[e],n=0;n<s.competitors.length;n+=1){var i=s.competitors[n];if(t.has(i.className)){if(t.get(i.className)!==s.name)return!1}else t.set(i.className,s.name)}return!0},B.prototype.createOverallEventObject=function(){var s=this.areClassesUniqueWithinCourses(),t=[],o=[],l=this.courses.every(function(t){return t.competitors.every(function(t){return a(t.className)})});return this.courses.forEach(function(n){var i=d3.map();n.competitors.forEach(function(t){var e=l&&s?t.className:n.name;i.has(e)?i.get(e).push(t):i.set(e,[t])});var r=[];i.keys().forEach(function(t){var e=n.controls.length-1,s=i.get(t).map(function(t,e){return t.toResult(e+1)}),s=new u(t,e,s);r.push(s),o.push(s)},this);var e=new p(n.name,r,n.distance,n.climb,n.controls.slice(0,n.controls.length-1));t.push(e),r.forEach(function(t){t.setCourse(e)})},this),new d(o,t,[])},B.prototype.parse=function(t){for(this.lines=t.split("\n");;){var e,s=this.tryGetLine();if(null===s)break;this.recognizer.canIgnoreThisLine(s)||(this.recognizer.isCourseHeaderLine(s)?(this.addCurrentCompetitorAndCourseIfNecessary(),e=this.recognizer.parseCourseHeaderLine(s),this.currentCourse=new O(e.name,e.distance,e.climb)):null===this.currentCourse||(this.currentCourse.hasAllControls()?this.readCompetitorLines(s):(s=this.recognizer.parseControlsLine(s),this.currentCourse.addControls(s))))}return this.addCurrentCompetitorAndCourseIfNecessary(),0===this.courses.length&&h("No competitor data was found"),this.createOverallEventObject()};var M=[t,I,N];SplitsBrowser.Input.Html={},SplitsBrowser.Input.Html.parseEventData=function(t){t=i(t);for(var e=0;e<M.length;e+=1){var s=new M[e];if(s.isTextOfThisFormat(t))return t=s.preprocess(t),new B(s).parse(t)}n("No HTML recognizers recognised this as HTML they could parse")}}(),function(){"use strict";var n=SplitsBrowser.throwWrongFileFormat,i=SplitsBrowser.normaliseLineEndings,a=SplitsBrowser.parseTime,l=SplitsBrowser.parseCourseLength,u=SplitsBrowser.parseCourseClimb,h=SplitsBrowser.Model.Result.fromOriginalCumTimes,c=SplitsBrowser.Model.Competitor,o=SplitsBrowser.Model.CourseClass,p=SplitsBrowser.Model.Course,r=SplitsBrowser.Model.Event,e={controlsOffset:38,step:3,name:3,club:5,courseName:7,startTime:8,length:null,climb:null,placing:null,finishTime:null,allowMultipleCompetitorNames:!0},d=[",",";"],m=/^[A-Za-z0-9]+$/;function f(t){for(var e=t.length-1;0<=e&&""===t[e];)--e;t.splice(e+1,t.length-e-1)}function s(t){this.format=t,this.classes=d3.map(),this.delimiter=null,this.hasAnyStarters=!1,this.warnings=[],this.controlsTerminationOffset=null===t.finishTime?t.step:0}s.prototype.determineDelimiter=function(t){for(var e=0;e<d.length;e+=1){var s=d[e],n=t.split(s);if(f(n),n.length>this.format.controlsOffset)return s}return null},s.prototype.adjustLinePartsForMultipleCompetitors=function(t){if(this.format.allowMultipleCompetitorNames)for(;t.length>this.format.name+1&&t[this.format.name+1].match(/^\s\S/);)t[this.format.name]+=","+t[this.format.name+1],t.splice(this.format.name+1,1)},s.prototype.checkControlCodesAlphaNumeric=function(t){var e=t.split(this.delimiter);f(e),this.adjustLinePartsForMultipleCompetitors(e,this.format);for(var s=this.format.controlsOffset;s+this.controlsTerminationOffset<e.length;s+=this.format.step)m.test(e[s])||n("Data appears not to be in an alternative CSV format - data in cell "+s+" of the first row ('"+e[s]+"') is not an number")},s.prototype.addResultToCourse=function(t,e,s){if(this.classes.has(e)){var n=this.classes.get(e),i=t.getAllOriginalCumulativeTimes();i.length-1!==n.controls.length+1?this.warnings.push("Competitor '"+t.owner.name+"' has the wrong number of splits for course '"+e+"': expected "+(n.controls.length+1)+", actual "+(i.length-1)):n.results.push(t)}else{for(var r=[],o=this.format.controlsOffset;o+this.controlsTerminationOffset<s.length;o+=this.format.step)r.push(s[o]);i=null===this.format.length?null:l(s[this.format.length]),n=null===this.format.climb?null:u(s[this.format.climb]);this.classes.set(e,{length:i,climb:n,controls:r,results:[t]})}},s.prototype.readDataRow=function(t){var e=t.split(this.delimiter);if(f(e),this.adjustLinePartsForMultipleCompetitors(e),!(e.length<this.format.controlsOffset)){for(;(e.length-this.format.controlsOffset)%this.format.step!=0;)e.push("");for(var s,n=e[this.format.name],i=e[this.format.club],r=e[this.format.courseName],t=a(e[this.format.startTime]),o=[0],l=this.format.controlsOffset+1;l<e.length;l+=this.format.step)o.push(a(e[l]));null!==this.format.finishTime&&(s=a(e[this.format.finishTime]),s=null===t||null===s?null:s-t,o.push(s)),1!==o.length?(s=this.classes.has(r)?this.classes.get(r).results.length+1:1,i=h(s,t,o,new c(n,i)),null!==this.format.placing&&i.completed()&&(e[this.format.placing].match(/^\d*$/)||i.setNonCompetitive()),i.hasAnyTimes()?this.hasAnyStarters=!0:i.setNonStarter(),this.addResultToCourse(i,r,e)):""!==n&&this.warnings.push("Competitor '"+n+"' on course '"+(""===r?"(unnamed)":r)+"' has no times recorded")}},s.prototype.createClassesAndCourses=function(){var i=[],r=d3.map();this.classes.entries().forEach(function(t){var e=t.key,s=t.value,n=new o(e,s.controls.length,s.results);i.push(n);t=s.controls.join(",");r.has(t)?r.get(t).classes.push(n):r.set(t,{name:e,classes:[n],length:s.length,climb:s.climb,controls:s.controls})});var s=[];return r.values().forEach(function(t){var e=new p(t.name,t.classes,t.length,t.climb,t.controls);t.classes.forEach(function(t){t.setCourse(e)}),s.push(e)}),{classes:i,courses:s}},s.prototype.parseEventData=function(t){this.warnings=[];var e=(t=i(t)).split(/\n/);e.length<2&&n("Data appears not to be in an alternative CSV format - too few lines");t=e[1];this.delimiter=this.determineDelimiter(t),null===this.delimiter&&n("Data appears not to be in an alternative CSV format - first data line has fewer than "+this.format.controlsOffset+" parts when separated by any recognised delimiter"),this.checkControlCodesAlphaNumeric(t);for(var s=1;s<e.length;s+=1)this.readDataRow(e[s]);t=this.createClassesAndCourses();return this.hasAnyStarters||n("Data appears not to be in an alternative CSV format - data apparently could be read but everyone was a non-starter"),new r(t.classes,t.courses,this.warnings)},SplitsBrowser.Input.AlternativeCSV={parseTripleColumnEventData:function(t){return new s(e).parseEventData(t)}}}(),function(){"use strict";var i=SplitsBrowser.throwInvalidData,h=SplitsBrowser.throwWrongFileFormat,o=SplitsBrowser.isNaNStrict,s=SplitsBrowser.parseTime,c=SplitsBrowser.Model.Result.fromOriginalCumTimes,S=SplitsBrowser.Model.Result.createTeamResult,p=SplitsBrowser.Model.Competitor,y=SplitsBrowser.Model.Team,d=SplitsBrowser.Model.CourseClass,m=SplitsBrowser.Model.Course,f=SplitsBrowser.Model.Event;function r(t){return void 0===t}var g=/^\d{4}/,t={isOfThisVersion:function(t){return 0<=t.indexOf("IOFdata.dtd")},checkVersion:function(t){var e=$("> IOFVersion",t);0===e.length?h("Could not find IOFVersion element"):r(e=e.attr("version"))?h("Version attribute missing from IOFVersion element"):"2.0.3"!==e&&h("Found unrecognised IOF XML data format '"+e+"'");t=t.attr("status");r(t)||"complete"===t.toLowerCase()||i("Only complete IOF data supported; snapshot and delta are not supported")},readClassName:function(t){return $("> ClassShortName",t).text()},readTeamName:function(t){return $("> TeamName",t).text()},readTeamMemberResults:function(t){return $("> PersonResult",t)},readCourseFromClass:function(t,e){var s=$("> ClassShortName",t).text(),n=$("> PersonResult > Result",t).first(),i=null;return 0<n.length&&(0<(n=(t=$("> CourseLength",n)).text()).length&&(i=parseFloat(n),isFinite(i)?r(t=t.attr("unit"))||"m"===t?i/=1e3:"km"===t||("ft"===t?i/=3280:(e.push("Course '"+s+"' gives its length in a unit '"+t+"', but this unit was not recognised"),i=null)):(e.push("Course '"+s+"' specifies a course length that was not understood: '"+n+"'"),i=null))),{id:null,name:s,length:i,climb:null,numberOfControls:null}},getCompetitorNameElement:function(t){return $("> Person > PersonName",t)},readClubName:function(t){var e=$("> Club > ShortName",t).text();return""===e?$("> Club > Name",t).text():e},readDateOfBirth:function(t){return $("> Person > BirthDate > Date",t).text()},readStartTime:function(t){t=$("> StartTime > Clock",t).text();return""===t?null:s(t)},readTotalTime:function(t){t=$("> Time",t).text();return""===t?null:s(t)},getStatus:function(t){t=$("> CompetitorStatus",t);return 1===t.length?t.attr("value"):""},StatusNonCompetitive:"NotCompeting",StatusNonStarter:"DidNotStart",StatusNonFinisher:"DidNotFinish",StatusDisqualified:"Disqualified",StatusOverMaxTime:"OverTime",isAdditional:function(){return!1},readSplitTime:function(t){var e=$("> ControlCode",t).text();""===e&&(e=$("> Control > ControlCode",t).text()),""===e&&i("Control code missing for control");t=$("> Time",t).text();return{code:e,time:""===t?null:s(t)}}},e=/^\d\d\d\d-?\d\d-?\d\dT?(\d\d):?(\d\d)(?::?(\d\d))?/,n={isOfThisVersion:function(t){return 0<=t.indexOf("http://www.orienteering.org/datastandard/3.0")},checkVersion:function(t){var e=t.attr("iofVersion");r(e)?h("Could not find IOF version number"):"3.0"!==e&&h("Found unrecognised IOF XML data format '"+e+"'");t=t.attr("status");r(t)||"complete"===t.toLowerCase()||i("Only complete IOF data supported; snapshot and delta are not supported")},readClassName:function(t){return $("> Class > Name",t).text()},readTeamName:function(t){return $("> Name",t).text()},readTeamMemberResults:function(t){return $("> TeamMemberResult",t)},readCourseFromClass:function(t,e){var s,n=$("> Course",t),i=$("> Id",n).text()||null,r=$("> Name",n).text(),t=$("> Length",n).text();""===t?s=null:(s=parseInt(t,10),o(s)?(e.push("Course '"+r+"' specifies a course length that was not understood: '"+t+"'"),s=null):s/=1e3);t=$("> NumberOfControls",n).text(),t=parseInt(t,10);o(t)&&(t=null);n=$("> Climb",n).text(),n=parseInt(n,10);return o(n)&&(n=null),{id:i,name:r,length:s,climb:n,numberOfControls:t}},getCompetitorNameElement:function(t){return $("> Person > Name",t)},readClubName:function(t){var e=$("> Organisation > ShortName",t).text();return""===e?$("> Organisation > Name",t).text():e},readDateOfBirth:function(t){t=$("> Person > BirthDate",t).text(),t=g.exec(t);return null===t?null:parseInt(t[0],10)},readStartTime:function(t){t=$("> StartTime",t).text(),t=e.exec(t);return null===t?null:60*parseInt(t[1],10)*60+60*parseInt(t[2],10)+(r(t[3])?0:parseInt(t[3],10))},readTime:function(t){t=parseFloat(t);return isFinite(t)?t:null},readTotalTime:function(t){t=$("> Time",t).text();return n.readTime(t)},getStatus:function(t){return $("> Status",t).text()},StatusNonCompetitive:"NotCompeting",StatusNonStarter:"DidNotStart",StatusNonFinisher:"DidNotFinish",StatusDisqualified:"Disqualified",StatusOverMaxTime:"OverTime",isAdditional:function(t){return"Additional"===t.attr("status")},readSplitTime:function(t){var e,s=$("> ControlCode",t).text();return""===s&&i("Control code missing for control"),{code:s,time:"Missing"===t.attr("status")||""===(e=$("> Time",t).text())?null:n.readTime(e)}}},C=[t,n];function T(t,e,s,n){var i=$(t),r=s.getCompetitorNameElement(i),o=(h=r,u=$("> Given",h).text(),h=$("> Family",h).text(),""===u?h:""===h?u:u+" "+h);if(""===o)return n.push("Could not find a name for a competitor"),null;var l=s.readClubName(i),a=s.readDateOfBirth(i),t=g.exec(a),r=null===t?null:parseInt(t[0],10),u=$("> Person",i).attr("sex"),h=$("Result",i);if(0===h.length)return n.push("Could not find any result information for competitor '"+o+"'"),null;a=s.readStartTime(h),t=s.readTotalTime(h),i=s.getStatus(h),n=$("> SplitTime",h).toArray().filter(function(t){return!s.isAdditional($(t))}).map(function(t){return s.readSplitTime($(t))}),h=n.map(function(t){return t.code}),n=n.map(function(t){return t.time});n.unshift(0),n.push(i===s.StatusNonStarter?null:t);l=new p(o,l);null!==r&&l.setYearOfBirth(r),"M"!==u&&"F"!==u||l.setGender(u);l=c(e,a,n,l);return"OK"===i&&null!==t&&0<=n.indexOf(null)?l.setOKDespiteMissingTimes():i===s.StatusNonCompetitive?l.setNonCompetitive():i===s.StatusNonStarter?l.setNonStarter():i===s.StatusNonFinisher?l.setNonFinisher():i===s.StatusDisqualified?l.disqualify():i===s.StatusOverMaxTime&&l.setOverMaxTime(),{result:l,controls:h}}function v(t,e,s){var n=$(t),i={name:null,results:[],teamSize:null,controls:[],course:null};i.course=e.readCourseFromClass(n,s);t=e.readClassName(n);""===t&&(t="<unnamed class>"),i.name=t,i.course.numbersOfControls=null;var r=$("> PersonResult",n),o=$("> TeamResult",n);if(0<r.length&&0<o.length)return s.push("Class '"+t+"' has a combination of relay teams and individual results"),null;if(0<r.length)for(var l=0;l<r.length;l+=1)!function(t,e,s,n,i){if(null!==(n=T(t,e,n,i))){var r=n.result,o=n.controls;0!==s.results.length||r.isNonStarter&&0===o.length||(s.controls=o,null===s.course.numberOfControls&&(s.course.numberOfControls=s.controls.length));var l=r.getAllOriginalCumulativeTimes().length-2,a=null;if(!r.isNonStarter||0!=l)if(l!==s.course.numberOfControls)a="Competitor '"+r.owner.name+"' in class '"+s.name+"' has an unexpected number of controls: expected "+s.course.numberOfControls+", actual "+l;else for(var u=0;u<l;u+=1)if(s.controls[u]!==o[u]){a="Competitor '"+r.owner.name+"' has an unexpected control code at control "+(u+1)+": expected '"+s.controls[u]+"', actual '"+o[u]+"'";break}null===a?s.results.push(r):i.push(a)}}(r[l],l+1,i,e,s);else{if(!(0<o.length))return s.push("Class '"+t+"' has no competitors"),null;for(var a=0;a<o.length;a+=1)!function(t,e,s,n,i){var r=n.readTeamName(t),o=n.readClubName(t),l=n.readTeamMemberResults(t);if(0!==l.length)if(0!==s.results.length||1!==l.length){for(var a=[],u=[],h=0;h<l.length;h+=1){var c=T(l[h],e,n,i);if(null===c)return;a.push(c.result),u.push(c.controls)}for(h=1;h<l.length;h+=1){var p=$("> Result > FinishTime",l[h-1]).text(),d=$("> Result > StartTime",l[h]).text();if(!a[h].isNonStarter&&p!==d)return i.push("In team "+(""===r?"(unnamed team)":r)+" in class '"+s.name+"', "+a[h-1].owner.name+" does not finish at the same time as "+a[h].owner.name+" starts")}t=u.map(function(t){return t.length});if(0===s.results.length&&(s.teamSize=a.length,null===s.course.numbersOfControls&&(s.course.numbersOfControls=t)),a.length!==s.teamSize)i.push("Team "+(""===r?"(unnamed team)":"'"+r+"'")+" in class '"+s.name+"' has an unexpected number of members: expected "+s.teamSize+" but was actually "+a.length);else{for(var m=null,o=S(e,a,new y(r,o)),f=0;f<a.length;f+=1){var g=s.course.numbersOfControls[f],C=a[f],v=C.getAllOriginalCumulativeTimes().length-2;if(v!==g){m="Competitor '"+C.owner.name+"' in team '"+r+"' in class '"+s.name+"' has an unexpected number of controls: expected "+g+", actual "+v;break}}null===m?s.results.push(o):i.push(m)}}else i.push("Ignoring team "+(""===r?"(unnamed team)":r)+" with only a single member");else i.push("Ignoring team "+(""===r?"(unnamed team)":r)+" with no members")}(o[a],a+1,i,e,s)}return null===i.course.id&&0<i.controls.length&&(i.course.id=i.controls.join(",")),i}SplitsBrowser.Input.IOFXml={parseEventData:function(t){var e,s,r=function(t){for(var e=0;e<C.length;e+=1){var s=C[e];if(s.isOfThisVersion(t))return s}h("Data apparently not of any recognised IOF XML format")}(t),n=function(t){var e;try{e=$.parseXML(t)}catch(t){i("XML data not well-formed")}return 0===$("> *",$(e)).length&&i("XML data not well-formed: "+t),e}(t);e=n,s=r,t=$("> *",e),"ResultList"!==(e=t.prop("tagName"))&&h("Root element of XML document does not have expected name 'ResultList', got '"+e+"'"),s.checkVersion(t),0===(n=$("> ResultList > ClassResult",$(n)).toArray()).length&&i("No class result elements found");var o=[],l=[],a=d3.map(),u=[];return n.forEach(function(t){var e,s,n,i=v(t,r,u);null!==i&&(e=i.course,t=null!==i.teams&&null!==i.course.numbersOfControls&&0<i.course.numbersOfControls.length?(
n=i.course.numbersOfControls.reduce(function(t,e){return t+e},0)+i.teamSize-1,!(s=i.controls=null)):(n=i.controls.length,s=e.id+","+i.controls.join(","),!1),n=new d(i.name,n,i.results),t&&n.setIsTeamClass(i.course.numbersOfControls),o.push(n),null!==e.id&&null!==s&&a.has(s)?a.get(s).classes.push(n):(e.classes=[n],e.controls=i.controls,l.push(e),null!==e.id&&a.set(s,e)))}),n=l.map(function(t){var e=new m(t.name,t.classes,t.length,t.climb,t.controls);return t.classes.forEach(function(t){t.setCourse(e)}),e}),new f(o,n,u)}}}(),function(){"use strict";var n=[SplitsBrowser.Input.CSV.parseEventData,SplitsBrowser.Input.OE.parseEventData,SplitsBrowser.Input.Html.parseEventData,SplitsBrowser.Input.AlternativeCSV.parseTripleColumnEventData,SplitsBrowser.Input.IOFXml.parseEventData];SplitsBrowser.Input.parseEventData=function(t){for(var e=0;e<n.length;e+=1){var s=n[e];try{return s(t)}catch(t){if("WrongFileFormat"!==t.name)throw t}}return null}}(),function(){"use strict";function t(t,e){this.parent=t,this.alerter=e,this.handler=null,this.resultSelection=null,this.lastFilterString="",this.allResults=[],this.allResultDetails=[],this.dragging=!1,this.dragStartResultIndex=null,this.currentDragResultIndex=null,this.allResultDivs=[],this.inverted=!1,this.hasTeamData=!1,this.selectedLegIndex=null,this.placeholderDiv=null,this.changeHandlers=[],this.containerDiv=d3.select(t).append("div").attr("id","resultListContainer"),this.buttonsPanel=this.containerDiv.append("div");var s=this;this.allButton=this.buttonsPanel.append("button").attr("id","selectAllResults").style("width","50%").on("click",function(){s.selectAllFiltered()}),this.noneButton=this.buttonsPanel.append("button").attr("id","selectNoResults").style("width","50%").on("click",function(){s.selectNoneFiltered()}),$(this.noneButton.node()).dblclick(function(){s.selectNone()}),this.buttonsPanel.append("br"),this.crossingRunnersButton=this.buttonsPanel.append("button").attr("id","selectCrossingRunners").style("width","100%").on("click",function(){s.selectCrossingRunners()}).style("display","none"),this.filter=this.buttonsPanel.append("input").attr("type","text"),this.filter.on("input",function(){s.updateFilterIfChanged()}).on("keyup",function(){s.updateFilterIfChangedDelayed()}).on("mouseup",function(){s.updateFilterIfChangedDelayed()}),this.listDiv=this.containerDiv.append("div").attr("id","resultList"),this.listDiv.on("mousedown",function(){s.startDrag(-1)}).on("mousemove",function(){s.mouseMove(-1)}).on("mouseup",function(){s.stopDrag()}),d3.select(document.body).on("mouseup",function(){s.stopDrag()}),this.setMessages()}var e=SplitsBrowser.getMessage,s=SplitsBrowser.getMessageWithFormatting;function o(t){return t.toLowerCase().replace(/\W/g,"")}t.prototype.setMessages=function(){this.allButton.text(e("SelectAllCompetitors")),this.noneButton.text(e("SelectNoCompetitors")),this.crossingRunnersButton.text(e("SelectCrossingRunners")),this.filter.attr("placeholder",e("CompetitorListFilter"))},t.prototype.retranslate=function(){this.setMessages(),null!==this.placeholderDiv&&(this.setPlaceholderDivText(),this.fireChangeHandlers())},t.prototype.setPlaceholderDivText=function(){this.placeholderDiv.text(e(this.hasTeamData?"NoTeamsStarted":"NoCompetitorsStarted"))},t.prototype.registerChangeHandler=function(t){-1===this.changeHandlers.indexOf(t)&&this.changeHandlers.push(t)},t.prototype.deregisterChangeHandler=function(t){t=this.changeHandlers.indexOf(t);-1<t&&this.changeHandlers.splice(t,1)},t.prototype.fireChangeHandlers=function(){this.changeHandlers.forEach(function(t){t()},this)},t.prototype.isMouseOffBottomOfResultList=function(){return null===this.lastVisibleDiv||d3.mouse(this.lastVisibleDiv)[1]>=$(this.lastVisibleDiv).height()},t.prototype.getDragClassName=function(){return this.inverted?"dragDeselected":"dragSelected"},t.prototype.startDrag=function(t){if(1===d3.event.which){this.dragStartResultIndex=t,this.currentDragResultIndex=t,this.allResultDivs=$("div.result");var e=this.allResultDivs.filter(":visible");if(this.lastVisibleDiv=0===e.length?null:e[e.length-1],this.inverted=d3.event.shiftKey,-1===t){if(!this.isMouseOffBottomOfResultList())return}else d3.select(this.allResultDivs[t]).classed(this.getDragClassName(),!0);d3.event.stopPropagation(),this.dragging=!0}},t.prototype.mouseMove=function(t){if(this.dragging&&(d3.event.stopPropagation(),t!==this.currentDragResultIndex)){var e,s,n=this.getDragClassName();if(d3.selectAll("div.result."+n).classed(n,!1),-1===this.dragStartResultIndex&&-1===t)return;if(-1===t&&!this.isMouseOffBottomOfResultList())return;s=-1===this.dragStartResultIndex||-1===t?(e=this.dragStartResultIndex+t- -1,this.allResultDivs.length-1):(e=Math.min(this.dragStartResultIndex,t),Math.max(this.dragStartResultIndex,t));for(var i=[],r=e;r<=s;r+=1)this.allResultDetails[r].visible&&i.push(this.allResultDivs[r]);d3.selectAll(i).classed(n,!0),this.currentDragResultIndex=t}},t.prototype.stopDrag=function(){if(this.dragging){this.dragging=!1;for(var t=[],e=this.getDragClassName(),s=0;s<this.allResultDivs.length;s+=1)$(this.allResultDivs[s]).hasClass(e)&&t.push(s);d3.selectAll("div.result."+e).classed(e,!1),d3.event.currentTarget===document||-1===this.currentDragResultIndex&&!this.isMouseOffBottomOfResultList()||(1===t.length?this.toggleResult(t[0]):this.inverted?this.resultSelection.bulkDeselect(t):this.resultSelection.bulkSelect(t)),this.dragStartResultIndex=null,this.currentDragResultIndex=null,d3.event.stopPropagation()}},t.prototype.width=function(){return $(this.containerDiv.node()).width()},t.prototype.setHeight=function(t){$(this.listDiv.node()).height(t-$(this.buttonsPanel.node()).height())},t.prototype.getAllVisibleIndexes=function(){return d3.range(this.allResultDetails.length).filter(function(t){return this.allResultDetails[t].visible},this)},t.prototype.selectAllFiltered=function(){this.resultSelection.bulkSelect(this.getAllVisibleIndexes())},t.prototype.selectNoneFiltered=function(){this.resultSelection.bulkDeselect(this.getAllVisibleIndexes())},t.prototype.selectNone=function(){this.resultSelection.selectNone()},t.prototype.isSelected=function(t){return null!==this.resultSelection&&this.resultSelection.isSelected(t)},t.prototype.selectCrossingRunners=function(){var t,e;this.resultSelection.selectCrossingRunners(this.allResultDetails,this.selectedLegIndex),this.resultSelection.isSingleRunnerSelected()&&(t=this.allResults[this.resultSelection.getSingleRunnerIndex()].getOwnerNameForLeg(this.selectedLegIndex),e=0<this.lastFilterString.length?"RaceGraphNoCrossingRunnersFiltered":"RaceGraphNoCrossingRunners",this.alerter(s(e,{$$NAME$$:t})))},t.prototype.enableOrDisableCrossingRunnersButton=function(){this.crossingRunnersButton.node().disabled=!this.resultSelection.isSingleRunnerSelected()},t.prototype.setChartType=function(t){this.crossingRunnersButton.style("display",t.isRaceGraph?"block":"none")},t.prototype.selectionChanged=function(){var s=this;this.listDiv.selectAll("div.result").data(d3.range(this.resultSelection.count)).classed("selected",function(t,e){return s.isSelected(e)})},t.prototype.toggleResult=function(t){this.resultSelection.toggle(t)},t.prototype.formatTooltip=function(t){var e=[t.owner.name];t.owner.members.forEach(function(t){e.push(t.name)});t=null===this.selectedLegIndex?0:this.selectedLegIndex+1;return e[t]="> "+e[t],e.join("\n")},t.prototype.setResultList=function(t,e,s,n){var i;this.allResults=t,this.hasTeamData=s,this.selectedLegIndex=n,this.allResultDetails=this.allResults.map(function(t){return{result:t,normedName:o(t.owner.name),visible:!0}}),i=s?this.formatTooltip.bind(this):function(){return null},null!==this.placeholderDiv&&(this.placeholderDiv.remove(),this.placeholderDiv=null);var t=this.listDiv.selectAll("div.result").data(this.allResults),r=this;t.enter().append("div").classed("result",!0).classed("selected",function(t,e){return r.isSelected(e)}),t.selectAll("span").remove(),t=this.listDiv.selectAll("div.result").data(this.allResults).attr("title",i),e&&t.append("span").classed("resultClassLabel",!0).text(function(t){return t.className}),t.append("span").classed("nonfinisher",function(t){return!t.completed()}).text(function(t){var e=(s&&null!==n?t.owner.members[n]:t.owner).name;return t.completed()?""===e?"":e:"* "+e}),t.exit().remove(),0===this.allResults.length&&(this.placeholderDiv=this.listDiv.append("div").classed("resultListPlaceholder",!0),this.setPlaceholderDivText()),this.allButton.property("disabled",0===this.allResults.length),this.noneButton.property("disabled",0===this.allResults.length),this.filter.property("disabled",0===this.allResults.length),t.on("mousedown",function(t,e){r.startDrag(e)}).on("mousemove",function(t,e){r.mouseMove(e)}).on("mouseup",function(){r.stopDrag()}),this.updateFilter()},t.prototype.setSelection=function(t){null!==this.resultSelection&&this.resultSelection.deregisterChangeHandler(this.handler);var e=this;this.resultSelection=t,this.handler=function(){e.selectionChanged()},this.resultSelection.registerChangeHandler(this.handler),this.selectionChanged()},t.prototype.getFilterText=function(){return this.filter.node().value},t.prototype.setFilterText=function(t){this.filter.node().value=t,this.updateFilterIfChanged()},t.prototype.updateFilter=function(){var e=o(this.filter.node().value);this.allResultDetails.forEach(function(t){t.visible=0<=t.normedName.indexOf(e)});var s=this;this.listDiv.selectAll("div.result").style("display",function(t,e){return s.allResultDetails[e].visible?null:"none"})},t.prototype.updateFilterIfChanged=function(){var t=this.getFilterText();t!==this.lastFilterString&&(this.updateFilter(),this.lastFilterString=t,this.fireChangeHandlers())},t.prototype.updateFilterIfChangedDelayed=function(){var t=this;setTimeout(function(){t.updateFilterIfChanged()},1)},SplitsBrowser.Controls.ResultList=t}(),function(){"use strict";var t=SplitsBrowser.getMessage,s=SplitsBrowser.getAllLanguages,n=SplitsBrowser.getLanguage,i=SplitsBrowser.getLanguageName,e=SplitsBrowser.setLanguage;function r(t){var e;this.changeHandlers=[],this.label=null,this.dropDown=null,this.allLanguages=s(),this.allLanguages.length<2||(d3.select(t).append("div").classed("topRowStartSpacer",!0),t=d3.select(t).append("div").classed("topRowStart",!0),this.label=t.append("span"),(e=this).dropDown=t.append("select").node(),$(this.dropDown).bind("change",function(){e.onLanguageChanged()}),(t=d3.select(this.dropDown).selectAll("option").data(this.allLanguages)).enter().append("option"),(t=d3.select(this.dropDown).selectAll("option").data(this.allLanguages)).attr("value",function(t){return t}).text(function(t){return i(t)}),t.exit().remove(),this.setLanguage(n()),this.setMessages())}r.prototype.setMessages=function(){this.label.text(t("LanguageSelectorLabel"))},r.prototype.registerChangeHandler=function(t){-1===this.changeHandlers.indexOf(t)&&this.changeHandlers.push(t)},r.prototype.setLanguage=function(t){t=this.allLanguages.indexOf(t);0<=t&&(this.dropDown.selectedIndex=t,this.onLanguageChanged())},r.prototype.onLanguageChanged=function(){e(this.dropDown.options[this.dropDown.selectedIndex].value),this.changeHandlers.forEach(function(t){t()})},SplitsBrowser.Controls.LanguageSelector=r}(),function(){"use strict";var s=SplitsBrowser.throwInvalidData,n=SplitsBrowser.getMessage;function t(t){this.changeHandlers=[],this.otherClassesEnabled=!0;var e=d3.select(t).append("div").classed("topRowStart",!0);this.labelSpan=e.append("span");var n=this;this.dropDown=e.append("select").node(),$(this.dropDown).bind("change",function(){n.updateOtherClasses(d3.set()),n.onSelectionChanged()}),this.otherClassesContainer=d3.select(t).append("div").attr("id","otherClassesContainer").classed("topRowStart",!0).style("display","none"),this.otherClassesCombiningLabel=this.otherClassesContainer.append("span").classed("otherClassCombining",!0),this.otherClassesSelector=this.otherClassesContainer.append("div").classed("otherClassSelector",!0).style("display","inline-block"),this.otherClassesSpan=this.otherClassesSelector.append("span"),this.otherClassesList=d3.select(t).append("div").classed("otherClassList",!0).classed("transient",!0).style("position","absolute").style("display","none"),this.otherClassesSelector.on("click",function(){n.showHideClassSelector()}),this.setClasses([]),this.selectedOtherClassIndexes=d3.set(),$(document).click(function(t){var e,s=n.otherClassesList.node();"none"!==s.style.display&&((e=$("div.otherClassList,div.otherClassSelector")).is(t.target)||0!==e.has(t.target).length||(s.style.display="none"))}),this.setMessages()}t.prototype.setMessages=function(){this.labelSpan.text(n("ClassSelectorLabel")),this.otherClassesCombiningLabel.text(n("AdditionalClassSelectorLabel"))},t.prototype.setOtherClassesEnabled=function(t){this.otherClassesCombiningLabel.classed("disabled",!t),this.otherClassesSelector.classed("disabled",!t),this.otherClassesEnabled=t},t.prototype.setClasses=function(t){var e;$.isArray(t)?(e=0===(this.classes=t).length?(this.dropDown.disabled=!0,[n("NoClassesLoadedPlaceholder")]):(this.dropDown.disabled=!1,t.map(function(t){return t.name})),(t=d3.select(this.dropDown).selectAll("option").data(e)).enter().append("option"),(t=d3.select(this.dropDown).selectAll("option").data(e)).attr("value",function(t,e){return e.toString()}).text(function(t){return t}),t.exit().remove(),this.updateOtherClasses(d3.set())):s("ClassSelector.setClasses: classes is not an array")},t.prototype.registerChangeHandler=function(t){-1===this.changeHandlers.indexOf(t)&&this.changeHandlers.push(t)},t.prototype.selectClasses=function(t){0<t.length&&t.every(function(t){return 0<=t&&t<this.dropDown.options.length},this)&&(this.dropDown.selectedIndex=t[0],this.updateOtherClasses(d3.set(t.slice(1))),this.onSelectionChanged())},t.prototype.getSelectedClasses=function(){if(this.dropDown.disabled)return[];var e=[this.dropDown.selectedIndex];return this.selectedOtherClassIndexes.each(function(t){e.push(parseInt(t,10))}),e},t.prototype.onSelectionChanged=function(){var e=this.getSelectedClasses();this.changeHandlers.forEach(function(t){t(e)})},t.prototype.updateOtherClassText=function(){var t=this.selectedOtherClassIndexes.values();t.sort(d3.ascending),t=0===t.length?n("NoAdditionalClassesSelectedPlaceholder"):t.map(function(t){return this.classes[t].name},this).join(", "),this.otherClassesSpan.text(t)},t.prototype.updateOtherClasses=function(e){this.otherClassesList.style("display","none"),this.selectedOtherClassIndexes=e,this.updateOtherClassText(),$("div.otherClassItem").off("click");var s=this,n=(0<this.classes.length?(i=this.classes[this.dropDown.selectedIndex]).course.getOtherClasses(i):[]).map(function(t){return this.classes.indexOf(t)},this),t=this.otherClassesList.selectAll("div").data(n);t.enter().append("div").classed("otherClassItem",!0),(t=this.otherClassesList.selectAll("div").data(n)).attr("id",function(t){return"courseClassIdx_"+t}).classed("selected",function(t){return e.has(t)}).text(function(t){return s.classes[t].name}),t.exit().remove(),0<n.length?this.otherClassesContainer.style("display",null):this.otherClassesContainer.style("display","none");var i=$(this.otherClassesSelector.node()).offset(),t=$(this.otherClassesSelector.node()).outerHeight();this.otherClassesList.style("left",i.left+"px").style("top",i.top+t+"px"),$("div.otherClassItem").each(function(t,e){$(e).on("click",function(){s.toggleOtherClass(n[t])})})},t.prototype.showHideClassSelector=function(){this.otherClassesEnabled&&this.otherClassesList.style("display","none"===this.otherClassesList.style("display")?null:"none")},t.prototype.toggleOtherClass=function(t){this.selectedOtherClassIndexes.has(t)?this.selectedOtherClassIndexes.remove(t):this.selectedOtherClassIndexes.add(t),d3.select("div#courseClassIdx_"+t).classed("selected",this.selectedOtherClassIndexes.has(t)),this.updateOtherClassText(),this.onSelectionChanged()},t.prototype.retranslate=function(){this.setMessages(),0===this.classes.length&&d3.select(this.dropDown.options[0]).text(n("NoClassesLoadedPlaceholder")),0===this.selectedOtherClassIndexes.values().length&&this.otherClassesSpan.text(n("NoAdditionalClassesSelectedPlaceholder"))},SplitsBrowser.Controls.ClassSelector=t}(),function(){"use strict";var s=SplitsBrowser.getMessage,n=SplitsBrowser.getMessageWithFormatting,t=[{nameKey:"CompareWithWinner",selector:function(t){return t.getWinnerCumTimes()},requiresWinner:!0,percentage:""},{nameKey:"CompareWithFastestTime",selector:function(t){return t.getFastestCumTimes()},requiresWinner:!1,percentage:""}];[5,25,50,100].forEach(function(e){t.push({nameKey:"CompareWithFastestTimePlusPercentage",selector:function(t){return t.getFastestCumTimesPlusPercentage(e)},requiresWinner:!1,percentage:e})});var i=t.slice(0);i.push({nameKey:"CompareWithAnyRunner",selector:null,requiresWinner:!0,percentage:""});var e=t.slice(0);e.push({nameKey:"CompareWithAnyTeam",selector:null,requiresWinner:!0,percentage:""});function r(t,e){this.changeHandlers=[],this.classes=null,this.currentResultIndex=null,this.previousResultList=null,this.parent=t,this.alerter=e,this.hasWinner=!1,this.previousSelectedIndex=-1,this.courseClassSet=null,this.selectedLegIndex=null,this.comparisonOptions=i;e=d3.select(t).append("div").classed("topRowStart",!0);this.comparisonSelectorLabel=e.append("span").classed("comparisonSelectorLabel",!0);var s=this;this.dropDown=e.append("select").attr("id","comparisonSelector").node(),$(this.dropDown).bind("change",function(){s.onSelectionChanged()}),this.optionsList=d3.select(this.dropDown).selectAll("option").data(this.comparisonOptions),this.optionsList.enter().append("option"),this.optionsList=d3.select(this.dropDown).selectAll("option").data(this.comparisonOptions),this.optionsList.attr("value",function(t,e){return e.toString()}),this.optionsList.exit().remove(),this.resultDiv=d3.select(t).append("div").classed("topRowStart",!0).style("display","none").style("padding-left","20px"),this.resultSpan=this.resultDiv.append("span").attr("id","resultSpan").classed("comparisonSelectorLabel",!0),this.resultDropDown=this.resultDiv.append("select").attr("id","resultSelector").node(),$(this.resultDropDown).bind("change",function(){s.onSelectionChanged()}),this.dropDown.selectedIndex=1,this.previousSelectedIndex=1,this.setMessages()}r.prototype.setMessages=function(){this.comparisonSelectorLabel.text(s("ComparisonSelectorLabel")),this.setCompareWithAnyLabel(),this.optionsList.text(function(t){return n(t.nameKey,{$$PERCENT$$:t.percentage})})},r.prototype.setCompareWithAnyLabel=function(){null!==this.courseClassSet&&this.courseClassSet.hasTeamData()&&null===this.selectedLegIndex?this.resultSpan.text(s("CompareWithAnyTeamLabel")):this.resultSpan.text(s("CompareWithAnyRunnerLabel"))},r.prototype.registerChangeHandler=function(t){-1===this.changeHandlers.indexOf(t)&&this.changeHandlers.push(t)},r.prototype.isAnyResultSelected=function(){return this.dropDown.selectedIndex===this.comparisonOptions.length-1},r.prototype.setCourseClassSet=function(t){this.courseClassSet=t,this.selectedLegIndex=null,this.comparisonOptions=t.hasTeamData()?e:i,this.optionsList=d3.select(this.dropDown).selectAll("option").data(this.comparisonOptions),this.optionsList.text(function(t){return n(t.nameKey,{$$PERCENT$$:t.percentage})}),this.setResults(),this.setCompareWithAnyLabel()},r.prototype.setSelectedLeg=function(t){this.selectedLegIndex=t,this.setResults(),this.setCompareWithAnyLabel(),this.optionsList.data(null===t?e:i),this.optionsList.text(function(t){return n(t.nameKey,{$$PERCENT$$:t.percentage})})},r.prototype.setResults=function(){var e=this.courseClassSet.allResults,s=d3.range(e.length).filter(function(t){return e[t].completed()}),t=e.filter(function(t){return t.completed()});this.hasWinner=0<t.length;var n=this.selectedLegIndex,i=d3.select(this.resultDropDown).selectAll("option").data(t);i.enter().append("option"),(i=d3.select(this.resultDropDown).selectAll("option").data(t)).attr("value",function(t,e){return s[e].toString()}).text(function(t){return t.getOwnerNameForLeg(n)}),i.exit().remove(),null===this.previousResultList?this.currentResultIndex=0:this.hasWinner?(i=this.previousResultList[this.currentResultIndex],i=e.indexOf(i),this.currentResultIndex=Math.max(i,0)):this.comparisonOptions[this.dropDown.selectedIndex].requiresWinner&&this.setComparisonType(1,null),this.resultDropDown.selectedIndex=this.currentResultIndex,this.previousResultList=e},r.prototype.setEnabled=function(t){d3.select(this.parent).selectAll("span.comparisonSelectorLabel").classed("disabled",!t),this.dropDown.disabled=!t,this.resultDropDown.disabled=!t},r.prototype.getComparisonFunction=function(){if(this.isAnyResultSelected()){var e=this;return function(t){return t.getCumulativeTimesForResult(e.currentResultIndex)}}return this.comparisonOptions[this.dropDown.selectedIndex].selector},r.prototype.getComparisonType=function(){var t=this.isAnyResultSelected()?(this.resultDropDown.selectedIndex<0&&(this.resultDropDown.selectedIndex=0),this.courseClassSet.allResults[this.resultDropDown.selectedIndex]):null;return{index:this.dropDown.selectedIndex,result:t}},r.prototype.setComparisonType=function(t,e){0<=t&&t<this.comparisonOptions.length&&(t===this.comparisonOptions.length-1?0<=(e=this.courseClassSet.allResults.indexOf(e))&&(this.dropDown.selectedIndex=t,this.resultDropDown.selectedIndex=e,this.onSelectionChanged()):(this.dropDown.selectedIndex=t,this.onSelectionChanged()))},r.prototype.onSelectionChanged=function(){var t=Math.max(this.resultDropDown.selectedIndex,0),e=this.comparisonOptions[this.dropDown.selectedIndex];!this.hasWinner&&e.requiresWinner?(this.alerter(n(null!==this.courseClassSet&&this.courseClassSet.hasTeamData()?"CannotCompareAsNoWinnerTeam":"CannotCompareAsNoWinner",{$$OPTION$$:s(e.nameKey)})),this.dropDown.selectedIndex=this.previousSelectedIndex):(this.resultDiv.style("display",this.isAnyResultSelected()?null:"none"),this.currentResultIndex=0===this.resultDropDown.options.length?0:parseInt(this.resultDropDown.options[t].value,10),this.previousSelectedIndex=this.dropDown.selectedIndex,this.changeHandlers.forEach(function(t){t(this.getComparisonFunction())},this))},SplitsBrowser.Controls.ComparisonSelector=r}(),function(){"use strict";var s=SplitsBrowser.getMessage,n="statisticCheckbox",i=["TotalTime","SplitTime","BehindFastest","TimeLoss"],r=["StatisticsTotalTime","StatisticsSplitTime","StatisticsBehindFastest","StatisticsTimeLoss"],o=["SplitTime","TimeLoss"];function t(t){this.div=d3.select(t).append("div").classed("topRowEnd",!0).attr("id","statisticSelector");t=this.div.selectAll("div").data(i).enter().append("div").style("display","inline-block");t.append("input").attr("id",function(t){return n+t}).attr("type","checkbox").attr("checked",function(t){return 0<=o.indexOf(t)?"checked":null}),this.statisticLabels=t.append("label").attr("for",function(t){return n+t}).classed("statisticsSelectorLabel",!0);var e=this;$("input",this.div.node()).bind("change",function(){return e.onCheckboxChanged()}),this.handlers=[],this.setMessages()}t.prototype.setMessages=function(){this.statisticLabels.text(function(t,e){return s(r[e])})},t.prototype.clearAll=function(){this.div.selectAll("input").attr("checked",null)},t.prototype.setEnabled=function(t){this.div.selectAll("label.statisticsSelectorLabel").classed("disabled",!t),this.div.selectAll("input").attr("disabled",t?null:"disabled")},t.prototype.registerChangeHandler=function(t){-1===this.handlers.indexOf(t)&&this.handlers.push(t)},t.prototype.deregisterChangeHandler=function(t){t=this.handlers.indexOf(t);-1!==t&&this.handlers.splice(t,1)},t.prototype.getVisibleStatistics=function(){var s={};return this.div.selectAll("input").nodes().forEach(function(t,e){s[i[e]]=t.checked}),s},t.prototype.setVisibleStatistics=function(s){this.div.selectAll("input").nodes().forEach(function(t,e){t.checked=s[i[e]]||!1}),this.onCheckboxChanged()},t.prototype.onCheckboxChanged=function(){var e=this.getVisibleStatistics();this.handlers.forEach(function(t){t(e)})},SplitsBrowser.Controls.StatisticsSelector=t}(),function(){"use strict";var e=SplitsBrowser.getMessage;function t(t,e){this.changeHandlers=[],this.chartTypes=e,this.raceGraphDisabledNotifier=null,this.lastSelectedIndex=0;t=d3.select(t).append("div").classed("topRowStart",!0);this.labelSpan=t.append("span");var s=this;this.dropDown=t.append("select").node(),$(this.dropDown).bind("change",function(){s.onSelectionChanged()}),this.optionsList=d3.select(this.dropDown).selectAll("option").data(e),this.optionsList.enter().append("option"),this.optionsList=d3.select(this.dropDown).selectAll("option").data(e),this.optionsList.attr("value",function(t,e){return e.toString()}),this.optionsList.exit().remove(),this.setMessages()}t.prototype.setMessages=function(){this.labelSpan.text(e("ChartTypeSelectorLabel")),this.optionsList.text(function(t){return e(t.nameKey)})},t.prototype.setRaceGraphDisabledNotifier=function(t){this.raceGraphDisabledNotifier=t,null!==this.raceGraphDisabledNotifier&&this.chartTypes[this.dropDown.selectedIndex].isRaceGraph&&(this.raceGraphDisabledNotifier(),this.dropDown.selectedIndex=0,this.onSelectionChanged())},t.prototype.registerChangeHandler=function(t){-1===this.changeHandlers.indexOf(t)&&this.changeHandlers.push(t)},t.prototype.getChartType=function(){return this.chartTypes[Math.max(this.dropDown.selectedIndex,0)]},t.prototype.setChartType=function(t){t=this.chartTypes.indexOf(t);0<=t&&(this.dropDown.selectedIndex=t,this.onSelectionChanged())},t.prototype.onSelectionChanged=function(){null!==this.raceGraphDisabledNotifier&&this.chartTypes[this.dropDown.selectedIndex].isRaceGraph&&(this.raceGraphDisabledNotifier(),this.dropDown.selectedIndex=Math.max(this.lastSelectedIndex,0)),this.changeHandlers.forEach(function(t){t(this.chartTypes[this.dropDown.selectedIndex])},this),this.lastSelectedIndex=this.dropDown.selectedIndex},SplitsBrowser.Controls.ChartTypeSelector=t}(),function(){"use strict";var t=SplitsBrowser.getMessage;function e(t){this.parent=t;var e="originalDataCheckbox";this.containerDiv=t.append("div").classed("topRowStart",!0).attr("id","originalDataSelectorContainer"),this.containerDiv.append("div").classed("topRowStartSpacer",!0);var t=this.containerDiv.append("span"),s=this;this.checkbox=t.append("input").attr("type","checkbox").attr("id",e).on("click",function(){s.fireChangeHandlers()}).node(),this.label=t.append("label").attr("for",e).classed("originalDataSelectorLabel",!0),this.handlers=[],this.setMessages()}e.prototype.setMessages=function(){this.label.text(t("ShowOriginalData")),this.containerDiv.attr("title",t("ShowOriginalDataTooltip"))},e.prototype.registerChangeHandler=function(t){-1===this.handlers.indexOf(t)&&this.handlers.push(t)},e.prototype.deregisterChangeHandler=function(t){t=this.handlers.indexOf(t);-1!==t&&this.handlers.splice(t,1)},e.prototype.fireChangeHandlers=function(){this.handlers.forEach(function(t){t(this.checkbox.checked)},this)},e.prototype.isOriginalDataSelected=function(){return this.checkbox.checked},e.prototype.selectOriginalData=function(){this.checkbox.checked=!0,this.fireChangeHandlers()},e.prototype.setVisible=function(t){this.containerDiv.style("display",t?null:"none")},e.prototype.setEnabled=function(t){this.parent.selectAll("label.originalDataSelectorLabel").classed("disabled",!t),this.checkbox.disabled=!t},SplitsBrowser.Controls.OriginalDataSelector=e}(),function(){"use strict";var s=SplitsBrowser.getMessage,n=SplitsBrowser.getMessageWithFormatting;function t(t){this.changeHandlers=[],this.parent=t,this.courseClassSet=null,this.legCount=null,this.containerDiv=t.append("div").attr("id","legSelectorContainer").classed("topRowStart",!0).style("display","none"),this.containerDiv.append("div").classed("topRowStartSpacer",!0),this.legSelectorLabel=this.containerDiv.append("span").classed("legSelectorLabel",!0);var e=this;this.dropDown=this.containerDiv.append("select").attr("id","legSelector").node(),$(this.dropDown).bind("change",function(){e.onSelectionChanged()}),this.options=null,this.dropDown.selectedIndex=0,this.setMessages()}t.prototype.setMessages=function(){this.legSelectorLabel.text(s("LegSelectorLabel")),this.setLegNames()},t.prototype.registerChangeHandler=function(t){-1===this.changeHandlers.indexOf(t)&&this.changeHandlers.push(t)},t.prototype.setLegNames=function(){for(var t=[s("ShowAllLegs")],e=0;e<this.legCount;e+=1)t.push(n("ShowLeg",{$$LEG_NUMBER$$:e+1}));this.options=d3.select(this.dropDown).selectAll("option").data(t),this.options.enter().append("option"),this.options=d3.select(this.dropDown).selectAll("option").data(t),this.options.attr("value",function(t,e){return 0===e?"":e-1}).text(function(t){return t}),this.options.exit().remove()},t.prototype.setCourseClassSet=function(t){this.courseClassSet=t,this.legCount=this.courseClassSet.getLegCount(),null===this.legCount?(this.options=null,d3.select(this.dropDown).selectAll("option").remove(),this.containerDiv.style("display","none")):(this.setLegNames(),this.containerDiv.style("display",null),this.dropDown.selectedIndex=0)},t.prototype.getSelectedLeg=function(){if(null===this.options)return null;var t=Math.max(this.dropDown.selectedIndex,0);return 0===t?null:t-1},t.prototype.setSelectedLeg=function(t){null!==this.options&&(((t=null===t?0:t+1)<0||t>=this.options.size())&&(t=0),this.dropDown.selectedIndex=t,this.onSelectionChanged())},t.prototype.onSelectionChanged=function(){var e=this.getSelectedLeg();this.changeHandlers.forEach(function(t){t(e)})},SplitsBrowser.Controls.LegSelector=t}(),function(){"use strict";var o=SplitsBrowser.formatTime,l=SplitsBrowser.getMessage,a=SplitsBrowser.getMessageWithFormatting,u=SplitsBrowser.Model.Course,t={};t.getFastestSplitsPopupData=function(t,e,s){e=(e=t.getFastestSplitsTo(10,e,s)).map(function(t){return{time:t.split,name:t.name,highlight:!1}}),s=t.hasTeamData()&&null===s?"SelectedClassesPopupPlaceholderTeams":"SelectedClassesPopupPlaceholder";return{title:l("SelectedClassesPopupHeader"),data:e,placeholder:l(s)}},t.getFastestSplitsForLegPopupData=function(t,e,s){var n=t.getCourse(),i=n.getControlCode(s-1),r=n.getControlCode(s),n=i===u.START?l("StartName"):i,s=r===u.FINISH?l("FinishName"):r,s=a("FastestLegTimePopupHeader",{$$START$$:n,$$END$$:s}),o=t.getPrimaryClassName();return{title:s,data:e.getFastestSplitsForLeg(i,r).map(function(t){return{name:t.name,className:t.className,time:t.split,highlight:t.className===o}}),placeholder:null}},t.getResultsVisitingCurrentControlPopupData=function(t,e,s,n){var i=t.getCourse().getControlCode(s),s=Math.round(n)-120,n=Math.round(n)+120,e=e.getResultsAtControlInTimeRange(i,s,n),r=t.getPrimaryClassName(),e=e.map(function(t){return{name:t.name,className:t.className,time:t.time,highlight:t.className===r}}),i=i===u.START?l("StartName"):i===u.FINISH?l("FinishName"):a("ControlName",{$$CODE$$:i});return{title:a("NearbyCompetitorsPopupHeader",{$$START$$:o(s),$$END$$:o(n),$$CONTROL$$:i}),data:e,placeholder:l("NoNearbyCompetitors")}},t.getNextControlData=function(t,e,s){s=Math.min(s,t.controls.length),s=t.getControlCode(s),e=e.getNextControlsAfter(s);return e.sort(function(t,e){return function(t,e){if(t===e)return 0;if(""===t||""===e||t[0]!==e[0])return t<e?-1:1;var s=/^[^0-9]+/.exec(t);if(null!==s&&0<s.length){var n=s[0];if(0<n.length&&n.length<t.length&&e.substring(0,n.length)===n){s=parseInt(t.substring(n.length),10),n=parseInt(e.substring(n.length),10);if(!isNaN(s)&&!isNaN(n))return s-n}}return t<e?-1:1}(t.course.name,e.course.name)}),{thisControl:s===u.START?l("StartName"):a("ControlName",{$$CODE$$:s}),nextControls:e.map(function(t){var e=t.nextControls.slice(0);return e[e.length-1]===u.FINISH&&(e[e.length-1]=l("FinishName")),{course:t.course,nextControls:e.join(", ")}})}},SplitsBrowser.Model.ChartPopupData=t}(),function(){"use strict";var n=SplitsBrowser.formatTime,i=SplitsBrowser.hasProperty;function t(t,e){this.shown=!1,this.mouseIn=!1,this.popupDiv=d3.select(t).append("div"),this.popupDiv.classed("chartPopup",!0).style("display","none").style("position","absolute"),this.dataHeader=this.popupDiv.append("div").classed("chartPopupHeader",!0).append("span");var s,t=this.popupDiv.append("div").classed("chartPopupTableContainer",!0);for(s in this.dataTable=t.append("table"),this.popupDiv.selectAll(".nextControls").style("display","none"),e)i(e,s)&&$(this.popupDiv.node()).on(s,e[s]);var n=this;$(this.popupDiv.node()).mouseenter(function(){n.mouseIn=!0}),$(this.popupDiv.node()).mouseleave(function(){n.mouseIn=!1})}t.prototype.isShown=function(){return this.shown},t.prototype.isMouseIn=function(){return this.mouseIn},t.prototype.setData=function(t,e){this.dataHeader.text(t.title);var s=this.dataTable.selectAll("tr").data(t.data);s.enter().append("tr"),(s=this.dataTable.selectAll("tr").data(t.data)
).classed("highlighted",function(t){return t.highlight}),s.selectAll("td").remove(),s.append("td").text(function(t){return n(t.time)}),e&&s.append("td").text(function(t){return t.className}),s.append("td").text(function(t){return t.name}),s.exit().remove(),0===t.data.length&&null!==t.placeholder&&this.dataTable.append("tr").append("td").text(t.placeholder)},t.prototype.setNextControlData=function(t){this.dataHeader.text(t.thisControl);t=this.dataTable.selectAll("tr").data(t.nextControls);t.enter().append("tr"),t.selectAll("td").remove(),t.classed("highlighted",!1),t.append("td").text(function(t){return t.course.name}),t.append("td").text("--\x3e"),t.append("td").text(function(t){return t.nextControls}),t.exit().remove()},t.prototype.setLocation=function(t){this.popupDiv.style("left",t.x+"px").style("top",t.y+"px")},t.prototype.show=function(t){this.popupDiv.style("display",null),this.shown=!0,this.setLocation(t)},t.prototype.hide=function(){this.popupDiv.style("display","none"),this.shown=!1},t.prototype.height=function(){return $(this.popupDiv.node()).height()},SplitsBrowser.Controls.ChartPopup=t}(),function(){"use strict";var e=18,i=0,r=18,o=53,l="",a=["#FF0000","#4444FF","#00FF00","#000000","#CC0066","#000099","#FFCC00","#884400","#9900FF","#CCCC00","#888800","#CC6699","#00DD00","#3399FF","#BB00BB","#00DDDD","#FF00FF","#0088BB","#888888","#FF99FF","#55BB33"],u=SplitsBrowser.formatTime,h=SplitsBrowser.formatTimeOfDay,c=SplitsBrowser.getMessage,p=SplitsBrowser.isNotNullNorNaN,n=SplitsBrowser.isNaNStrict,t=SplitsBrowser.Model.ChartPopupData,d=SplitsBrowser.Controls.ChartPopup;function m(t,e,s){return s&&null===t&&(e=t=NaN),e=null===e?"-":n(e)?"?":e.toString(),l+u(t)+" ("+e+")"}function f(t,e){return""===e?t:t+" ("+e+")"}function g(t){return t.completed()&&t.isNonCompetitive?c("NonCompetitiveShort"):t.isNonFinisher?c("DidNotFinishShort"):t.isDisqualified?c("DisqualifiedShort"):t.isOverMaxTime?c("OverMaxTimeShort"):t.completed()?"":c("MispunchedShort")}function s(t){this.parent=t,this.xScale=null,this.yScale=null,this.hasData=!1,this.overallWidth=-1,this.overallHeight=-1,this.contentWidth=-1,this.contentHeight=-1,this.numControls=-1,this.selectedIndexes=[],this.currentResultData=null,this.isPopupOpen=!1,this.popupUpdateFunc=null,this.maxStartTimeLabelWidth=0,this.mouseOutTimeout=null,this.selectedIndexesOrderedByLastYValue=[],this.referenceCumTimes=[],this.referenceCumTimesSorted=[],this.referenceCumTimeIndexes=[],this.fastestCumTimes=[],this.selectedLegIndex=null,this.isMouseIn=!1,this.currentControlIndex=null,this.actualControlIndex=null,this.controlLine=null,this.svg=d3.select(this.parent).append("svg").attr("id","chart"),this.svgGroup=this.svg.append("g"),this.setLeftMargin(o);function e(t){n.onMouseMove(t)}function s(t){n.onMouseDown(t)}var n=this,i=function(t){n.onMouseUp(t)};$(this.svg.node()).mouseenter(function(t){n.onMouseEnter(t)}).mousemove(e).mouseleave(function(t){n.onMouseLeave(t)}).mousedown(s).mouseup(i),$(this.svg.node()).contextmenu(function(t){t.preventDefault()}),this.textSizeElement=this.svg.append("text").attr("fill","transparent").attr("id","sb-text-size-element");i={mousemove:e,mousedown:s,mouseup:i};this.popup=new d(t,i),$(document).mouseup(function(){n.popup.hide()})}function C(t){t=t.filter(p);return 0<t.length?d3.max(t):0}s.prototype.setLeftMargin=function(t){this.currentLeftMargin=t,this.svgGroup.attr("transform","translate("+this.currentLeftMargin+","+e+")")},s.prototype.getPopupLocation=function(t){return{x:t.pageX+10,y:Math.max(t.pageY-this.popup.height()/2,0)}},s.prototype.getFastestSplitsPopupData=function(){return t.getFastestSplitsPopupData(this.courseClassSet,this.currentControlIndex,this.selectedLegIndex)},s.prototype.getFastestSplitsForCurrentLegPopupData=function(){return t.getFastestSplitsForLegPopupData(this.courseClassSet,this.eventData,this.currentControlIndex)},s.prototype.setCurrentChartTime=function(t){t=t.pageY-$(this.svg.node()).offset().top-e;this.currentChartTime=Math.round(60*this.yScale.invert(t))+this.referenceCumTimes[this.currentControlIndex]},s.prototype.getResultsVisitingCurrentControlPopupData=function(){return t.getResultsVisitingCurrentControlPopupData(this.courseClassSet,this.eventData,this.currentControlIndex,this.currentChartTime)},s.prototype.getNextControlData=function(){return t.getNextControlData(this.courseClassSet.getCourse(),this.eventData,this.actualControlIndex)},s.prototype.onMouseEnter=function(t){null!==this.mouseOutTimeout&&(clearTimeout(this.mouseOutTimeout),this.mouseOutTimeout=null),this.isMouseIn=!0,this.hasData&&this.updateControlLineLocation(t)},s.prototype.onMouseMove=function(t){this.hasData&&this.isMouseIn&&null!==this.xScale&&this.updateControlLineLocation(t)},s.prototype.onMouseLeave=function(){var t=this;this.mouseOutTimeout=setTimeout(function(){t.popup.isMouseIn()||(t.isMouseIn=!1,t.removeControlLine())},1)},s.prototype.onMouseDown=function(t){var e=this;setTimeout(function(){e.showPopupDialog(t)},1)},s.prototype.onMouseUp=function(t){this.popup.hide(),t.preventDefault()},s.prototype.showPopupDialog=function(t){var e,s;this.isMouseIn&&null!==this.currentControlIndex&&(e=!1,!(s=this).isRaceGraph||1!==t.which&&3!==t.which?1===t.which?(this.popupUpdateFunc=function(){s.popup.setData(s.getFastestSplitsPopupData(),!1)},e=!0):3===t.which&&this.hasControls&&(this.popupUpdateFunc=function(){s.popup.setData(s.getFastestSplitsForCurrentLegPopupData(),!0)},e=!0):this.hasControls&&(this.setCurrentChartTime(t),this.popupUpdateFunc=function(){s.popup.setData(s.getResultsVisitingCurrentControlPopupData(),!0)},e=!0),e&&(this.updatePopupContents(t),this.popup.show(this.getPopupLocation(t))))},s.prototype.updatePopupContents=function(t){t=t.pageY-$(this.svg.node()).offset().top;this.hasControls&&t<e?this.updateNextControlInformation():this.popupUpdateFunc()},s.prototype.updateNextControlInformation=function(){this.hasControls&&this.popup.setNextControlData(this.getNextControlData())},s.prototype.drawControlLine=function(t){this.currentControlIndex=t,this.updateResultStatistics();t=this.xScale(this.referenceCumTimes[t]);this.controlLine=this.svgGroup.append("line").attr("x1",t).attr("y1",0).attr("x2",t).attr("y2",this.contentHeight).attr("class","controlLine").node()},s.prototype.updateControlLineLocation=function(t){var e=$(this.svg.node()),s=e.offset(),n=t.pageX-s.left,s=t.pageY-s.top;this.currentLeftMargin<=n&&n<e.width()-i&&s<e.height()-r?(s=this.xScale.invert(n-this.currentLeftMargin),e=(e=d3.bisect(this.referenceCumTimesSorted,s))>=this.referenceCumTimesSorted.length?this.referenceCumTimesSorted.length-1:(n=Math.abs(this.referenceCumTimesSorted[e]-s),Math.abs(s-this.referenceCumTimesSorted[e-1])<n?e-1:e),e=this.referenceCumTimeIndexes[e],null!==this.actualControlIndex&&this.actualControlIndex===e||(this.removeControlLine(),this.actualControlIndex=e,this.drawControlLine(Math.max(this.minViewableControl,e))),this.popup.isShown()&&null!==this.currentControlIndex&&(this.isRaceGraph&&this.setCurrentChartTime(t),this.updatePopupContents(t),this.popup.setLocation(this.getPopupLocation(t)))):(this.removeControlLine(),this.popup.hide())},s.prototype.removeControlLine=function(){this.currentControlIndex=null,this.actualControlIndex=null,this.updateResultStatistics(),null!==this.controlLine&&(d3.select(this.controlLine).remove(),this.controlLine=null)},s.prototype.getTimesBehindFastest=function(e,t){var t=t.map(function(t){return this.courseClassSet.allResults[t]},this),s=this.fastestCumTimes[e]-this.fastestCumTimes[e-1];return t.map(function(t){t=t.getSplitTimeTo(e);return null===t?null:t-s})},s.prototype.getTimeLosses=function(e,t){return t.map(function(t){return this.courseClassSet.allResults[t]},this).map(function(t){return t.getTimeLossAt(e)})},s.prototype.updateResultStatistics=function(){var t,e,s,n,i=this.selectedIndexesOrderedByLastYValue.map(function(t){return this.courseClassSet.allResults[t]},this),r=i.map(function(t){return f(t.getOwnerNameForLeg(this.selectedLegIndex),g(t))},this);null!==this.currentControlIndex&&0<this.currentControlIndex&&(n=i.map(function(t){return t.isOKDespiteMissingTimes}),this.visibleStatistics.TotalTime&&(t=i.map(function(t){return t.getCumulativeTimeTo(this.currentControlIndex)},this),e=i.map(function(t){return t.getCumulativeRankTo(this.currentControlIndex)},this),r=d3.zip(r,t,e,n).map(function(t){return t[0]+m(t[1],t[2],t[3])})),this.visibleStatistics.SplitTime&&(e=i.map(function(t){return t.getSplitTimeTo(this.currentControlIndex)},this),s=i.map(function(t){return t.getSplitRankTo(this.currentControlIndex)},this),r=d3.zip(r,e,s,n).map(function(t){return t[0]+m(t[1],t[2],t[3])})),this.visibleStatistics.BehindFastest&&(s=this.getTimesBehindFastest(this.currentControlIndex,this.selectedIndexesOrderedByLastYValue),r=d3.zip(r,s,n).map(function(t){return t[0]+l+u(t[2]&&null===t[1]?NaN:t[1])})),this.visibleStatistics.TimeLoss&&(n=this.getTimeLosses(this.currentControlIndex,this.selectedIndexesOrderedByLastYValue),r=d3.zip(r,n).map(function(t){return t[0]+l+u(t[1])}))),this.hasData&&this.currentResultData.forEach(function(t,e){t.label=r[e]}),d3.selectAll("text.resultLabel").text(function(t){return t.label})},s.prototype.getTickFormatter=function(){var s=this;if(this.courseClassSet.hasTeamData()){var n=[c("StartNameShort")],t=this.courseClassSet.classes[0].numbersOfControls;null!==this.selectedLegIndex&&(t=[t[this.selectedLegIndex]]);for(var e=0;e<t.length;e+=1){for(var i=1;i<=t[e];i+=1)n.push(i.toString());n.push(c("FinishNameShort"))}return function(t,e){return n[e]}}return function(t,e){return 0===e?c("StartNameShort"):e===s.numControls+1?c("FinishNameShort"):e.toString()}},s.prototype.getTextWidth=function(t){return this.textSizeElement.text(t).node().getBBox().width},s.prototype.getTextHeight=function(t){return this.textSizeElement.text(t).node().getBBox().height},s.prototype.getMaxGraphEndTextWidth=function(){if(0===this.selectedIndexes.length)return 0;var t=this.selectedIndexes.map(function(t){t=this.courseClassSet.allResults[t];return this.getTextWidth(f(t.getOwnerNameForLeg(this.selectedLegIndex),g(t)))},this);return d3.max(t)+this.determineMaxStatisticTextWidth()},s.prototype.getMaxTimeAndRankTextWidth=function(s,n){var i=0,r=0,o=this.selectedIndexes.map(function(t){return this.courseClassSet.allResults[t]},this);d3.range(1,this.numControls+2).forEach(function(e){var t=o.map(function(t){return t[s](e)});i=Math.max(i,C(t));t=o.map(function(t){return t[n](e)});r=Math.max(r,C(t))});var t=m(i,r);return this.getTextWidth(t)},s.prototype.getMaxSplitTimeAndRankTextWidth=function(){return this.getMaxTimeAndRankTextWidth("getSplitTimeTo","getSplitRankTo")},s.prototype.getMaxCumulativeTimeAndRankTextWidth=function(){return this.getMaxTimeAndRankTextWidth("getCumulativeTimeTo","getCumulativeRankTo")},s.prototype.getMaxTimeBehindFastestWidth=function(){for(var t=0,e=1;e<=this.numControls+1;e+=1)var s=this.getTimesBehindFastest(e,this.selectedIndexes),t=Math.max(t,C(s));return this.getTextWidth(l+u(t))},s.prototype.getMaxTimeLossWidth=function(){for(var t=0,e=0,s=1;s<=this.numControls+1;s+=1){var n=this.getTimeLosses(s,this.selectedIndexes).filter(p);0<n.length&&(t=Math.max(t,d3.max(n)),e=Math.min(e,d3.min(n)))}return Math.max(this.getTextWidth(l+u(t)),this.getTextWidth(l+u(e)))},s.prototype.determineMaxStatisticTextWidth=function(){var t=0;return this.visibleStatistics.TotalTime&&(t+=this.getMaxCumulativeTimeAndRankTextWidth()),this.visibleStatistics.SplitTime&&(t+=this.getMaxSplitTimeAndRankTextWidth()),this.visibleStatistics.BehindFastest&&(t+=this.getMaxTimeBehindFastestWidth()),this.visibleStatistics.TimeLoss&&(t+=this.getMaxTimeLossWidth()),t},s.prototype.determineMaxStartTimeLabelWidth=function(t){t=0<t.resultNames.length?d3.max(t.resultNames.map(function(t){return this.getTextWidth("00:00:00 "+t)},this)):0;return t},s.prototype.createScales=function(t){this.xScale=d3.scaleLinear().domain(t.xExtent).range([0,this.contentWidth]),this.yScale=d3.scaleLinear().domain(t.yExtent).range([0,this.contentHeight]),this.xScaleMinutes=d3.scaleLinear().domain([t.xExtent[0]/60,t.xExtent[1]/60]).range([0,this.contentWidth])},s.prototype.drawBackgroundRectangles=function(){var e=this.courseClassSet.sliceForLegIndex(this.referenceCumTimes,this.selectedLegIndex);e.sort(d3.ascending);for(var t=1;t<e.length;)e[t]===e[t-1]?e.splice(t,1):t+=1;var s=this,n=this.svgGroup.selectAll("rect").data(d3.range(e.length-1));n.enter().append("rect");var i=[],r=this.courseClassSet.hasTeamData()?this.courseClassSet.classes[0].numbersOfControls:[this.courseClassSet.numControls];this.courseClassSet.hasTeamData()&&null!==this.selectedLegIndex&&(r=[r[this.selectedLegIndex]]);for(var o=0;o<r.length;o+=1)for(var l=0;l<=r[o];l+=1)i.push(1+l%2+(o+(this.selectedLegIndex||0))%2*2);(n=this.svgGroup.selectAll("rect").data(d3.range(e.length-1))).attr("x",function(t){return s.xScale(e[t])}).attr("y",0).attr("width",function(t){return s.xScale(e[t+1])-s.xScale(e[t])}).attr("height",this.contentHeight).attr("class",function(t){return"background"+i[t]}),n.exit().remove()},s.prototype.determineYAxisTickFormatter=function(t){if(this.isRaceGraph){var s=0===t.dataColumns.length?[]:t.dataColumns[0].ys;if(0===s.length)return function(t){return h(60*t)};var n=this.yScale;return function(e){return 10<=d3.min(s.map(function(t){return Math.abs(n(t)-n(e))}))?h(Math.round(60*e)):""}}return null},s.prototype.drawAxes=function(t,e){var s=this.determineYAxisTickFormatter(e),n=d3.axisTop().scale(this.xScale).tickFormat(this.getTickFormatter()).tickValues(this.courseClassSet.sliceForLegIndex(this.referenceCumTimes,this.selectedLegIndex)),e=d3.axisLeft().scale(this.yScale).tickFormat(s),s=d3.axisBottom().scale(this.xScaleMinutes);this.svgGroup.selectAll("g.axis").remove(),this.svgGroup.append("g").attr("class","x axis").call(n),this.svgGroup.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("x",-(this.contentHeight-6)).attr("y",6).attr("dy",".71em").style("text-anchor","start").style("fill","black").text(t),this.svgGroup.append("g").attr("class","x axis").attr("transform","translate(0,"+this.contentHeight+")").call(s).append("text").attr("x",60).attr("y",-5).style("text-anchor","start").style("fill","black").text(c("LowerXAxisChartLabel"))},s.prototype.drawChartLines=function(o){var l=this;this.svgGroup.selectAll("path.graphLine").remove(),this.svgGroup.selectAll("line.aroundOmittedTimes").remove(),d3.range(this.numLines).forEach(function(e){function s(){l.highlight(l.selectedIndexes[e])}function n(){l.unhighlight()}var i,r=a[this.selectedIndexes[e]%a.length];this.svgGroup.append("path").attr("d",(i=e,(o.dataColumns.some(function(t){return p(t.ys[i])})?d3.line().x(function(t){return l.xScale(t.x)}).y(function(t){return l.yScale(t.ys[i])}).defined(function(t){return p(t.ys[i])}):d3.line().x(0).y(0).defined(function(t,e){return 0===e}))(o.dataColumns))).attr("stroke",r).attr("class","graphLine result"+this.selectedIndexes[e]).on("mouseenter",s).on("mouseleave",n).append("title").text(o.resultNames[e]),o.dubiousTimesInfo[e].forEach(function(t){this.svgGroup.append("line").attr("x1",this.xScale(o.dataColumns[t.start].x)).attr("y1",this.yScale(o.dataColumns[t.start].ys[e])).attr("x2",this.xScale(o.dataColumns[t.end].x)).attr("y2",this.yScale(o.dataColumns[t.end].ys[e])).attr("stroke",r).attr("class","aroundOmittedTimes result"+this.selectedIndexes[e]).on("mouseenter",s).on("mouseleave",n).append("title").text(o.resultNames[e])},this)},this)},s.prototype.highlight=function(t){this.svg.selectAll("path.graphLine.result"+t).classed("selected",!0),this.svg.selectAll("line.resultLegendLine.result"+t).classed("selected",!0),this.svg.selectAll("text.resultLabel.result"+t).classed("selected",!0),this.svg.selectAll("text.startLabel.result"+t).classed("selected",!0),this.svg.selectAll("line.aroundOmittedTimes.result"+t).classed("selected",!0)},s.prototype.unhighlight=function(){this.svg.selectAll("path.graphLine.selected").classed("selected",!1),this.svg.selectAll("line.resultLegendLine.selected").classed("selected",!1),this.svg.selectAll("text.resultLabel.selected").classed("selected",!1),this.svg.selectAll("text.startLabel.selected").classed("selected",!1),this.svg.selectAll("line.aroundOmittedTimes.selected").classed("selected",!1)},s.prototype.drawResultStartTimeLabels=function(s){var n=s.dataColumns[0],i=this,t=this.svgGroup.selectAll("text.startLabel").data(this.selectedIndexes);t.enter().append("text").classed("startLabel",!0),(t=this.svgGroup.selectAll("text.startLabel").data(this.selectedIndexes)).attr("x",-7).attr("y",function(t,e){return i.yScale(n.ys[e])+i.getTextHeight(s.resultNames[e])/4}).attr("class",function(t){return"startLabel result"+t}).on("mouseenter",function(t){i.highlight(t)}).on("mouseleave",function(){i.unhighlight()}).text(function(t,e){return h(Math.round(60*n.ys[e]))+" "+s.resultNames[e]}),t.exit().remove()},s.prototype.removeResultStartTimeLabels=function(){this.svgGroup.selectAll("text.startLabel").remove()},s.prototype.adjustResultLegendLabelsDownwardsIfNecessary=function(){for(var t=1;t<this.numLines;t+=1){var e=this.currentResultData[t-1],s=this.currentResultData[t];s.y<e.y+e.textHeight&&(s.y=e.y+e.textHeight)}},s.prototype.adjustResultLegendLabelsUpwardsIfNecessary=function(t){if(0<this.numLines&&this.currentResultData[this.numLines-1].y>this.contentHeight){this.currentResultData[this.numLines-1].y=Math.max(t,this.contentHeight);for(var e=this.numLines-2;0<=e;--e){var s=this.currentResultData[e+1],n=this.currentResultData[e];if(!(n.y+n.textHeight>s.y))break;n.y=s.y-n.textHeight}}},s.prototype.drawResultLegendLabels=function(t){var i=0;if(0===t.dataColumns.length)this.currentResultData=[];else{var r=t.dataColumns[t.dataColumns.length-1];this.currentResultData=d3.range(this.numLines).map(function(t){var e=this.selectedIndexes[t],s=this.courseClassSet.allResults[e].getOwnerNameForLeg(this.selectedLegIndex),n=this.getTextHeight(s);return i+=n,{label:f(s,g(this.courseClassSet.allResults[e])),textHeight:n,y:p(r.ys[t])?this.yScale(r.ys[t]):null,colour:a[e%a.length],index:e}},this),i-=this.currentResultData[this.numLines-1].textHeight;for(var e=null,s=this.numLines-1;0<=s;--s)null===this.currentResultData[s].y&&(this.currentResultData[s].y=null===e?this.contentHeight:e-this.currentResultData[s].textHeight,e=this.currentResultData[s].y)}this.currentResultData.sort(function(t,e){return t.y-e.y}),this.selectedIndexesOrderedByLastYValue=this.currentResultData.map(function(t){return t.index}),this.adjustResultLegendLabelsDownwardsIfNecessary(),this.adjustResultLegendLabelsUpwardsIfNecessary(i);t=this.svgGroup.selectAll("line.resultLegendLine").data(this.currentResultData);t.enter().append("line").classed("resultLegendLine",!0);var n=this;(t=this.svgGroup.selectAll("line.resultLegendLine").data(this.currentResultData)).attr("x1",this.contentWidth+1).attr("y1",function(t){return t.y}).attr("x2",this.contentWidth+10+1).attr("y2",function(t){return t.y}).attr("stroke",function(t){return t.colour}).attr("class",function(t){return"resultLegendLine result"+t.index}).on("mouseenter",function(t){n.highlight(t.index)}).on("mouseleave",function(){n.unhighlight()}),t.exit().remove();t=this.svgGroup.selectAll("text.resultLabel").data(this.currentResultData);t.enter().append("text").classed("resultLabel",!0),(t=this.svgGroup.selectAll("text.resultLabel").data(this.currentResultData)).attr("x",this.contentWidth+10+2).attr("y",function(t){return t.y+t.textHeight/4}).attr("class",function(t){return"resultLabel result"+t.index}).on("mouseenter",function(t){n.highlight(t.index)}).on("mouseleave",function(){n.unhighlight()}).text(function(t){return t.label}),t.exit().remove()},s.prototype.adjustContentSize=function(){var t=this.getMaxGraphEndTextWidth();this.setLeftMargin(Math.max(this.maxStartTimeLabelWidth+8,o)),this.contentWidth=Math.max(this.overallWidth-this.currentLeftMargin-i-t-12,100),this.contentHeight=Math.max(this.overallHeight-e-r,100)},s.prototype.setSize=function(t,e){this.overallWidth=t,this.overallHeight=e,$(this.svg.node()).width(t).height(e),this.adjustContentSize()},s.prototype.clearGraph=function(){this.svgGroup.selectAll("*").remove()},s.prototype.sortReferenceCumTimes=function(){var s=d3.map();this.referenceCumTimes.forEach(function(t,e){s.has(t)||s.set(t,e)}),this.referenceCumTimesSorted=this.referenceCumTimes.slice(0),this.referenceCumTimesSorted.sort(d3.ascending);for(var t=this.referenceCumTimesSorted.length-1;0<t;--t)this.referenceCumTimesSorted[t]===this.referenceCumTimesSorted[t-1]&&this.referenceCumTimesSorted.splice(t,1);this.referenceCumTimeIndexes=this.referenceCumTimesSorted.map(function(t){return s.get(t)})},s.prototype.drawChart=function(t,e,s,n,i){var r=t.chartData;this.numControls=r.numControls,this.numLines=r.resultNames.length,this.selectedIndexes=e,this.referenceCumTimes=t.referenceCumTimes,this.fastestCumTimes=t.fastestCumTimes,this.eventData=t.eventData,this.courseClassSet=t.courseClassSet,this.hasControls=t.courseClassSet.getCourse().hasControls(),this.isRaceGraph=n.isRaceGraph,this.minViewableControl=n.minViewableControl,this.visibleStatistics=s,this.selectedLegIndex=i,this.hasData=!0,this.maxStatisticTextWidth=this.determineMaxStatisticTextWidth(),this.maxStartTimeLabelWidth=this.isRaceGraph?this.determineMaxStartTimeLabelWidth(r):0,this.sortReferenceCumTimes(),this.adjustContentSize(),this.createScales(r),this.drawBackgroundRectangles(),this.drawAxes(c(n.yAxisLabelKey),r),this.drawChartLines(r),this.drawResultLegendLabels(r),this.removeControlLine(),this.isRaceGraph?this.drawResultStartTimeLabels(r):this.removeResultStartTimeLabels()},SplitsBrowser.Controls.Chart=s}(),function(){"use strict";var v=SplitsBrowser.formatTime,S=SplitsBrowser.Model.compareResults,y=SplitsBrowser.getMessage,T=SplitsBrowser.getMessageWithFormatting,x=SplitsBrowser.subtractIfNotNull,w=SplitsBrowser.isNotNullNorNaN;function t(t){this.parent=t,this.courseClass=null,this.div=null,this.headerSpan=null,this.table=null,this.selectedLegIndex=null,this.buildTable()}function b(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function L(t,e,s){return null===t&&s?"??:??":v(t,e)}t.prototype.buildTable=function(){this.div=d3.select(this.parent).append("div").attr("id","resultsTableContainer"),this.headerSpan=this.div.append("div").append("span").classed("resultsTableHeader",!0),this.table=this.div.append("table").classed("resultsTable",!0),this.table.append("thead").append("tr"),this.table.append("tbody")},t.prototype.populateTable=function(){var n,t=this.courseClass.name+", ",i=this.courseClass.isTeamClass&&null!==this.selectedLegIndex?(n=this.courseClass.numbersOfControls[this.selectedLegIndex],this.courseClass.offsets[this.selectedLegIndex]):(n=this.courseClass.numControls,0);this.courseClass.isTeamClass&&null!==this.selectedLegIndex&&(t+=T("ShowLeg",{$$LEG_NUMBER$$:this.selectedLegIndex+1})+", "),this.courseClass.isTeamClass&&null===this.selectedLegIndex?(e=this.courseClass.numbersOfControls.join(" + "),t+=T("ResultsTableHeaderMultipleControls",{$$NUM$$:e})):t+=1===n?y("ResultsTableHeaderSingleControl"):T("ResultsTableHeaderMultipleControls",{$$NUM$$:n});var e=this.courseClass.course;null!==e.length&&(t+=", "+T("ResultsTableHeaderCourseLength",{$$DISTANCE$$:e.length.toFixed(1)})),null!==e.climb&&(t+=", "+T("ResultsTableHeaderClimb",{$$CLIMB$$:e.climb})),this.headerSpan.text(t);var s=[y("ResultsTableHeaderControlNumber"),y("ResultsTableHeaderName"),y("ResultsTableHeaderTime")];if(this.courseClass.isTeamClass){if(null===this.selectedLegIndex)for(var r=0;r<this.courseClass.numbersOfControls.length;r+=1){for(var o="-"+(r+1),l=1;l<=this.courseClass.numbersOfControls[r];l+=1)s.push(l+o);s.push(y("FinishName")+o)}else{for(l=1;l<=this.courseClass.numbersOfControls[this.selectedLegIndex];l+=1)s.push(l);s.push(y("FinishName"))}}else{var a=this.courseClass.course.controls;(s=null===a?s.concat(d3.range(1,n+1)):s.concat(a.map(function(t,e){return e+1+"("+t+")"}))).push(y("FinishName"))}a=this.table.select("thead tr").selectAll("th").data(s);a.enter().append("th"),a.exit().remove(),(a=this.table.select("thead tr").selectAll("th").data(s)).text(function(t){return t});var h=[];function c(t,e,s){var n=[];return t&&n.push("fastest"),e&&n.push("dubious"),s&&n.push("missing"),n.join(" ")}function p(t,e,s,n,i,r){h.push("<td"),s&&h.push(' class="'+s+'"'),r&&h.push(' title="'+b(r)+'"'),h.push("><span"),""!==n&&h.push(' class="'+n+'"'),h.push(">"),h.push(b(t)),h.push("</span><br><span"),""!==i&&h.push(' class="'+i+'"'),h.push(">"),h.push(b(e)),h.push("</span></td>\n")}var d=this.courseClass.results.slice(0);d.sort(S);var u,m,f=0,g=0,C=(u=0,m=1,d.forEach(function(t){t.getAllOriginalCumulativeTimes().forEach(function(t){if(w(t))for(;u<2&&Math.abs(t-Math.round(t*m)/m)>1e-7*t;)u+=1,m*=10})}),u);d.forEach(function(a,t){h.push("<tr><td>"),a.isNonCompetitive?(h.push(b(y("NonCompetitiveShort"))),f+=1):a.completed()&&(0!==t&&d[t-1].totalTime===a.totalTime||(g=t+1-f),h.push(""+g)),h.push("</td>"),e=this.courseClass.isTeamClass&&null===this.selectedLegIndex?a.owner.members.map(function(t){return t.name}).join("\n"):"";var u=a.getOriginalCumulativeTimeTo(i);p(a.getOwnerNameForLeg(this.selectedLegIndex),a.owner.club,null,"","",e);var e,s=this.courseClass.isTeamClass&&null!==this.selectedLegIndex?x(a.getOriginalCumulativeTimeTo(i+n+1),u):a.totalTime;p((t=s,e=C,(s=a).isNonStarter?y("DidNotStartShort"):s.isNonFinisher?y("DidNotFinishShort"):s.isDisqualified?y("DisqualifiedShort"):s.isOverMaxTime?y("OverMaxTimeShort"):s.completed()?v(t,e):y("MispunchedShort")),"","time","","",""),d3.range(i+1,i+n+2).forEach(function(t){var e=x(a.getOriginalCumulativeTimeTo(t),u),s=a.getOriginalSplitTimeTo(t),n=L(e,C,a.isOKDespiteMissingTimes),i=L(s,C,a.isOKDespiteMissingTimes),r=1===a.getCumulativeRankTo(t),o=1===a.getSplitRankTo(t),l=a.isCumulativeTimeDubious(t),t=a.isSplitTimeDubious(t),e=a.isOKDespiteMissingTimes&&null===e,s=a.isOKDespiteMissingTimes&&null===s;p(n,i,"time",c(r,l,e),c(o,t,s),"")}),h.push("</tr>\n")},this),this.table.select("tbody").node().innerHTML=h.join("")},t.prototype.setClass=function(t){this.courseClass=t,(this.selectedLegIndex=null)!==this.courseClass&&this.populateTable()},t.prototype.setSelectedLegIndex=function(t){this.selectedLegIndex=t,null!==this.courseClass&&this.populateTable()},t.prototype.show=function(){this.div.style("display",null)},t.prototype.hide=function(){this.div.style("display","none")},t.prototype.retranslate=function(){this.populateTable()},SplitsBrowser.Controls.ResultsTable=t}(),function(){"use strict";var i=SplitsBrowser.isNaNStrict,l=SplitsBrowser.hasProperty,a=SplitsBrowser.Model.ChartTypes,r=SplitsBrowser.Model.CourseClassSet;function u(t,e){return t.replace(new RegExp(e.source,"g"),"")}var h=/(?:^|&|\?)class=([^&]+)/;var c=/(?:^|&|\?)chartType=([^&]+)/;var p=/(?:^|&|\?)compareWith=([^&]+)/,d=["Winner","FastestTime","FastestTimePlus5","FastestTimePlus25","FastestTimePlus50","FastestTimePlus100"];var m=/(?:^|&|\?)selected=([^&]+)/;var f=/(?:^|&|\?)stats=([^&]*)/,g=["TotalTime","SplitTime","BehindFastest","TimeLoss"];var C=/(?:^|&|\?)showOriginal=([^&]*)/;var v=/(?:^|&|\?)selectedLeg=([^&]*)/;var S=/(?:^|&|\?)filterText=([^&]*)/;SplitsBrowser.parseQueryString=function(t,e){var s,n;return{classes:null===(n=function(t,e){if(null===(t=h.exec(t)))return null;for(var s=d3.map(),n=0;n<e.classes.length;n+=1)s.set(e.classes[n].name,e.classes[n]);if(t=decodeURIComponent(t[1]).split(";"),0===(t=(t=d3.set(t).values()).filter(function(t){return s.has(t)}).map(function(t){return s.get(t)})).length)return null;var i=t[0].course,t=t.filter(function(t){return t.course===i});return new r(t)}(t,e))?null:n.classes.map(function(t){return e.classes.indexOf(t)}),chartType:(s=t,null===(s=c.exec(s))?null:(s=s[1],l(a,s)?a[s]:null)),compareWith:function(t,e){if(null===(t=p.exec(t)))return null;var s=decodeURIComponent(t[1]);if(1<=(t=d.indexOf(s)))return{index:t,result:null};if(0===t&&null!==e)return e.allResults.some(function(t){return t.completed()})?{index:0,result:null}:null;if(null===e)return null;for(var n=0;n<e.allResults.length;n+=1){var i=e.allResults[n];if(i.owner.name===s&&i.completed())return{index:d.length,result:i}}return null}(t,n),selected:function(t,e){if(null===e)return null;if(null===(t=m.exec(t)))return null;if(0<=(t=decodeURIComponent(t[1]).split(";")).indexOf("*"))return d3.range(0,e.allResults.length);t=d3.set(t).values();var s=e.allResults.map(function(t){return t.owner.name}),n=[];return t.forEach(function(t){t=s.indexOf(t);0<=t&&n.push(t)}),n.sort(d3.ascending),0===n.length?null:n}(t,n),stats:function(t){if(null===(t=f.exec(t)))return null;var e=decodeURIComponent(t[1]).split(";"),s={};g.forEach(function(t){s[t]=!1});for(var n=0;n<e.length;n+=1){var i=e[n];if(l(s,i))s[i]=!0;else if(""!==i)return null}return s}(t),showOriginal:(n=t,null!==(n=C.exec(n))&&"1"===n[1]),selectedLeg:(n=t,null===(n=v.exec(n))?null:(n=parseInt(n[1],10),i(n)?null:n)),filterText:(t=t,null===(t=S.exec(t))?"":decodeURIComponent(t[1]))}},SplitsBrowser.formatQueryString=function(t,e,s,n){var i,r,o;return i=t,r=e,e=n.classes,i=u(i,h),e=e.map(function(t){return r.classes[t].name}),e=t=function(t,e,s){t=u(t,p);var n=null;return"number"==typeof e&&0<=e&&e<d.length?n=d[e]:null!==s&&(n=s.owner.name),null===n?t:t+"&compareWith="+encodeURIComponent(n)}(t=function(t,e){for(var s in t=u(t,c),a)if(l(a,s)&&a[s]===e)return t+"&chartType="+encodeURIComponent(s);return t}(t=i+"&class="+encodeURIComponent(e.join(";")),n.chartType),n.compareWith.index,n.compareWith.result),o=s,s=n.selected,e=u(e,m),t=function(t,e){t=u(t,f);var s=g.filter(function(t){return l(e,t)&&e[t]});return t+"&stats="+encodeURIComponent(s.join(";"))}(t=0===(s=s.map(function(t){return o.allResults[t]})).length?e:s.length===o.allResults.length?e+"&selected=*":(s=s.map(function(t){return t.owner.name}).join(";"),e+"&selected="+encodeURIComponent(s)),n.stats),e=t,s=n.showOriginal,e=u(e,C),s=t=s?e+"&showOriginal=1":e,e=n.selectedLeg,s=u(s,v),t=null===e?s:s+"&selectedLeg="+encodeURIComponent(e),e=t,n=n.filterText,e=u(e,S),t=(t=""===n?e:e+"&filterText="+encodeURIComponent(n)).replace(/^\??&/,"")}}(),function(){"use strict";var t=SplitsBrowser.getMessage;function e(t){this.parent=t,this.warnings=[],this.containerDiv=t.append("div").classed("topRowStart",!0).attr("id","warningViewerContainer").style("display","none"),this.containerDiv.append("div").classed("topRowStartSpacer",!0),this.warningTriangle=this.createWarningTriangle(this.containerDiv),this.warningList=t.append("div").classed("warningList",!0).classed("transient",!0).style("position","absolute").style("display","none");var s=this;$(document).click(function(t){var e;"none"!==s.warningList.style("display")&&((e=$("div#warningTriangleContainer,div.warningList")).is(t.target)||0!==e.has(t.target).length||s.warningList.style("display","none"))}),this.setMessages()}e.prototype.setMessages=function(){this.containerDiv.attr("title",t("WarningsTooltip"))},e.prototype.createWarningTriangle=function(){var t=this.containerDiv.append("div").attr("id","warningTriangleContainer"),e=t.append("svg");e.style("width","21px").style("height","19px").style("margin-bottom","-3px"),e.append("polygon").attr("points","1,18 10,0 19,18").style("stroke","black").style("stroke-width","1.5px").style("fill","#ffd426"),e.append("text").attr("x",10).attr("y",16).attr("text-anchor","middle").style("font-size","14px").text("!");var s=this;return t.on("click",function(){s.showHideErrorList()}),e},e.prototype.setWarnings=function(t){var e=this.warningList.selectAll("div").data(t);e.enter().append("div").classed("warning",!0),(e=this.warningList.selectAll("div").data(t)).text(function(t){return t}),e.exit().remove(),this.containerDiv.style("display",t&&0<t.length?"block":"none")},e.prototype.showHideErrorList=function(){var t,e,s;"none"===this.warningList.style("display")?(t=$(this.warningTriangle.node()).offset(),e=$(this.warningTriangle.node()).outerHeight(),s=$(this.warningList.node()).outerWidth(),this.warningList.style("left",Math.max(t.left-s/2,0)+"px").style("top",t.top+e+5+"px").style("display","block")):this.warningList.style("display","none")},SplitsBrowser.Controls.WarningViewer=e}(),function(){"use strict";var t=SplitsBrowser.Version,n=SplitsBrowser.getMessage,e=SplitsBrowser.tryGetMessage,i=SplitsBrowser.getMessageWithFormatting,r=SplitsBrowser.initialiseMessages,s=SplitsBrowser.Model,o=s.ResultSelection,l=s.CourseClassSet,a=s.ChartTypes,u=SplitsBrowser.Input.parseEventData,h=SplitsBrowser.DataRepair.repairEventData,c=SplitsBrowser.DataRepair.transferResultData,p=SplitsBrowser.parseQueryString,d=SplitsBrowser.formatQueryString,
s=SplitsBrowser.Controls,m=s.LanguageSelector,f=s.ClassSelector,g=s.ChartTypeSelector,C=s.ComparisonSelector,v=s.OriginalDataSelector,S=s.LegSelector,y=s.StatisticsSelector,T=s.WarningViewer,x=s.ResultList,w=s.Chart,b=s.ResultsTable;function L(){return window.d3?!(parseFloat(d3.version)<4)||void alert("D3 version "+d3.version+" was found.  SplitsBrowser requires D3 version 4 or later."):void alert("D3 was not found.  SplitsBrowser requires D3 version 4 or later.")}function D(t){this.options=t,this.eventData=null,this.classes=null,this.currentClasses=[],this.chartData=null,this.referenceCumTimes=null,this.fastestCumTimes=null,this.previousResultList=[],this.topBarHeight=t&&t.topBar&&0<$(t.topBar).length?$(t.topBar).outerHeight(!0):0,this.selection=null,this.courseClassSet=null,this.languageSelector=null,this.classSelector=null,this.comparisonSelector=null,this.originalDataSelector=null,this.legSelector=null,this.statisticsSelector=null,this.resultList=null,this.warningViewer=null,this.chart=null,this.topPanel=null,this.mainPanel=null,this.buttonsPanel=null,this.resultListContainer=null,this.container=null,this.currentResizeTimeout=null}function R(t){alert(t)}function I(){alert(n("RaceGraphDisabledAsStartTimesMissing"))}function N(t,e){var s=d3.select("body").append("div").classed("sbErrors",!0);s.append("h1").text(n("LoadFailedHeader")),s.append("p").text(i(t,e))}function O(t,e,s){N("LoadFailedReadError",{$$ERROR$$:s})}D.prototype.enableOrDisableRaceGraph=function(){var t=this.courseClassSet.allResults.some(function(t){return t.lacksStartTime()});this.chartTypeSelector.setRaceGraphDisabledNotifier(t?I:null)},D.prototype.setEvent=function(t){this.eventData=t,this.classes=t.classes,null!==this.classSelector&&this.classSelector.setClasses(this.classes),this.warningViewer.setWarnings(t.warnings)},D.prototype.drawLogo=function(){this.logoSvg=this.topPanel.append("svg").classed("topRowStart",!0),this.logoSvg.style("width","19px").style("height","19px").style("margin-bottom","-3px"),this.logoSvg.append("rect").attr("x","0").attr("y","0").attr("width","19").attr("height","19").attr("fill","white"),this.logoSvg.append("polygon").attr("points","0,19 19,0 19,19").attr("fill","red"),this.logoSvg.append("polyline").attr("points","0.5,0.5 0.5,18.5 18.5,18.5 18.5,0.5 0.5,0.5 0.5,18.5").attr("stroke","black").attr("fill","none"),this.logoSvg.append("polyline").attr("points","1,12 5,8 8,14 17,11").attr("fill","none").attr("stroke","blue").attr("stroke-width","2"),this.logoSvg.selectAll("*").append("title"),this.setLogoMessages()},D.prototype.setLogoMessages=function(){this.logoSvg.selectAll("title").text(i("ApplicationVersion",{$$VERSION$$:t}))},D.prototype.addSpacer=function(){this.topPanel.append("div").classed("topRowStartSpacer",!0)},D.prototype.addLanguageSelector=function(){this.languageSelector=new m(this.topPanel.node())},D.prototype.addClassSelector=function(){this.classSelector=new f(this.topPanel.node()),null!==this.classes&&this.classSelector.setClasses(this.classes)},D.prototype.addChartTypeSelector=function(){var t=[a.SplitsGraph,a.RaceGraph,a.PositionAfterLeg,a.SplitPosition,a.PercentBehind,a.ResultsTable];this.chartTypeSelector=new g(this.topPanel.node(),t)},D.prototype.addComparisonSelector=function(){this.comparisonSelector=new C(this.topPanel.node(),R),null!==this.classes&&this.comparisonSelector.setClasses(this.classes)},D.prototype.addOriginalDataSelector=function(){this.originalDataSelector=new v(this.topPanel)},D.prototype.addLegSelector=function(){this.legSelector=new S(this.topPanel)},D.prototype.addDirectLink=function(){this.directLink=this.topPanel.append("a").classed("topRowStart",!0).attr("id","directLinkAnchor").attr("href",document.location.href),this.setDirectLinkMessages()},D.prototype.addWarningViewer=function(){this.warningViewer=new T(this.topPanel)},D.prototype.setDirectLinkMessages=function(){this.directLink.attr("title",e("DirectLinkToolTip","")).text(n("DirectLink"))},D.prototype.updateDirectLink=function(){var t={classes:this.classSelector.getSelectedClasses(),chartType:this.chartTypeSelector.getChartType(),compareWith:this.comparisonSelector.getComparisonType(),selected:this.selection.getSelectedIndexes(),stats:this.statisticsSelector.getVisibleStatistics(),showOriginal:this.courseClassSet.hasDubiousData()&&this.originalDataSelector.isOriginalDataSelected(),selectedLeg:this.legSelector.getSelectedLeg(),filterText:this.resultList.getFilterText()},e=document.location.search,s=d(e,this.eventData,this.courseClassSet,t),t=document.location.href;this.directLink.attr("href",t.substring(0,t.length-e.length)+"?"+s.replace(/^\?+/,""))},D.prototype.addResultList=function(){this.resultList=new x(this.mainPanel.node(),R)},D.prototype.buildUi=function(){var t=d3.select("body");t.style("overflow","hidden"),this.container=t.append("div").attr("id","sbContainer"),this.topPanel=this.container.append("div"),this.drawLogo(),this.addLanguageSelector(),this.addSpacer(),this.addClassSelector(),this.addLegSelector(),this.addSpacer(),this.addChartTypeSelector(),this.addSpacer(),this.addComparisonSelector(),this.addOriginalDataSelector(),this.addSpacer(),this.addDirectLink(),this.addWarningViewer(),this.statisticsSelector=new y(this.topPanel.node()),this.topPanel.append("div").style("clear","both"),this.mainPanel=this.container.append("div"),this.addResultList(),this.chart=new w(this.mainPanel.node()),this.resultsTable=new b(this.container.node()),this.resultsTable.hide();var e=this;$(window).resize(function(){e.handleWindowResize()}),$("input:text").bind("selectstart",function(t){t.stopPropagation()}),$(this.container.node()).bind("selectstart",function(){return!1}),$(document).keydown(function(t){27===t.which&&e.hideTransientElements()})},D.prototype.registerChangeHandlers=function(){var e=this;this.languageSelector.registerChangeHandler(function(){e.retranslate()}),this.classSelector.registerChangeHandler(function(t){e.selectClasses(t)}),this.chartTypeSelector.registerChangeHandler(function(t){e.selectChartTypeAndRedraw(t)}),this.comparisonSelector.registerChangeHandler(function(t){e.selectComparison(t)}),this.originalDataSelector.registerChangeHandler(function(t){e.showOriginalOrRepairedData(t)}),this.legSelector.registerChangeHandler(function(){e.handleLegSelectionChanged()}),this.resultList.registerChangeHandler(function(){e.handleFilterTextChanged()})},D.prototype.handleWindowResize=function(){null!==this.currentResizeTimeout&&clearTimeout(this.currentResizeTimeout);var t=this;this.currentResizeTimeout=setTimeout(function(){t.postResizeHook()},100)},D.prototype.postResizeHook=function(){this.currentResizeTimeout=null,this.setResultListHeight(),this.setChartSize(),this.hideTransientElements(),this.redraw()},D.prototype.hideTransientElements=function(){d3.selectAll(".transient").style("display","none")},D.prototype.getHorizontalMargin=function(){var t=$("body"),e=$(this.container.node());return t.outerWidth(!0)-t.width()+(e.outerWidth()-e.width())},D.prototype.getVerticalMargin=function(){var t=$("body"),e=$(this.container.node());return t.outerHeight(!0)-t.height()+(e.outerHeight()-e.height())},D.prototype.getUsableHeight=function(){return $(window).outerHeight()-this.getVerticalMargin()-this.topBarHeight-$(this.topPanel.node()).height()},D.prototype.setResultListHeight=function(){this.resultList.setHeight(this.getUsableHeight())},D.prototype.setChartSize=function(){var t=this.getHorizontalMargin(),e=this.getVerticalMargin(),t=$(window).width()-t,e=$(window).height()-e-this.topBarHeight;$(this.container.node()).width(t).height(e);e=t-this.resultList.width()-2,t=this.getUsableHeight();this.chart.setSize(e,t)},D.prototype.drawChart=function(){var e,t,s;this.chartTypeSelector.getChartType().isResultsTable||(this.currentVisibleStatistics=this.statisticsSelector.getVisibleStatistics(),null!==this.selectionChangeHandler&&this.selection.deregisterChangeHandler(this.selectionChangeHandler),null!==this.statisticsChangeHandler&&this.statisticsSelector.deregisterChangeHandler(this.statisticsChangeHandler),(e=this).selectionChangeHandler=function(){e.resultList.enableOrDisableCrossingRunnersButton(),e.redraw(),e.updateDirectLink()},this.selection.registerChangeHandler(this.selectionChangeHandler),this.statisticsChangeHandler=function(t){e.currentVisibleStatistics=t,e.redraw(),e.updateDirectLink()},this.statisticsSelector.registerChangeHandler(this.statisticsChangeHandler),this.updateControlEnabledness(),0<this.classes.length&&(t=this.legSelector.getSelectedLeg(),s=this.comparisonSelector.getComparisonFunction(),this.referenceCumTimes=s(this.courseClassSet),this.fastestCumTimes=this.courseClassSet.getFastestCumTimes(t),this.chartData=this.courseClassSet.getChartData(this.referenceCumTimes,this.selection.getSelectedIndexes(),this.chartTypeSelector.getChartType(),t),this.redrawChart()))},D.prototype.redrawChart=function(){var t={chartData:this.chartData,eventData:this.eventData,courseClassSet:this.courseClassSet,referenceCumTimes:this.referenceCumTimes,fastestCumTimes:this.fastestCumTimes};this.chart.drawChart(t,this.selection.getSelectedIndexes(),this.currentVisibleStatistics,this.chartTypeSelector.getChartType(),this.legSelector.getSelectedLeg())},D.prototype.redraw=function(){var t=this.chartTypeSelector.getChartType();t.isResultsTable||(this.chartData=this.courseClassSet.getChartData(this.referenceCumTimes,this.selection.getSelectedIndexes(),t,this.legSelector.getSelectedLeg()),this.redrawChart())},D.prototype.retranslate=function(){this.setLogoMessages(),this.languageSelector.setMessages(),this.classSelector.retranslate(),this.chartTypeSelector.setMessages(),this.comparisonSelector.setMessages(),this.originalDataSelector.setMessages(),this.legSelector.setMessages(),this.setDirectLinkMessages(),this.statisticsSelector.setMessages(),this.warningViewer.setMessages(),this.resultList.retranslate(),this.resultsTable.retranslate(),this.chartTypeSelector.getChartType().isResultsTable||this.redrawChart()},D.prototype.setClasses=function(t){this.currentClasses=t.map(function(t){return this.classes[t]},this),this.courseClassSet=new l(this.currentClasses),this.comparisonSelector.setCourseClassSet(this.courseClassSet),this.resultsTable.setClass(0<this.currentClasses.length?this.currentClasses[0]:null),this.enableOrDisableRaceGraph(),this.originalDataSelector.setVisible(this.courseClassSet.hasDubiousData()),this.legSelector.setCourseClassSet(this.courseClassSet)},D.prototype.initClasses=function(t){this.classSelector.selectClasses(t),this.setClasses(t),this.resultList.setResultList(this.courseClassSet.allResults,1<this.currentClasses.length,this.courseClassSet.hasTeamData(),null),this.selection=new o(this.courseClassSet.allResults.length),this.resultList.setSelection(this.selection),this.previousResultList=this.courseClassSet.allResults},D.prototype.selectClasses=function(t){0<t.length&&0<this.currentClasses.length&&this.classes[t[0]]===this.currentClasses[0]||this.selection.selectNone(),this.setClasses(t),this.resultList.setResultList(this.courseClassSet.allResults,1<this.currentClasses.length,this.courseClassSet.hasTeamData(),null),this.selection.migrate(this.previousResultList,this.courseClassSet.allResults),this.resultList.selectionChanged(),this.chartTypeSelector.getChartType().isResultsTable||(this.setChartSize(),this.drawChart()),this.previousResultList=this.courseClassSet.allResults,this.updateDirectLink()},D.prototype.selectComparison=function(){this.drawChart(),this.updateDirectLink()},D.prototype.selectChartType=function(t){t.isResultsTable?(this.mainPanel.style("display","none"),this.container.style("width",null).style("height",null),d3.select("body").style("overflow",null),this.resultsTable.show()):(this.resultsTable.hide(),d3.select("body").style("overflow","hidden"),this.mainPanel.style("display",null),this.setChartSize()),this.updateControlEnabledness(),this.resultList.setChartType(t)},D.prototype.selectChartTypeAndRedraw=function(t){this.selectChartType(t),t.isResultsTable||(this.setResultListHeight(),this.drawChart()),this.updateDirectLink()},D.prototype.selectOriginalOrRepairedData=function(t){(t?c:h)(this.eventData),this.eventData.determineTimeLosses()},D.prototype.showOriginalOrRepairedData=function(t){this.selectOriginalOrRepairedData(t),this.drawChart(),this.updateDirectLink()},D.prototype.setSelectedLegIndex=function(){this.comparisonSelector.setSelectedLeg(this.legSelector.getSelectedLeg()),this.resultList.setResultList(this.courseClassSet.allResults,1<this.currentClasses.length,this.courseClassSet.hasTeamData(),this.legSelector.getSelectedLeg()),this.resultsTable.setSelectedLegIndex(this.legSelector.getSelectedLeg())},D.prototype.handleLegSelectionChanged=function(){this.setSelectedLegIndex(),this.setChartSize(),this.drawChart(),this.updateDirectLink()},D.prototype.handleFilterTextChanged=function(){this.setChartSize(),this.redraw(),this.updateDirectLink()},D.prototype.updateControlEnabledness=function(){var t=this.chartTypeSelector.getChartType();this.classSelector.setOtherClassesEnabled(!t.isResultsTable),this.comparisonSelector.setEnabled(!t.isResultsTable),this.statisticsSelector.setEnabled(!t.isResultsTable),this.originalDataSelector.setEnabled(!t.isResultsTable),this.resultList.enableOrDisableCrossingRunnersButton()},D.prototype.updateFromQueryString=function(t){null===t.classes?this.setDefaultSelectedClass():this.initClasses(t.classes),null!==t.chartType&&(this.chartTypeSelector.setChartType(t.chartType),this.selectChartType(t.chartType)),null!==t.compareWith&&this.comparisonSelector.setComparisonType(t.compareWith.index,t.compareWith.runner),null!==t.selected&&this.selection.setSelectedIndexes(t.selected),null!==t.stats&&this.statisticsSelector.setVisibleStatistics(t.stats),t.showOriginal&&this.courseClassSet.hasDubiousData()&&(this.originalDataSelector.selectOriginalData(),this.selectOriginalOrRepairedData(!0)),null!==t.selectedLeg&&(this.legSelector.setSelectedLeg(t.selectedLeg),this.setSelectedLegIndex()),""!==t.filterText&&this.resultList.setFilterText(t.filterText)},D.prototype.setDefaultSelectedClass=function(){this.initClasses(0<this.classes.length?[0]:[])},SplitsBrowser.Viewer=D,SplitsBrowser.readEvent=function(t,e){if(L()){var s,n;try{s=u(t)}catch(t){if("InvalidData"===t.name)return void N("LoadFailedInvalidData",{$$MESSAGE$$:t.message});throw t}null===s?N("LoadFailedUnrecognisedData",{}):(s.needsRepair()&&h(s),"string"==typeof e&&(e={topBar:e}),s.determineTimeLosses(),e&&e.defaultLanguage&&r(e.defaultLanguage),(n=new D(e)).buildUi(),n.setEvent(s),null!==(e=document.location.search)&&0<e.length?(e=p(e,s),n.updateFromQueryString(e)):n.setDefaultSelectedClass(),n.setResultListHeight(),n.setChartSize(),n.drawChart(),n.registerChangeHandlers())}},SplitsBrowser.loadEvent=function(t,n){L()&&$.ajax({url:t,data:"",success:function(t,e){var s;s=t,t=n,"success"===(e=e)?SplitsBrowser.readEvent(s,t):N("LoadFailedStatusNotSuccess",{$$STATUS$$:e})},dataType:"text",error:O})}}();