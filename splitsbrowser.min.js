/*!
 *  SplitsBrowser - Orienteering results analysis.
 *  
 *  Copyright (C) 2000-2014 Dave Ryder, Reinhard Balling, Andris Strazdins,
 *                          Ed Nash, Luke Woodward
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */
var SplitsBrowser={Version:"3.3.4",Model:{},Input:{},Controls:{},Messages:{}};!function(){"use strict";function a(a){b||(c(a),b=!0)}var b=!1,c=function(a){window.alert(a)},d=null,e=null,f=SplitsBrowser.Messages;SplitsBrowser.setMessageAlerter=function(a){c=a},SplitsBrowser.tryGetMessage=function(a,b){return null!==d&&f[d].hasOwnProperty(a)?SplitsBrowser.getMessage(a):b},SplitsBrowser.getMessage=function(b){return null===e&&SplitsBrowser.initialiseMessages(),null!==d?f[d].hasOwnProperty(b)?f[d][b]:(a("Message not found for key '"+b+"' in language '"+d+"'"),"?????"):(a("No messages found.  Has a language file been loaded?"),"?????")},SplitsBrowser.getMessageWithFormatting=function(a,b){var c=SplitsBrowser.getMessage(a);for(var d in b)if(b.hasOwnProperty(d)){var e=d.replace(/([.+*?|{}()^$\[\]\\])/g,"\\$1");c=c.replace(new RegExp(e,"g"),b[d])}return c},SplitsBrowser.getAllLanguages=function(){return e.slice(0)},SplitsBrowser.getLanguage=function(){return d},SplitsBrowser.getLanguageName=function(a){return f.hasOwnProperty(a)&&f[a].hasOwnProperty("Language")?f[a].Language:"?????"},SplitsBrowser.setLanguage=function(a){f.hasOwnProperty(a)&&(d=a)},SplitsBrowser.initialiseMessages=function(b){e=[],f!==SplitsBrowser.Messages&&a("You appear to have loaded a messages file in the old format.  This file, and all others loaded after it, will not work.\n\nPlease check the messages files.");for(var c in f)f.hasOwnProperty(c)&&e.push(c);0===e.length?a("No messages files were found."):d=b&&f.hasOwnProperty(b)?b:e[0]}}(),function(){"use strict";function a(a){this.name="InvalidData",this.message=a}function b(a){this.name="WrongFileFormat",this.message=a}var c=500;SplitsBrowser.isTrue=function(a){return a},SplitsBrowser.isNotNull=function(a){return null!==a},SplitsBrowser.isNaNStrict=function(a){return a!==a},SplitsBrowser.isNotNullNorNaN=function(a){return null!==a&&a===a},a.prototype.toString=function(){return this.name+": "+this.message},SplitsBrowser.throwInvalidData=function(b){throw new a(b)},b.prototype.toString=function(){return this.name+": "+this.message},SplitsBrowser.throwWrongFileFormat=function(a){throw new b(a)},SplitsBrowser.parseCourseLength=function(a){var b=parseFloat(a.replace(",","."));return isFinite(b)?(b>=c&&(b/=1e3),b):null},SplitsBrowser.parseCourseClimb=function(a){var b=parseInt(a,10);return SplitsBrowser.isNaNStrict(b)?null:b},SplitsBrowser.normaliseLineEndings=function(a){return a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}}(),function(){"use strict";SplitsBrowser.NULL_TIME_PLACEHOLDER="-----";var a=SplitsBrowser.isNaNStrict;SplitsBrowser.formatTime=function(b,c){if(null===b)return SplitsBrowser.NULL_TIME_PLACEHOLDER;if(a(b))return"???";var d="";0>b&&(d="-",b=-b);var e=Math.floor(b/3600),f=Math.floor(b/60)%60,g=b%60;return e>0&&(d+=e.toString()+":"),10>f&&(d+="0"),d+=f+":",10>g&&(d+="0"),d+="number"==typeof c?g.toFixed(c):Math.round(100*g)/100},SplitsBrowser.parseTime=function(a){return a.match(/^\d+:\d\d$/)?60*parseInt(a.substring(0,a.length-3),10)+parseInt(a.substring(a.length-2),10):a.match(/^\d+:\d\d:\d\d$/)?3600*parseInt(a.substring(0,a.length-6),10)+60*parseInt(a.substring(a.length-5,a.length-3),10)+parseInt(a.substring(a.length-2),10):null}}(),function(){"use strict";function a(a,b){return null===a||null===b?null:a+b}function b(a,b){return null===a||null===b?null:a-b}function c(a){if(!$.isArray(a))throw new TypeError("Cumulative times must be an array - got "+typeof a+" instead");0===a.length?i("Array of cumulative times must not be empty"):0!==a[0]?i("Array of cumulative times must have zero as its first item"):1===a.length&&i("Array of cumulative times must contain more than just a single zero");for(var c=[],d=0;d+1<a.length;d+=1)c.push(b(a[d+1],a[d]));return c}function d(a,b,c,d,e,g){typeof a!==f&&i("Competitor order must be a number, got "+typeof a+" '"+a+"' instead"),this.order=a,this.name=b,this.club=c,this.startTime=d,this.isNonCompetitive=!1,this.isNonStarter=!1,this.isNonFinisher=!1,this.isDisqualified=!1,this.isOverMaxTime=!1,this.className=null,this.yearOfBirth=null,this.gender=null,this.originalSplitTimes=e,this.originalCumTimes=g,this.splitTimes=null,this.cumTimes=null,this.splitRanks=null,this.cumRanks=null,this.timeLosses=null,this.totalTime=null===g||g.indexOf(null)>-1?null:g[g.length-1]}function e(a){for(var b=[],c=1;c+1<a.length;)if(h(a[c])){for(var d=c;d+1<a.length&&h(a[d+1]);)d+=1;d+1<a.length&&null!==a[c-1]&&null!==a[d+1]&&b.push({start:c-1,end:d+1}),c=d+1}else c+=1;return b}var f="number",g=SplitsBrowser.isNotNull,h=SplitsBrowser.isNaNStrict,i=SplitsBrowser.throwInvalidData;SplitsBrowser.Model.compareCompetitors=function(a,b){return a.isDisqualified!==b.isDisqualified?a.isDisqualified?1:-1:a.totalTime===b.totalTime?a.order-b.order:null===a.totalTime?null===b.totalTime?0:1:null===b.totalTime?-1:a.totalTime-b.totalTime},d.prototype.setNonCompetitive=function(){this.isNonCompetitive=!0},d.prototype.setNonStarter=function(){this.isNonStarter=!0},d.prototype.setNonFinisher=function(){this.isNonFinisher=!0},d.prototype.disqualify=function(){this.isDisqualified=!0},d.prototype.setOverMaxTime=function(){this.isOverMaxTime=!0},d.prototype.setClassName=function(a){this.className=a},d.prototype.setYearOfBirth=function(a){this.yearOfBirth=a},d.prototype.setGender=function(a){this.gender=a},d.fromOriginalCumTimes=function(a,b,e,f,g){var h=c(g);return new d(a,b,e,f,h,g)},d.fromCumTimes=function(a,b,c,e,f){var g=d.fromOriginalCumTimes(a,b,c,e,f);return g.splitTimes=g.originalSplitTimes,g.cumTimes=g.originalCumTimes,g},d.prototype.setRepairedCumulativeTimes=function(a){this.cumTimes=a,this.splitTimes=c(a)},d.prototype.completed=function(){return null!==this.totalTime&&!this.isDisqualified&&!this.isOverMaxTime},d.prototype.hasAnyTimes=function(){return this.originalCumTimes.slice(1).some(g)},d.prototype.getSplitTimeTo=function(a){return 0===a?0:this.splitTimes[a-1]},d.prototype.getOriginalSplitTimeTo=function(a){return 0===a?0:this.originalSplitTimes[a-1]},d.prototype.isSplitTimeDubious=function(a){return a>0&&this.originalSplitTimes[a-1]!==this.splitTimes[a-1]},d.prototype.getCumulativeTimeTo=function(a){return this.cumTimes[a]},d.prototype.getOriginalCumulativeTimeTo=function(a){return this.originalCumTimes[a]},d.prototype.isCumulativeTimeDubious=function(a){return this.originalCumTimes[a]!==this.cumTimes[a]},d.prototype.getSplitRankTo=function(a){return 0===a?null:this.splitRanks[a-1]},d.prototype.getCumulativeRankTo=function(a){return 0===a?null:this.cumRanks[a-1]},d.prototype.getTimeLossAt=function(a){return 0===a||null===this.timeLosses?null:this.timeLosses[a-1]},d.prototype.getAllCumulativeTimes=function(){return this.cumTimes},d.prototype.getAllOriginalCumulativeTimes=function(){return this.originalCumTimes},d.prototype.lacksStartTime=function(){return null===this.startTime&&this.splitTimes.some(g)},d.prototype.setSplitAndCumulativeRanks=function(a,b){this.splitRanks=a,this.cumRanks=b},d.prototype.getCumTimesAdjustedToReference=function(a){a.length!==this.cumTimes.length?i("Cannot adjust competitor times because the numbers of times are different ("+this.cumTimes.length+" and "+a.length+")"):a.indexOf(null)>-1&&i("Cannot adjust competitor times because a null value is in the reference data");var c=this.cumTimes.map(function(c,d){return b(c,a[d])});return c},d.prototype.getCumTimesAdjustedToReferenceWithStartAdded=function(b){var c=this.getCumTimesAdjustedToReference(b),d=this.startTime;return c.map(function(b){return a(b,d)})},d.prototype.getSplitPercentsBehindReferenceCumTimes=function(a){a.length!==this.cumTimes.length?i("Cannot determine percentages-behind because the numbers of times are different ("+this.cumTimes.length+" and "+a.length+")"):a.indexOf(null)>-1&&i("Cannot determine percentages-behind because a null value is in the reference data");var b=[0];return this.splitTimes.forEach(function(c,d){if(null===c)b.push(null);else{var e=a[d+1]-a[d];e>0?b.push(100*(c-e)/e):b.push(null)}}),b},d.prototype.determineTimeLosses=function(a){if(this.completed())if(a.length!==this.splitTimes.length?i("Cannot determine time loss of competitor with "+this.splitTimes.length+" split times using "+a.length+" fastest splits"):a.some(h)&&i("Cannot determine time loss of competitor when there is a NaN value in the fastest splits"),a.some(function(a){return 0===a}))this.timeLosses=this.splitTimes.map(function(){return 0/0});else if(this.splitTimes.some(h))this.timeLosses=this.splitTimes.map(function(){return 0/0});else{var b=this.splitTimes.map(function(b,c){return b/a[c]});b.sort(d3.ascending);var c;if(1===b.length%2)c=b[(b.length-1)/2];else{var d=b.length/2;c=(b[d-1]+b[d])/2}this.timeLosses=this.splitTimes.map(function(b,d){return Math.round(b-a[d]*c)})}},d.prototype.crosses=function(a){a.cumTimes.length!==this.cumTimes.length&&i("Two competitors with different numbers of controls cannot cross");for(var b=!1,c=!1,d=0;d<this.cumTimes.length;d+=1)if(null!==this.cumTimes[d]&&null!==a.cumTimes[d]){var e=this.startTime+this.cumTimes[d],f=a.startTime+a.cumTimes[d];f>e?b=!0:e>f&&(c=!0)}return b&&c},d.prototype.getControlIndexesAroundDubiousCumulativeTimes=function(){return e(this.cumTimes)},d.prototype.getControlIndexesAroundDubiousSplitTimes=function(){return e([0].concat(this.splitTimes))},SplitsBrowser.Model.Competitor=d}(),function(){"use strict";function a(a,b,c){this.name=a,this.numControls=b,this.competitors=c,this.course=null,this.hasDubiousData=!1,this.competitors.forEach(function(b){b.setClassName(a)})}var b=SplitsBrowser.isNotNullNorNaN,c=SplitsBrowser.throwInvalidData;a.prototype.recordHasDubiousData=function(){this.hasDubiousData=!0},a.prototype.determineTimeLosses=function(){var a=d3.range(1,this.numControls+2).map(function(a){var b=this.getFastestSplitTo(a);return null===b?null:b.split},this);this.competitors.forEach(function(b){b.determineTimeLosses(a)})},a.prototype.isEmpty=function(){return 0===this.competitors.length},a.prototype.setCourse=function(a){this.course=a},a.prototype.getFastestSplitTo=function(a){("number"!=typeof a||1>a||a>this.numControls+1)&&c("Cannot return splits to leg '"+a+"' in a course with "+this.numControls+" control(s)");var d=null,e=null;return this.competitors.forEach(function(c){var f=c.getSplitTimeTo(a);b(f)&&(null===d||d>f)&&(d=f,e=c)}),null===d?null:{split:d,name:e.name}},a.prototype.getCompetitorsAtControlInTimeRange=function(a,b,d){("number"!=typeof a||isNaN(a)||0>a||a>this.numControls+1)&&c("Control number must be a number between 0 and "+this.numControls+" inclusive");var e=[];return this.competitors.forEach(function(c){var f=c.getCumulativeTimeTo(a);if(null!==f&&null!==c.startTime){var g=f+c.startTime;g>=b&&d>=g&&e.push({name:c.name,time:g})}}),e},SplitsBrowser.Model.CourseClass=a}(),function(){"use strict";function a(a){0===a.length&&i("Cannot create a CourseClassSet from an empty set of competitors");var b=[],c=a[0].numControls;return a.forEach(function(a){a.numControls!==c&&i("Cannot merge classes with "+c+" and "+a.numControls+" controls"),a.competitors.forEach(function(a){a.isNonStarter||b.push(a)})}),b.sort(j),b}function b(a){var b=a.filter(h);b.sort(d3.ascending);var c=new d3.map;b.forEach(function(a,b){c.has(a)||c.set(a,b+1)});var d=a.map(function(a){return h(a)?c.get(a):a});return d}function c(b){this.allCompetitors=a(b),this.classes=b,this.numControls=b[0].numControls,this.computeRanks()}function d(a){for(var b=[],c=1;c+1<a.length;)if(h(a[c]))c+=1;else{for(var d=c;d+1<a.length&&!h(a[d+1]);)d+=1;d+1<a.length&&b.push({start:c-1,end:d+1}),c=d+1}return b}function e(a){a=a.slice(0);for(var b=d(a),c=0;c<b.length;c+=1)for(var e=b[c],f=a[e.start],h=a[e.end],i=(h-f)/(e.end-e.start),j=e.start+1;j<e.end;j+=1)a[j]=f+(j-e.start)*i;for(var k=a.length;k>=0&&g(a[k-1]);)k-=1;if(k>0)for(var l=k;l<a.length;l+=1)a[l]=a[l-1]+(l===a.length-1?60:180);return a}var f=SplitsBrowser.isNotNull,g=SplitsBrowser.isNaNStrict,h=SplitsBrowser.isNotNullNorNaN,i=SplitsBrowser.throwInvalidData,j=SplitsBrowser.Model.compareCompetitors;c.prototype.isEmpty=function(){return 0===this.allCompetitors.length},c.prototype.getCourse=function(){return this.classes[0].course},c.prototype.getPrimaryClassName=function(){return this.classes[0].name},c.prototype.getNumClasses=function(){return this.classes.length},c.prototype.hasDubiousData=function(){return this.classes.some(function(a){return a.hasDubiousData})},c.prototype.getWinnerCumTimes=function(){if(0===this.allCompetitors.length)return null;var a=this.allCompetitors[0];return a.completed()?e(a.cumTimes):null},c.prototype.getFastestCumTimes=function(){return this.getFastestCumTimesPlusPercentage(0)},c.prototype.getFastestCumTimesPlusPercentage=function(a){var b=1+a/100,c=new Array(this.numControls+1);c[0]=0;for(var e=1;e<=this.numControls+1;e+=1){for(var g=null,i=0;i<this.allCompetitors.length;i+=1){var j=this.allCompetitors[i].getSplitTimeTo(e);h(j)&&(null===g||g>j)&&(g=j)}c[e]=g}if(!c.every(f)){var k=d(c),l=[];this.allCompetitors.forEach(function(a){var b=d(a.getAllCumulativeTimes());b.forEach(function(b){l.push({start:b.start,end:b.end,size:b.end-b.start,overallSplit:a.getCumulativeTimeTo(b.end)-a.getCumulativeTimeTo(b.start)})})}),k.forEach(function(a){var b=l.filter(function(b){return b.start<=a.start&&a.end<=b.end+1}),d=null,e=null;if(b.forEach(function(a){(null===d||a.size<d)&&(d=a.size,e=null),(null===e||a.overallSplit<e)&&(e=a.overallSplit)}),null!==d&&null!==e)for(var f=a.start+1;f<a.end;f+=1)c[f]=e/d})}if(!c.every(f))for(var m=0;m<c.length;m+=1)null===c[m]&&(c[m]=m===c.length-1?60:180);var n=new Array(this.numControls+1);return c.forEach(function(a,c){n[c]=0===c?0:n[c-1]+a*b}),n},c.prototype.getCumulativeTimesForCompetitor=function(a){return e(this.allCompetitors[a].getAllCumulativeTimes())},c.prototype.computeRanks=function(){var a=[],c=[];this.allCompetitors.forEach(function(){a.push([]),c.push([])}),d3.range(1,this.numControls+2).forEach(function(c){var d=this.allCompetitors.map(function(a){return a.getSplitTimeTo(c)}),e=b(d);this.allCompetitors.forEach(function(b,c){a[c].push(e[c])})},this),d3.range(1,this.numControls+2).forEach(function(a){var d=this.allCompetitors.map(function(b,d){return a>1&&null===c[d][a-1-1]?null:b.getCumulativeTimeTo(a)}),e=b(d);this.allCompetitors.forEach(function(a,b){c[b].push(e[b])})},this),this.allCompetitors.forEach(function(b,d){b.setSplitAndCumulativeRanks(a[d],c[d])})},c.prototype.getFastestSplitsTo=function(a,b){if("number"!=typeof a||0>=a)i("The number of splits must be a positive integer");else{if(!("number"!=typeof b||0>=b||b>this.numControls+1)){var c=function(a,c){var d=a.getSplitTimeTo(b),e=c.getSplitTimeTo(b);return d===e?d3.ascending(a.totalTime,c.totalTime):d3.ascending(d,e)},d=this.allCompetitors.filter(function(a){return a.completed()&&!g(a.getSplitTimeTo(b))});d.sort(c);for(var e=[],f=0;f<d.length&&a>f;f+=1)e.push({name:d[f].name,split:d[f].getSplitTimeTo(b)});return e}i("Control "+b+" out of range")}},c.prototype.getChartData=function(a,b,c){if("undefined"==typeof a)throw new TypeError("referenceCumTimes undefined or missing");if("undefined"==typeof b)throw new TypeError("currentIndexes undefined or missing");if("undefined"==typeof c)throw new TypeError("chartType undefined or missing");var d,e,f=this.allCompetitors.map(function(b){return c.dataSelector(b,a)}),g=b.map(function(a){return f[a]}),h=d3.min(a),i=d3.max(a);if(0===b.length)if(this.isEmpty())d=0,e=60;else{var j=f[0];d=d3.min(j),e=d3.max(j)}else d=d3.min(g.map(function(a){return d3.min(a)})),e=d3.max(g.map(function(a){return d3.max(a)}));e===d&&(e=d+1);var k=c.skipStart?1:0,l=b.map(function(a){var b=c.indexesAroundDubiousTimesFunc(this.allCompetitors[a]);return b.filter(function(a){return a.start>=k}).map(function(a){return{start:a.start-k,end:a.end-k}})},this),m=d3.transpose(g),n=c.skipStart?a.slice(1):a,o=d3.zip(n,m),p=b.map(function(a){return this.allCompetitors[a].name},this);return{dataColumns:o.map(function(a){return{x:a[0],ys:a[1]}}),competitorNames:p,numControls:this.numControls,xExtent:[h,i],yExtent:[d,e],dubiousTimesInfo:l}},SplitsBrowser.Model.CourseClassSet=c}(),function(){"use strict";function a(a,b,c,d,e){this.name=a,this.classes=b,this.length=c,this.climb=d,this.controls=e}var b=SplitsBrowser.throwInvalidData;a.START="__START__",a.FINISH="__FINISH__";var c=a.START,d=a.FINISH;a.prototype.getOtherClasses=function(a){var c=this.classes.filter(function(b){return b!==a});return c.length!==this.classes.length?c:(b("Course.getOtherClasses: given class is not in this course"),void 0)},a.prototype.getNumClasses=function(){return this.classes.length},a.prototype.hasControls=function(){return null!==this.controls},a.prototype.getControlCode=function(a){return 0===a?c:a>=1&&a<=this.controls.length?this.controls[a-1]:a===this.controls.length+1?d:(b("Cannot get control code of control "+a+" because it is out of range"),void 0)},a.prototype.usesLeg=function(a,b){return this.getLegNumber(a,b)>=0},a.prototype.getLegNumber=function(a,b){if(null===this.controls)return-1;if(a===c&&b===d)return 0===this.controls.length?1:-1;if(a===c)return this.controls.length>0&&this.controls[0]===b?1:-1;if(b===d)return this.controls.length>0&&this.controls[this.controls.length-1]===a?this.controls.length+1:-1;for(var e=1;e<this.controls.length;e+=1)if(this.controls[e-1]===a&&this.controls[e]===b)return e+1;return-1},a.prototype.getFastestSplitsForLeg=function(a,e){null===this.legs&&b("Cannot determine fastest splits for a leg because leg information is not available");var f=this.getLegNumber(a,e);if(0>f){var g=(a===c?"start":a)+" to "+(e===d?"end":e);b("Leg from "+g+" not found in course "+this.name)}var h=f,i=[];return this.classes.forEach(function(a){var b=a.getFastestSplitTo(h);null!==b&&i.push({name:b.name,className:a.name,split:b.split})}),i},a.prototype.getCompetitorsAtControlInTimeRange=function(a,b,e){if(null===this.controls)return[];if(a===c)return this.getCompetitorsAtControlNumInTimeRange(0,b,e);if(a===d)return this.getCompetitorsAtControlNumInTimeRange(this.controls.length+1,b,e);var f=this.controls.indexOf(a);return f>=0?this.getCompetitorsAtControlNumInTimeRange(f+1,b,e):[]},a.prototype.getCompetitorsAtControlNumInTimeRange=function(a,b,c){var d=[];return this.classes.forEach(function(e){e.getCompetitorsAtControlInTimeRange(a,b,c).forEach(function(a){d.push({name:a.name,time:a.time,className:e.name})})}),d},a.prototype.hasControl=function(a){return null!==this.controls&&this.controls.indexOf(a)>-1},a.prototype.getNextControls=function(a){if(null===this.controls)b("Course has no controls");else if(a===d)b("Cannot fetch next control after the finish");else{if(a===c)return[0===this.controls.length?d:this.controls[0]];for(var e=-1,f=[];;){var g=this.controls.indexOf(a,e+1);if(-1===g)break;g===this.controls.length-1?f.push(d):f.push(this.controls[g+1]),e=g}if(0!==f.length)return f;b("Control '"+a+"' not found on course "+this.name)}},SplitsBrowser.Model.Course=a}(),function(){"use strict";function a(a,b){this.classes=a,this.courses=b}var b=SplitsBrowser.Model.Course;a.prototype.determineTimeLosses=function(){this.classes.forEach(function(a){a.determineTimeLosses()})},a.prototype.needsRepair=function(){return this.classes.some(function(a){return a.competitors.some(function(a){return null===a.getAllCumulativeTimes()})})},a.prototype.getFastestSplitsForLeg=function(a,b){var c=[];return this.courses.forEach(function(d){d.usesLeg(a,b)&&(c=c.concat(d.getFastestSplitsForLeg(a,b)))}),c.sort(function(a,b){return d3.ascending(a.split,b.split)}),c},a.prototype.getCompetitorsAtControlInTimeRange=function(a,b,c){var d=[];return this.courses.forEach(function(e){e.getCompetitorsAtControlInTimeRange(a,b,c).forEach(function(a){d.push(a)})}),d.sort(function(a,b){return d3.ascending(a.time,b.time)}),d},a.prototype.getNextControlsAfter=function(a){var c=this.courses;return a!==b.START&&(c=c.filter(function(b){return b.hasControl(a)})),c.map(function(b){return{course:b,nextControls:b.getNextControls(a)}})},SplitsBrowser.Model.Event=a}(),function(){function a(a){return null===a?null:a/60}function b(a){return a.getControlIndexesAroundDubiousCumulativeTimes()}function c(a){return a.getControlIndexesAroundDubiousSplitTimes()}SplitsBrowser.Model.ChartTypes={SplitsGraph:{nameKey:"SplitsGraphChartType",dataSelector:function(b,c){return b.getCumTimesAdjustedToReference(c).map(a)},skipStart:!1,yAxisLabelKey:"SplitsGraphYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundDubiousTimesFunc:b},RaceGraph:{nameKey:"RaceGraphChartType",dataSelector:function(b,c){return b.getCumTimesAdjustedToReferenceWithStartAdded(c).map(a)},skipStart:!1,yAxisLabelKey:"RaceGraphYAxisLabel",isRaceGraph:!0,isResultsTable:!1,minViewableControl:0,indexesAroundDubiousTimesFunc:b},PositionAfterLeg:{nameKey:"PositionAfterLegChartType",dataSelector:function(a){return a.cumRanks},skipStart:!0,yAxisLabelKey:"PositionYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundDubiousTimesFunc:b},SplitPosition:{nameKey:"SplitPositionChartType",dataSelector:function(a){return a.splitRanks},skipStart:!0,yAxisLabelKey:"PositionYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundDubiousTimesFunc:c},PercentBehind:{nameKey:"PercentBehindChartType",dataSelector:function(a,b){return a.getSplitPercentsBehindReferenceCumTimes(b)},skipStart:!1,yAxisLabelKey:"PercentBehindYAxisLabel",isRaceGraph:!1,isResultsTable:!1,minViewableControl:1,indexesAroundDubiousTimesFunc:c},ResultsTable:{nameKey:"ResultsTableChartType",dataSelector:null,skipStart:!1,yAxisLabelKey:null,isRaceGraph:!1,isResultsTable:!0,minViewableControl:1,indexesAroundDubiousTimesFunc:null}}}(),function(){"use strict";function a(a){typeof a!==b?c("Competitor count must be a number"):0>a&&c("Competitor count must be a non-negative number"),this.count=a,this.currentIndexes=[],this.changeHandlers=[]}var b="number",c=SplitsBrowser.throwInvalidData;a.prototype.isSelected=function(a){return this.currentIndexes.indexOf(a)>-1},a.prototype.isSingleRunnerSelected=function(){return 1===this.currentIndexes.length},a.prototype.getSingleRunnerIndex=function(){return this.isSingleRunnerSelected()?this.currentIndexes[0]:null},a.prototype.selectCrossingRunners=function(a){if(this.isSingleRunnerSelected()){var b=a[this.currentIndexes[0]].competitor;a.forEach(function(a,c){a.visible&&a.competitor.crosses(b)&&this.currentIndexes.push(c)},this),this.currentIndexes.sort(d3.ascending),this.fireChangeHandlers()}},a.prototype.fireChangeHandlers=function(){this.changeHandlers.forEach(function(a){a(this.currentIndexes.slice(0))},this)},a.prototype.selectAll=function(){this.currentIndexes=d3.range(this.count),this.fireChangeHandlers()},a.prototype.selectNone=function(){this.currentIndexes=[],this.fireChangeHandlers()},a.prototype.getSelectedIndexes=function(){return this.currentIndexes.slice(0)},a.prototype.setSelectedIndexes=function(a){a.every(function(a){return a>=0&&a<this.count},this)&&(this.currentIndexes=a,this.fireChangeHandlers())},a.prototype.registerChangeHandler=function(a){-1===this.changeHandlers.indexOf(a)&&this.changeHandlers.push(a)},a.prototype.deregisterChangeHandler=function(a){var b=this.changeHandlers.indexOf(a);b>-1&&this.changeHandlers.splice(b,1)},a.prototype.toggle=function(a){if(typeof a===b)if(a>=0&&a<this.count){var d=this.currentIndexes.indexOf(a);-1===d?(this.currentIndexes.push(a),this.currentIndexes.sort(d3.ascending)):this.currentIndexes.splice(d,1),this.fireChangeHandlers()}else c("Index '"+a+"' is out of range");else c("Index is not a number")},a.prototype.bulkSelect=function(a){a.some(function(a){return typeof a!==b||0>a||a>=this.count},this)&&c("Indexes not all numeric and in range");var d=d3.set(this.currentIndexes);a=a.filter(function(a){return!d.has(a)}),a.length>0&&(this.currentIndexes=this.currentIndexes.concat(a),this.currentIndexes.sort(d3.ascending),this.fireChangeHandlers())},a.prototype.bulkDeselect=function(a){a.some(function(a){return typeof a!==b||0>a||a>=this.count},this)&&c("Indexes not all numeric and in range");for(var d=d3.set(this.currentIndexes),e=!1,f=0;f<a.length;f+=1)d.has(a[f])&&(d.remove(a[f]),e=!0);e&&(this.currentIndexes=d.values().map(function(a){return parseInt(a,10)}),this.currentIndexes.sort(d3.ascending),this.fireChangeHandlers())},a.prototype.migrate=function(a,b){$.isArray(a)?$.isArray(b)?a.length!==this.count?c("CompetitorSelection.migrate: oldCompetitors list must have the same length as the current count"):0===b.length&&this.currentIndexes.length>0&&c("CompetitorSelection.migrate: newCompetitors list must not be empty if current list has competitors selected"):c("CompetitorSelection.migrate: newCompetitors not an array"):c("CompetitorSelection.migrate: oldCompetitors not an array");var d=this.currentIndexes.map(function(b){return a[b]});this.count=b.length,this.currentIndexes=[],b.forEach(function(a,b){d.indexOf(a)>=0&&this.currentIndexes.push(b)},this)},SplitsBrowser.Model.CompetitorSelection=a}(),function(){"use strict";function a(a){(0===a.length||0!==a[0])&&e("cumulative times array does not start with a zero cumulative time");for(var b=0,c=1;c<a.length;c+=1){var f=a[c];if(d(f)){if(f<=a[b])return{first:b,second:c};b=c}}return null}function b(a){var b=new g;b.repairEventData(a)}function c(a){a.classes.forEach(function(a){a.competitors.forEach(function(a){a.setRepairedCumulativeTimes(a.getAllOriginalCumulativeTimes())})})}var d=SplitsBrowser.isNotNullNorNaN,e=SplitsBrowser.throwInvalidData,f=5,g=function(){this.madeAnyChanges=!1};g.prototype.removeCumulativeTimesEqualToPrevious=function(a){for(var b=a[0],c=1;c+1<a.length;c+=1)null!==a[c]&&a[c]===b?(a[c]=0/0,this.madeAnyChanges=!0):b=a[c]},g.prototype.removeCumulativeTimesCausingNegativeSplits=function(b){for(var c=a(b);null!==c&&c.second+1<b.length;){for(var e=c.first,f=c.second,g=!1,h=1;3>=h;h+=1){var i=b.slice();if(3!==h||1!==e&&d(b[e-1])){1===h?i[f]=0/0:2===h?i[e]=0/0:3===h&&(i[e]=0/0,i[e-1]=0/0);var j=a(i);if(null===j||j.first>f){g=!0,b=i,this.madeAnyChanges=!0,c=j;break}}else;}if(!g)break}return b},g.prototype.removeFinishTimeIfAbsurd=function(a){var b=a[a.length-1],c=a[a.length-2];d(b)&&d(c)&&c-60*f>=b&&(a[a.length-1]=0/0,this.madeAnyChanges=!0)},g.prototype.repairCompetitor=function(a){var b=a.originalCumTimes.slice(0);this.removeCumulativeTimesEqualToPrevious(b),b=this.removeCumulativeTimesCausingNegativeSplits(b),a.completed()||this.removeFinishTimeIfAbsurd(b),a.setRepairedCumulativeTimes(b)},g.prototype.repairCourseClass=function(a){this.madeAnyChanges=!1,a.competitors.forEach(function(a){this.repairCompetitor(a)},this),this.madeAnyChanges&&a.recordHasDubiousData()},g.prototype.repairEventData=function(a){a.classes.forEach(function(a){this.repairCourseClass(a)},this)},SplitsBrowser.DataRepair={repairEventData:b,transferCompetitorData:c}}(),function(){"use strict";function a(a,b,c){var d=b.split(",");if(d.length===c+5){var f=d.shift(),g=d.shift(),j=d.shift(),k=d.shift(),l=h(k);0===l?l=null:k.match(/^\d+:\d\d:\d\d$/)||(l*=60);var m=[0],n=0;d.map(function(a){var b=h(a);null!==b&&b>0?(n+=b,m.push(n)):m.push(null)});var o=i.fromCumTimes(a+1,f+" "+g,j,l,m);return 0===n&&o.setNonStarter(),o}e("Expected "+(c+5)+" items in row for competitor in class with "+c+" controls, got "+d.length+" instead.")}function b(b){var c=b.split(/\r?\n/).filter(d);0===c.length&&e("parseCourseClass got an empty list of lines");var g=c.shift().split(",");if(2===g.length){var h=g.shift(),i=g.shift(),l=parseInt(i,10);if(isNaN(l))e("Could not read control count: '"+i+"'");else{if(!(0>l&&c.length>0)){var m=c.map(function(b,c){return a(c,b,l)});return m.sort(j),new k(h,l,m)}e("Expected a non-negative control count, got "+l+" instead")}}else f("Expected first line to have two parts (class name and number of controls), got "+g.length+" part(s) instead")}function c(a){/<html/i.test(a)&&f("Cannot parse this file as CSV as it appears to be HTML"),a=g(a),a=a.replace(/,+\n/g,"\n").replace(/,+$/,"");var c=a.split(/\n\n/).map($.trim).filter(d),h=c.map(b);h=h.filter(function(a){return!a.isEmpty()}),0===h.length&&e("No competitor data was found");for(var i=h.map(function(a){return new l(a.name,[a],null,null,null)}),j=0;j<h.length;j+=1)h[j].setCourse(i[j]);return new m(h,i)}var d=SplitsBrowser.isTrue,e=SplitsBrowser.throwInvalidData,f=SplitsBrowser.throwWrongFileFormat,g=SplitsBrowser.normaliseLineEndings,h=SplitsBrowser.parseTime,i=SplitsBrowser.Model.Competitor,j=SplitsBrowser.Model.compareCompetitors,k=SplitsBrowser.Model.CourseClass,l=SplitsBrowser.Model.Course,m=SplitsBrowser.Model.Event;SplitsBrowser.Input.CSV={parseEventData:c}}(),function(){"use strict";function a(a){return'"'===a[0]&&'"'===a[a.length-1]&&(a=$.trim(a.substring(1,a.length-1).replace(/""/g,'"'))),a}function b(a){this.data=h(a),this.classes=d3.map(),this.courseDetails=d3.map(),this.classCoursePairs=[],this.anyCompetitors=!1,this.columnIndexes=null}var c=SplitsBrowser.throwInvalidData,d=SplitsBrowser.throwWrongFileFormat,e=SplitsBrowser.isNaNStrict,f=SplitsBrowser.parseCourseLength,g=SplitsBrowser.parseCourseClimb,h=SplitsBrowser.normaliseLineEndings,i=SplitsBrowser.parseTime,j=SplitsBrowser.Model.Competitor.fromOriginalCumTimes,k=SplitsBrowser.Model.CourseClass,l=SplitsBrowser.Model.Course,m=SplitsBrowser.Model.Event,n=[";",",","	","\\"],o={};[44,46,60].forEach(function(a){o[a]={course:a-7,distance:a-6,climb:a-5,controlCount:a-4,placing:a-3,startPunch:a-2,finish:a-1,control1:a}}),[44,46].forEach(function(a){o[a].nonCompetitive=a-38,o[a].startTime=a-37,o[a].time=a-35,o[a].classifier=a-34,o[a].club=a-31,o[a].className=a-28}),o[44].combinedName=3,o[44].yearOfBirth=4,o[46].forename=4,o[46].surname=3,o[46].yearOfBirth=5,o[46].gender=6,o[60].forename=6,o[60].surname=5,o[60].yearOfBirth=7,o[60].gender=8,o[60].combinedName=3,o[60].nonCompetitive=10,o[60].startTime=11,o[60].time=13,o[60].classifier=14,o[60].club=20,o[60].className=26,o[60].classNameFallback=o[60].course,o[60].clubFallback=18;var p=37;b.prototype.identifyDelimiter=function(){this.lines.length<=1&&d("No data found to read");for(var a=this.lines[1],b=0;b<n.length;b+=1){var c=n[b];if(a.split(c).length>p)return c}d("Data appears not to be in the SI CSV format")},b.prototype.identifyFormatVariation=function(a){for(var b=this.lines[1].split(a),c=b.length-1;c>0&&""===$.trim(b[c]);)c-=1;var e=/^[A-Za-z0-9]+$/,f=null;for(e.test(b[c-1])?f=c-1:e.test(b[c])?f=c:d("Could not find control number in last two columns of first data line");f>=2&&e.test(b[f-2]);)f-=2;null===f?d("Unable to find index of control 1 in SI CSV data"):o.hasOwnProperty(f)?this.columnIndexes=o[f]:d("Unsupported index of control 1: "+f)},b.prototype.getClassName=function(a){var b=a[this.columnIndexes.className];return""===b&&this.columnIndexes.hasOwnProperty("classNameFallback")&&(b=a[this.columnIndexes.classNameFallback]),b},b.prototype.getStartTime=function(a){var b=a[this.columnIndexes.startPunch];return""===b&&(b=a[this.columnIndexes.startTime]),i(b)},b.prototype.getNumControls=function(a,b){var d=this.getClassName(a);return""!==$.trim(d)?this.classes.has(d)?this.classes.get(d).numControls:parseInt(a[this.columnIndexes.controlCount],10):(c("Line "+b+" does not contain a class for the competitor"),void 0)},b.prototype.readCumulativeTimes=function(a,b,c){for(var d=[0],e=0;c>e;e+=1){var f=this.columnIndexes.control1+1+2*e,g=f<a.length?a[f]:null,h=null===g?null:i(g);d.push(h)}var j=i(a[this.columnIndexes.time]);if(null===j){var k=this.getStartTime(a),l=i(a[this.columnIndexes.finish]);null!==k&&null!==l&&(j=l-k)}return d.push(j),d},b.prototype.createClassIfNecessary=function(a,b){var c=this.getClassName(a);this.classes.has(c)||this.classes.set(c,{numControls:b,competitors:[]})},b.prototype.createCourseIfNecessary=function(a,b){var c=a[this.columnIndexes.course];if(!this.courseDetails.has(c)){var d=d3.range(0,b).map(function(b){return a[this.columnIndexes.control1+2*b]},this);this.courseDetails.set(c,{length:f(a[this.columnIndexes.distance]),climb:g(a[this.columnIndexes.climb]),controls:d})}},b.prototype.createClassCoursePairIfNecessary=function(a){var b=this.getClassName(a),c=a[this.columnIndexes.course];
this.classCoursePairs.some(function(a){return a[0]===b&&a[1]===c})||this.classCoursePairs.push([b,c])},b.prototype.addCompetitor=function(a,b){var c=this.getClassName(a),d=a[this.columnIndexes.placing],f=a[this.columnIndexes.club];""===f&&this.columnIndexes.hasOwnProperty("clubFallback")&&(f=a[this.columnIndexes.clubFallback]);var g=this.getStartTime(a),h=""!==d&&e(parseInt(d,10)),i="";if(this.columnIndexes.hasOwnProperty("forename")&&this.columnIndexes.hasOwnProperty("surname")){var k=a[this.columnIndexes.forename],l=a[this.columnIndexes.surname];h&&l.substring(l.length-d.length)===d&&(l=$.trim(l.substring(0,l.length-d.length))),i=$.trim(k+" "+l)}""===i&&this.columnIndexes.hasOwnProperty("combinedName")&&(i=a[this.columnIndexes.combinedName],h&&i.substring(i.length-d.length)===d&&(i=$.trim(i.substring(0,i.length-d.length))));var m=this.classes.get(c).competitors.length+1,n=j(m,i,f,g,b);("1"===a[this.columnIndexes.nonCompetitive]||h)&&n.completed()&&n.setNonCompetitive();var o=a[this.columnIndexes.classifier];""!==o&&"0"!==o?"1"===o?n.setNonStarter():"2"===o?n.setNonFinisher():"4"===o?n.disqualify():"5"===o&&n.setOverMaxTime():n.hasAnyTimes()||n.setNonStarter();var p=a[this.columnIndexes.yearOfBirth];if(""!==p){var q=parseInt(p,10);e(q)||n.setYearOfBirth(q)}if(this.columnIndexes.hasOwnProperty("gender")){var r=a[this.columnIndexes.gender];("M"===r||"F"===r)&&n.setGender(r)}this.classes.get(c).competitors.push(n)},b.prototype.readLine=function(b,d,e){if(""!==$.trim(b)){var f=b.split(e).map($.trim).map(a);f.length<p&&c("Too few items on line "+d+" of the input file: expected at least "+p+", got "+f.length);var g=this.getNumControls(f,d),h=this.readCumulativeTimes(f,d,g);this.anyCompetitors=!0,this.createClassIfNecessary(f,g),this.createCourseIfNecessary(f,g),this.createClassCoursePairIfNecessary(f),this.addCompetitor(f,h)}},b.prototype.getMapsBetweenClassesAndCourses=function(){var a=d3.map(),b=d3.map();return this.classCoursePairs.forEach(function(c){var d=c[0],e=c[1];a.has(d)?a.get(d).push(e):a.set(d,[e]),b.has(e)?b.get(e).push(d):b.set(e,[d])}),{classesToCourses:a,coursesToClasses:b}},b.prototype.createClasses=function(){var a=this.classes.keys();return a.sort(),a.map(function(a){var b=this.classes.get(a);return new k(a,b.numControls,b.competitors)},this)},b.prototype.createCourseFromLinkedClassesAndCourses=function(a,b,c,d){for(var e,f,g=[a],h=[],i=[],j=[];g.length>0||h.length>0;){for(;g.length>0;){e=g.shift();for(var k=b.coursesToClasses.get(e),m=0;m<k.length;m+=1)f=k[m],h.indexOf(f)<0&&j.indexOf(f)<0&&h.push(f);i.push(e)}for(;h.length>0;){f=h.shift();for(var n=b.classesToCourses.get(f),o=0;o<n.length;o+=1)e=n[o],g.indexOf(e)<0&&i.indexOf(e)<0&&g.push(e);j.push(f)}}i.forEach(function(a){c.add(a)});var p=j.map(function(a){return d.get(a)}),q=this.courseDetails.get(a),r=new l(a,p,q.length,q.climb,q.controls);return p.forEach(function(a){a.setCourse(r)}),r},b.prototype.determineCourses=function(a){var b=this.getMapsBetweenClassesAndCourses(),c=d3.set(),d=d3.map();a.forEach(function(a){d.set(a.name,a)});var e=[];return b.coursesToClasses.keys().forEach(function(a){if(!c.has(a)){var f=this.createCourseFromLinkedClassesAndCourses(a,b,c,d);e.push(f)}},this),e},b.prototype.parseEventData=function(){this.lines=this.data.split(/\n/);var a=this.identifyDelimiter();this.identifyFormatVariation(a),this.lines.shift(),this.lines.forEach(function(b,c){this.readLine(b,c+1,a)},this),this.anyCompetitors||c("No competitors' data were found");var b=this.createClasses(),d=this.determineCourses(b);return new m(b,d)},SplitsBrowser.Input.SI={},SplitsBrowser.Input.SI.parseEventData=function(a){var c=new b(a);return c.parseEventData()}}(),function(){"use strict";function a(a){return null!==a&&""!==a}function b(a){return a=$.trim(a),""!==a&&isFinite(a)}function c(b){return b.split(/\s+/g).filter(a)}function d(a){return a.replace(A,"")}function e(a,b){for(var c,e=[];;){if(c=a.exec(b),null===c)break;e.push(d(c[1]))}return e}function f(a){return e(/<font[^>]*>(.*?)<\/font>/g,a)}function g(a){return e(/<td[^>]*>(.*?)<\/td>/g,a).map($.trim)}function h(a){return g(a).filter(function(a){return""!==a})}function i(a){var b=e(/<th[^>]*>(.*?)<\/th>/g,a);return b.filter(function(a){return""!==a})}function j(a){var b=B.exec(a);return null===b?null:t(b[1])}function k(a){var b=C.exec(a);return null===b?null:parseInt(b[1],10)}function l(a){for(var b=[],c=0;c<a.length;c+=1){var d=a[c],e=d.indexOf("(");if(e>-1&&")"===d[d.length-1]){var f=d.substring(e+1,d.length-1);b.push(f)}else c+1===a.length?b.push(null):r("Unrecognised control header label: '"+d+"'")}return b}function m(a,b){for(;b.length>0&&"*"===b[b.length-1][0];)b.splice(b.length-1,1),a.splice(a.length-1,1)}function n(a,b,c,d,e,f){this.name=a,this.club=b,this.className=c,this.totalTime=d,this.cumTimes=e,this.competitive=f}function o(a,b,c){this.name=a,this.distance=b,this.climb=c,this.controls=[],this.competitors=[]}function p(a){this.recognizer=a,this.courses=[],this.currentCourse=null,this.lines=null,this.linePos=-1,this.currentCompetitor=null}var q=SplitsBrowser.isNotNull,r=SplitsBrowser.throwInvalidData,s=SplitsBrowser.throwWrongFileFormat,t=SplitsBrowser.parseCourseLength,u=SplitsBrowser.normaliseLineEndings,v=SplitsBrowser.parseTime,w=SplitsBrowser.Model.Competitor.fromOriginalCumTimes,x=SplitsBrowser.Model.CourseClass,y=SplitsBrowser.Model.Course,z=SplitsBrowser.Model.Event,A=/<[^>]+>/g,B=/([0-9.,]+)\s*(?:Km|km)/,C=/(\d+)\s*(?:Cm|Hm|hm|m)/;n.prototype.isContinuation=function(){return""===this.name&&""===this.club&&null===this.className&&""===this.totalTime&&!this.competitive},n.prototype.append=function(a){if(!a.isContinuation())throw new Error("Can only append a continuation CompetitorParseRecord");this.cumTimes=this.cumTimes.concat(a.cumTimes)},n.prototype.toCompetitor=function(a){var b=[0].concat(this.cumTimes),c=w(a,this.name,this.club,null,b);return c.completed()&&!this.competitive&&c.setNonCompetitive(),c.hasAnyTimes()||c.setNonStarter(),c};var D=function(){this.precedingColumnCount=null};D.prototype.isTextOfThisFormat=function(a){return a.indexOf("<pre>")>=0&&a.indexOf("<font")>=0},D.prototype.preprocess=function(a){var b=a.indexOf("<pre>");if(-1===b)throw new Error("Cannot find opening pre tag");var c=a.indexOf("\n",b);a=a.substring(c+1);var d=a.lastIndexOf("</pre>");return-1===d&&r("Found opening <pre> but no closing </pre>"),c=a.lastIndexOf("\n",d),a=a.substring(0,c),$.trim(a)},D.prototype.canIgnoreThisLine=function(a){return""===a},D.prototype.isCourseHeaderLine=function(a){return 2===f(a).length},D.prototype.parseCourseHeaderLine=function(a){var b=f(a);if(2!==b.length)throw new Error("Course header line should have two parts");var c=b[0],d=b[1],e=c.indexOf("("),g=e>-1?c.substring(0,e):c,h=j(d),i=k(d);return{name:$.trim(g),distance:h,climb:i}},D.prototype.parseControlsLine=function(a){var b=a.lastIndexOf("</font>"),d=-1===b?a:a.substring(b+"</font>".length),e=c($.trim(d));return l(e)},D.prototype.readCompetitorSplitDataLine=function(a){for(var b=0;b<this.precedingColumnCount;b+=1){var e=a.indexOf("</font>");a=a.substring(e+"</font>".length)}var f=c(d(a));return f},D.prototype.parseCompetitor=function(a,d){var e=f(a),g=f(d);if(null===this.precedingColumnCount){var h=$.trim(e[1]);this.precedingColumnCount=h.match(/^\d*$/)?4:3}var i=b(e[0]),j=$.trim(e[this.precedingColumnCount-2]),k=$.trim(e[this.precedingColumnCount-1]),l=$.trim(g[this.precedingColumnCount-2]),o=this.readCompetitorSplitDataLine(a),p=this.readCompetitorSplitDataLine(d);o=o.map(v),m(o,p);var q=null;if(null!==j&&""!==j){for(var r=-1,s=0;s<this.precedingColumnCount;s+=1)r=a.indexOf("</font>",r+1);var t=a.substring(0,r+"</font>".length),u=t.replace(/<font[^>]*>(.*?)<\/font>/g,""),w=c(u);w.length>0&&(q=w[0])}return new n(j,l,q,k,o,i)};var E=function(){this.currentCourseHasClass=!1};E.prototype.isTextOfThisFormat=function(a){for(var b=-1,c=0;5>c;c+=1)if(b=a.indexOf("<table",b+1),-1===b)return!1;return!0},E.prototype.preprocess=function(a){var b=a.indexOf("</table>");-1===b&&r("Could not find any closing </table> tags"),a=a.substring(b+"</table>".length);var c=a.indexOf("</div>"),d=a.indexOf("<table");return c>-1&&d>c&&(a=a.substring(c+"</div>".length)),a=a.replace(/>\n</g,"><").replace(/><tr>/g,">\n<tr>").replace(/<\/tr></g,"</tr>\n<").replace(/><table/g,">\n<table").replace(/<\/table></g,"</table>\n<"),a=a.replace(/<\/col[^>]*>/g,""),a=a.replace(/<tr[^>]*><td[^>]*>(?:<nobr>)?&nbsp;?(?:<\/nobr>)?<\/td><\/tr>/g,""),a=a.replace("</body></html>",""),$.trim(a)},E.prototype.canIgnoreThisLine=function(a){if(a.indexOf("<th>")>-1){var b=i(a);return this.currentCourseHasClass=5===b.length,!0}return""===a||a.indexOf("<table")>-1||a.indexOf("</table>")>-1},E.prototype.isCourseHeaderLine=function(a){return a.indexOf('<td id="header"')>-1},E.prototype.parseCourseHeaderLine=function(a){var b=h(a);0===b.length&&r("No parts found in course header line");var c=b[0],d=c.indexOf("(");d>-1&&(c=c.substring(0,d)),c=$.trim(c);for(var e=null,f=null,g=1;g<b.length;g+=1)null===e&&(e=j(b[g])),null===f&&(f=k(b[g]));return{name:c,distance:e,climb:f}},E.prototype.parseControlsLine=function(a){var b=h(a);return l(b)},E.prototype.readCompetitorSplitDataLine=function(b){for(var c=g(b),d=this.currentCourseHasClass?5:4,e=c.length;e>0&&""===c[e-1];)e-=1;return c.slice(d,e).filter(a)},E.prototype.parseCompetitor=function(a,c){var d=g(a),e=g(c),f=b(d[0]),h=d[2],i=d[this.currentCourseHasClass?4:3],j=e[2],k=this.currentCourseHasClass&&""!==h?d[3]:null,l=this.readCompetitorSplitDataLine(a),o=this.readCompetitorSplitDataLine(c);l=l.map(v),m(l,o);var p=l.filter(q).length;return p!==o.length&&r("Cumulative and split times do not have the same length: "+p+" cumulative times, "+o.length+" split times"),new n(h,j,k,i,l,f)};var F=function(){this.usesClasses=!1};F.prototype.isTextOfThisFormat=function(a){var b=a.indexOf("<table");if(b>=0){var c=a.indexOf("<table",b+1);if(c>=0){var d=a.indexOf("<table",c+1);if(0>d)return!0}}return!1},F.prototype.preprocess=function(a){var b=a.indexOf("</table>");return-1===b&&r("Could not find any closing </table> tags"),a.indexOf('<td colspan="25">')>=0&&(this.usesClasses=!0),a=a.substring(b+"</table>".length),a=a.replace(/<tr[^>]*><td colspan=[^>]*>&nbsp;<\/td><\/tr>/g,""),a=a.replace("</body>","").replace("</html>",""),$.trim(a)},F.prototype.canIgnoreThisLine=function(a){return""===a||a.indexOf("<table")>-1||a.indexOf("</table>")>-1||a.indexOf("<hr>")>-1},F.prototype.isCourseHeaderLine=function(a){return a.indexOf('<tr class="clubName"')>-1},F.prototype.parseCourseHeaderLine=function(a){var b=h(a);0===b.length&&r("No parts found in course header line");var c,d,e,f=b[0],g=/^(.*?)\s+\((\d+)m,\s*(\d+)m\)$/.exec(f);return null===g?(c=f,d=null,e=null):(c=g[1],d=parseInt(g[2],10)/1e3,e=parseInt(g[3],10)),{name:$.trim(c),distance:d,climb:e}},F.prototype.parseControlsLine=function(a){var b=h(a);return b.map(function(a){var b=a.indexOf("-");return-1===b?null:a.substring(b+1)})},F.prototype.readCompetitorSplitDataLine=function(b){for(var c=this.usesClasses?5:4,d=b.length;d>0&&""===b[d-1];)d-=1;for(var e=[],f=c;d>f;f+=2){var g=b[f];a(g)&&e.push(g)}return e},F.prototype.parseCompetitor=function(a,c){for(var d=g(a),e=g(c),f=b(d[0]),h=d[2],i=d[this.usesClasses?4:3],j=this.usesClasses&&""!==h?d[3]:null,k=e[2],l=this.usesClasses?5:4;l<d.length&&l<e.length;l+=2)""!==d[l]&&""===e[l]&&(e[l]="----");var o=this.readCompetitorSplitDataLine(d),p=this.readCompetitorSplitDataLine(e);return o=o.map(v),m(o,p),o.length!==p.length&&r("Cumulative and split times do not have the same length: "+o.length+" cumulative times, "+p.length+" split times"),new n(h,k,j,i,o,f)},o.prototype.addControls=function(a){this.controls=this.controls.concat(a)},o.prototype.hasAllControls=function(){return this.controls.length>0&&null===this.controls[this.controls.length-1]},o.prototype.addCompetitor=function(a){a.competitive||a.cumTimes.length!==this.controls.length-1||a.cumTimes.push(null),a.cumTimes.length===this.controls.length?this.competitors.push(a):r("Competitor '"+a.name+"' should have "+this.controls.length+" cumulative times, but has "+a.cumTimes.length+" times")},p.prototype.tryGetLine=function(){return this.linePos+1<this.lines.length?(this.linePos+=1,this.lines[this.linePos]):null},p.prototype.addCurrentCompetitorIfNecessary=function(){null!==this.currentCompetitor&&(this.currentCourse.addCompetitor(this.currentCompetitor),this.currentCompetitor=null)},p.prototype.addCurrentCompetitorAndCourseIfNecessary=function(){this.addCurrentCompetitorIfNecessary(),null!==this.currentCourse&&this.courses.push(this.currentCourse)},p.prototype.readCompetitorLines=function(a){var b=this.tryGetLine();null===b&&r("Hit end of input data unexpectedly while parsing competitor: first line was '"+a+"'");var c=this.recognizer.parseCompetitor(a,b);c.isContinuation()?null===this.currentCompetitor?r("First row of competitor data has no name nor time"):this.currentCompetitor.append(c):(this.addCurrentCompetitorIfNecessary(),this.currentCompetitor=c)},p.prototype.areClassesUniqueWithinCourses=function(){for(var a=d3.map(),b=0;b<this.courses.length;b+=1)for(var c=this.courses[b],d=0;d<c.competitors.length;d+=1){var e=c.competitors[d];if(a.has(e.className)){if(a.get(e.className)!==c.name)return!1}else a.set(e.className,c.name)}return!0},p.prototype.createOverallEventObject=function(){var a=this.areClassesUniqueWithinCourses(),b=[],c=[],d=this.courses.every(function(a){return a.competitors.every(function(a){return q(a.className)})});return this.courses.forEach(function(e){var f=d3.map();e.competitors.forEach(function(b){var c=d&&a?b.className:e.name;f.has(c)?f.get(c).push(b):f.set(c,[b])});var g=[];f.keys().forEach(function(a){var b=e.controls.length-1,d=f.get(a),h=d.map(function(a,b){return a.toCompetitor(b+1)}),i=new x(a,b,h);g.push(i),c.push(i)},this);var h=new y(e.name,g,e.distance,e.climb,e.controls.slice(0,e.controls.length-1));b.push(h),g.forEach(function(a){a.setCourse(h)})},this),new z(c,b)},p.prototype.parse=function(a){for(this.lines=a.split("\n");;){var b=this.tryGetLine();if(null===b)break;if(this.recognizer.canIgnoreThisLine(b));else if(this.recognizer.isCourseHeaderLine(b)){this.addCurrentCompetitorAndCourseIfNecessary();var c=this.recognizer.parseCourseHeaderLine(b);this.currentCourse=new o(c.name,c.distance,c.climb)}else if(null===this.currentCourse);else if(this.currentCourse.hasAllControls())this.readCompetitorLines(b);else{var d=this.recognizer.parseControlsLine(b);this.currentCourse.addControls(d)}}this.addCurrentCompetitorAndCourseIfNecessary(),0===this.courses.length&&r("No competitor data was found");var e=this.createOverallEventObject();return e};var G=[D,E,F];SplitsBrowser.Input.SIHtml={},SplitsBrowser.Input.SIHtml.parseEventData=function(a){a=u(a);for(var b=0;b<G.length;b+=1){var c=G[b],d=new c;if(d.isTextOfThisFormat(a)){a=d.preprocess(a);var e=new p(d),f=e.parse(a);return f}}s("No HTML recognizers recognised this as HTML they could parse")}}(),function(){"use strict";function a(a){for(var b=a.length-1;b>=0&&""===a[b];)b-=1;a.splice(b+1,a.length-b-1)}function b(a,b){if(b.allowMultipleCompetitorNames)for(;a.length>b.name+1&&a[b.name+1].match(/^\s\S/);)a[b.name]+=","+a[b.name+1],a.splice(b.name+1,1)}function c(b,c){for(var d=0;d<q.length;d+=1){var e=q[d],f=b.split(e);if(a(f),f.length>c.controlsOffset)return e}return null}function d(d,p){d=h(d);var q=d.split(/\n/);q.length<2&&g("Data appears not to be in an alternative CSV format - too few lines");var r=c(q[1],p);null===r&&g("Data appears not to be in an alternative CSV format - first data line has fewer than "+p.controlsOffset+" parts when separated by any recognised delimiter");var s=q[1].split(r);a(s),b(s,p);for(var t=/^[A-Za-z0-9]+$/,u=null===p.finishTime?p.step:0,v=p.controlsOffset;v+u<s.length;v+=p.step)t.test(s[v])||g("Data appears not to be in an alternative CSV format - data in cell "+v+" of the first row ('"+s[v]+"') is not an number");for(var w=d3.map(),x=1;x<q.length;x+=1){var y=q[x].split(r);if(a(y),b(y,p),!(y.length<p.controlsOffset)){for(;0!==(y.length-p.controlsOffset)%p.step;)y.push("");var z,A=y[p.name],B=y[p.club],C=y[p.courseName],D=i(y[p.startTime]);if(null===p.controlCount)z=y.length;else{var E=parseInt(y[p.controlCount],10);e(E)&&f("Control count '"+y[p.controlCount]+"' is not a valid number"),z=p.controlsOffset+E*p.step,y.length<z&&f("Data in row "+x+" should have at least "+z+" parts (for "+E+" controls) but only has "+y.length)}for(var F=null===p.length?null:j(y[p.length]),G=null===p.climb?null:k(y[p.climb]),H=[0],I=p.controlsOffset+1;z>I;I+=p.step)H.push(i(y[I]));if(null!==p.finishTime){var J=i(y[p.finishTime]),K=null===D||null===J?null:J-D;H.push(K)}var L=w.has(C)?w.get(C).competitors.length+1:1,M=l(L,A,B,D,H);if(null!==p.placing&&M.completed()){var N=y[p.placing];N.match(/^\d*$/)||M.setNonCompetitive()}if(M.hasAnyTimes()||M.setNonStarter(),w.has(C)){var O=w.get(C);H.length-1!==O.controls.length+1&&f("Competitor '"+A+"' has the wrong number of splits for course '"+C+"': "+"expected "+(O.controls.length+1)+", actual "+(H.length-1)),O.competitors.push(M)}else{for(var P=[],Q=p.controlsOffset;z>Q+u;Q+=p.step)P.push(y[Q]);w.set(C,{length:F,climb:G,controls:P,competitors:[M]})}}}var R=[],S=[];return w.keys().forEach(function(a){var b=w.get(a),c=new m(a,b.controls.length,b.competitors),d=new n(a,[c],b.length,b.climb,b.controls);c.setCourse(d),R.push(c),S.push(d)}),new o(R,S)}var e=SplitsBrowser.isNaNStrict,f=SplitsBrowser.throwInvalidData,g=SplitsBrowser.throwWrongFileFormat,h=SplitsBrowser.normaliseLineEndings,i=SplitsBrowser.parseTime,j=SplitsBrowser.parseCourseLength,k=SplitsBrowser.parseCourseClimb,l=SplitsBrowser.Model.Competitor.fromOriginalCumTimes,m=SplitsBrowser.Model.CourseClass,n=SplitsBrowser.Model.Course,o=SplitsBrowser.Model.Event,p={controlsOffset:38,step:3,name:3,club:5,courseName:7,startTime:8,length:null,climb:null,controlCount:null,placing:null,finishTime:null,allowMultipleCompetitorNames:!0},q=[",",";"];SplitsBrowser.Input.AlternativeCSV={parseTripleColumnEventData:function(a){return d(a,p)}}}(),function(){"use strict";function a(a){return"undefined"==typeof a}function b(a){var b;try{b=$.parseXML(a)}catch(c){i("XML data not well-formed")}return 0===$("> *",$(b)).length&&i("XML data not well-formed: "+a),b}function c(a){var b=$("> Given",a).text(),c=$("> Family",a).text();return""!==b||""!==c?""===b?c:""===c?b:b+" "+c:(i("Cannot read competitor's name"),void 0)}function d(b,c){var d=$("> *",b),e=d.prop("tagName");"ResultList"!==e&&j("Root element of XML document does not have expected name 'ResultList', got '"+e+"'"),c.checkVersion(d);var f=d.attr("status");a(f)||f.toLowerCase()===c.completeStatus||i("Only complete IOF data supported; snapshot and delta are not supported")}function e(a,b,d){var e=$(a),f=d.getCompetitorNameElement(e),g=c(f),h=d.readClubName(e),j=d.readDateOfBirth(e),k=r.exec(j),l=null===k?null:parseInt(k[0],10),n=$("> Person",e).attr("sex"),o=$("Result",e);0===o.length&&i("No result found for competitor '"+g+"'");var p=d.readStartTime(o),q=d.readTotalTime(o),s=$("> SplitTime",o).toArray(),t=s.filter(function(a){return!d.isAdditional($(a))}).map(function(a){return d.readSplitTime($(a))}),u=t.map(function(a){return a.code}),v=t.map(function(a){return a.time});v.splice(0,0,0),v.push(q);var w=m(b,g,h,p,v);null!==l&&w.setYearOfBirth(l),("M"===n||"F"===n)&&w.setGender(n);var x=d.getStatus(o);return x===d.StatusNonCompetitive?w.setNonCompetitive():x===d.StatusNonStarter?w.setNonStarter():x===d.StatusNonFinisher?w.setNonFinisher():x===d.StatusDisqualified?w.disqualify():x===d.StatusOverMaxTime&&w.setOverMaxTime(),{competitor:w,controls:u}}function f(a,b){var c=$(a),d={name:null,competitors:[],controls:[],course:null};d.course=b.readCourseFromClass(c,b);var f=b.readClassName(c);""===f&&i("Missing class name"),d.name=f;var g=$("> PersonResult",c);0===g.length&&i("Class '"+f+"' has no competitors");for(var h=0;h<g.length;h+=1){var j=e(g[h],h+1,b);if(0===d.competitors.length)d.controls=j.controls,d.length=j.length;else{var k=j.competitor.getAllOriginalCumulativeTimes().length-2;k!==d.controls.length&&i("Inconsistent numbers of controls on course '"+f+"': "+d.controls.length+" and "+k)}d.competitors.push(j.competitor)}return d}function g(a){for(var b=0;b<v.length;b+=1){var c=v[b];if(c.isOfThisVersion(a))return c}j("Data apparently not of any recognised IOF XML format")}function h(a){var c=g(a),e=b(a);d(e,c);var h=$("> ResultList > ClassResult",$(e)).toArray();0===h.length&&i("No class result elements found");var j=[],k=[],l=d3.map();h.forEach(function(a){var b=f(a,c),d=new n(b.name,b.controls.length,b.competitors);j.push(d);var e=b.course;null!==e.id&&l.has(e.id)?l.get(e.id).classes.push(d):(e.classes=[d],e.controls=b.controls,k.push(e),null!==e.id&&l.set(e.id,e))});var m=k.map(function(a){var b=new o(a.name,a.classes,a.length,a.climb,a.controls);return a.classes.forEach(function(a){a.setCourse(b)}),b});return new p(j,m)}var i=SplitsBrowser.throwInvalidData,j=SplitsBrowser.throwWrongFileFormat,k=SplitsBrowser.isNaNStrict,l=SplitsBrowser.parseTime,m=SplitsBrowser.Model.Competitor.fromOriginalCumTimes,n=SplitsBrowser.Model.CourseClass,o=SplitsBrowser.Model.Course,p=SplitsBrowser.Model.Event,q=3280,r=/^\d{4}/,s={};s.isOfThisVersion=function(a){return a.indexOf("IOFdata.dtd")>=0},s.checkVersion=function(b){var c=$("> IOFVersion",b);if(0===c.length)j("Could not find IOFVersion element");else{var d=c.attr("version");a(d)?j("Version attribute missing from IOFVersion element"):"2.0.3"!==d&&j("Found unrecognised IOF XML data format '"+d+"'")}var e=b.attr("status");a(e)||"complete"===e.toLowerCase()||i("Only complete IOF data supported; snapshot and delta are not supported")},s.readClassName=function(a){return $("> ClassShortName",a).text()},s.readCourseFromClass=function(b){var c=$("> ClassShortName",b).text(),d=$("> PersonResult > Result",b).first(),e=null;if(d.length>0){var f=$("> CourseLength",d),g=f.text();if(g.length>0)if(e=parseFloat(g),isFinite(e)){var h=f.attr("unit");a(h)||"m"===h?e/=1e3:"km"===h||("ft"===h?e/=q:i("Unrecognised course-length unit: '"+h+"'"))}else i("Invalid course length: '"+g+"'")}return{id:null,name:c,length:e,climb:null}},s.getCompetitorNameElement=function(a){return $("> Person > PersonName",a)},s.readClubName=function(a){return $("> Club > ShortName",a).text()},s.readDateOfBirth=function(a){return $("> Person > BirthDate > Date",a).text()},s.readStartTime=function(a){var b=$("> StartTime > Clock",a).text(),c=""===b?null:l(b);return c},s.readTotalTime=function(a){var b=$("> Time",a).text(),c=""===b?null:l(b);return c},s.getStatus=function(a){var b=$("> CompetitorStatus",a);return 1===b.length?b.attr("value"):""},s.StatusNonCompetitive="NotCompeting",s.StatusNonStarter="DidNotStart",s.StatusNonFinisher="DidNotFinish",s.StatusDisqualified="Disqualified",s.StatusOverMaxTime="OverTime",s.isAdditional=function(){return!1},s.readSplitTime=function(a){var b=$("> ControlCode",a).text();""===b&&(b=$("> Control",a).text()),""===b&&i("Control code missing for control");var c=$("> Time",a).text();""===c&&i("Split time missing for control '"+b+"'");var d=l(c);return{code:b,time:d}};var t=/^\d\d\d\d-?\d\d-?\d\dT?(\d\d):?(\d\d)(?::?(\d\d))?/,u={};u.isOfThisVersion=function(a){return a.indexOf("http://www.orienteering.org/datastandard/3.0")>=0},u.checkVersion=function(b){var c=b.attr("iofVersion");a(c)?j("Could not find IOF version number"):"3.0"!==c&&j("Found unrecognised IOF XML data format '"+c+"'");var d=b.attr("status");a(d)||"Complete"===d.toLowerCase()||i("Only complete IOF data supported; snapshot and delta are not supported")},u.readClassName=function(a){return $("> Class > Name",a).text()},u.readCourseFromClass=function(a){var b,c=$("> Course",a),d=$("> Id",c).text(),e=$("> Name",c).text(),f=$("> Length",c).text();""===f?b=null:(b=parseInt(f,10),k(b)?i("Unrecognised course length: '"+f+"'"):b/=1e3);var g=$("> Climb",c).text(),h=parseInt(g,10);return k(h)&&(h=null),{id:d,name:e,length:b,climb:h}},u.getCompetitorNameElement=function(a){return $("> Person > Name",a)},u.readClubName=function(a){return $("> Organisation > ShortName",a).text()},u.readDateOfBirth=function(a){var b=$("> Person > BirthDate",a).text(),c=r.exec(b);return null===c?null:parseInt(c[0],10)},u.readStartTime=function(b){var c=$("> StartTime",b).text(),d=t.exec(c);if(null===d)return null;var e=parseInt(d[1],10),f=parseInt(d[2],10),g=a(d[3])?0:parseInt(d[3],10);return 60*60*e+60*f+g},u.readTime=function(a){var b=parseFloat(a);return isFinite(b)?b:null},u.readTotalTime=function(a){var b=$("> Time",a).text();return u.readTime(b)},u.getStatus=function(a){return $("> Status",a).text()},u.StatusNonCompetitive="NotCompeting",u.StatusNonStarter="DidNotStart",u.StatusNonFinisher="DidNotFinish",u.StatusDisqualified="Disqualified",u.StatusOverMaxTime="OverTime",u.isAdditional=function(a){return"Additional"===a.attr("status")},u.readSplitTime=function(a){var b=$("> ControlCode",a).text();""===b&&i("Control code missing for control");var c;if("Missing"===a.attr("status"))c=null;else{var d=$("> Time",a).text();""===d&&i("Split time missing for control '"+b+"'"),c=u.readTime(d)}return{code:b,time:c}};var v=[s,u];SplitsBrowser.Input.IOFXml={parseEventData:h}}(),function(){"use strict";var a=[SplitsBrowser.Input.CSV.parseEventData,SplitsBrowser.Input.SI.parseEventData,SplitsBrowser.Input.SIHtml.parseEventData,SplitsBrowser.Input.AlternativeCSV.parseTripleColumnEventData,SplitsBrowser.Input.IOFXml.parseEventData];SplitsBrowser.Input.parseEventData=function(b){for(var c=0;c<a.length;c+=1){var d=a[c];try{return d(b)}catch(e){if("WrongFileFormat"!==e.name)throw e}}return null}}(),function(){"use strict";function a(a){return a.toLowerCase().replace(/\W/g,"")}var b="competitorList",c=1,d=-1,e="competitorListContainer",f=SplitsBrowser.getMessage,g=SplitsBrowser.getMessageWithFormatting,h=function(a,c){this.parent=a,this.alerter=c,this.handler=null,this.competitorSelection=null,this.lastFilterString="",this.allCompetitors=[],this.allCompetitorDetails=[],this.dragging=!1,this.dragStartCompetitorIndex=null,this.currentDragCompetitorIndex=null,this.allCompetitorDivs=[],this.inverted=!1,this.placeholderDiv=null,this.changeHandlers=[],this.containerDiv=d3.select(a).append("div").attr("id",e),this.buttonsPanel=this.containerDiv.append("div");var f=this;this.allButton=this.buttonsPanel.append("button").attr("id","selectAllCompetitors").style("width","50%").on("click",function(){f.selectAllFiltered()}),this.noneButton=this.buttonsPanel.append("button").attr("id","selectNoCompetitors").style("width","50%").on("click",function(){f.selectNoneFiltered()}),$(this.noneButton.node()).dblclick(function(){f.selectNone()}),this.buttonsPanel.append("br"),this.crossingRunnersButton=this.buttonsPanel.append("button").attr("id","selectCrossingRunners").style("width","100%").on("click",function(){f.selectCrossingRunners()}).style("display","none"),this.filter=this.buttonsPanel.append("input").attr("type","text"),this.filter.on("input",function(){f.updateFilterIfChanged()}).on("keyup",function(){f.updateFilterIfChangedDelayed()}).on("mouseup",function(){f.updateFilterIfChangedDelayed()}),this.listDiv=this.containerDiv.append("div").attr("id",b),this.listDiv.on("mousedown",function(){f.startDrag(d)}).on("mousemove",function(){f.mouseMove(d)}).on("mouseup",function(){f.stopDrag()}),d3.select(document).on("mouseup",function(){f.stopDrag()}),this.setMessages()};h.prototype.setMessages=function(){this.allButton.text(f("SelectAllCompetitors")),this.noneButton.text(f("SelectNoCompetitors")),this.crossingRunnersButton.text(f("SelectCrossingRunners")),this.filter.attr("placeholder",f("CompetitorListFilter"))},h.prototype.retranslate=function(){this.setMessages(),null!==this.placeholderDiv&&(this.placeholderDiv.text(f("NoCompetitorsStarted")),this.fireChangeHandlers())},h.prototype.registerChangeHandler=function(a){-1===this.changeHandlers.indexOf(a)&&this.changeHandlers.push(a)},h.prototype.deregisterChangeHandler=function(a){var b=this.changeHandlers.indexOf(a);b>-1&&this.changeHandlers.splice(b,1)},h.prototype.fireChangeHandlers=function(){this.changeHandlers.forEach(function(a){a()},this)},h.prototype.isMouseOffBottomOfCompetitorList=function(){return null===this.lastVisibleDiv||d3.mouse(this.lastVisibleDiv)[1]>=$(this.lastVisibleDiv).height()},h.prototype.getDragClassName=function(){return this.inverted?"dragDeselected":"dragSelected"},h.prototype.startDrag=function(a){if(d3.event.which===c){this.dragStartCompetitorIndex=a,this.currentDragCompetitorIndex=a,this.allCompetitorDivs=$("div.competitor");var b=this.allCompetitorDivs.filter(":visible");if(this.lastVisibleDiv=0===b.length?null:b[b.length-1],this.inverted=d3.event.shiftKey,a===d){if(!this.isMouseOffBottomOfCompetitorList())return}else d3.select(this.allCompetitorDivs[a]).classed(this.getDragClassName(),!0);d3.event.stopPropagation(),this.dragging=!0}},h.prototype.mouseMove=function(a){if(this.dragging&&(d3.event.stopPropagation(),a!==this.currentDragCompetitorIndex)){var b=this.getDragClassName();if(d3.selectAll("div.competitor."+b).classed(b,!1),this.dragStartCompetitorIndex===d&&a===d)return;if(a===d&&!this.isMouseOffBottomOfCompetitorList())return;var c,e;this.dragStartCompetitorIndex===d||a===d?(c=this.dragStartCompetitorIndex+a-d,e=this.allCompetitorDivs.length-1):(c=Math.min(this.dragStartCompetitorIndex,a),e=Math.max(this.dragStartCompetitorIndex,a));for(var f=[],g=c;e>=g;g+=1)this.allCompetitorDetails[g].visible&&f.push(this.allCompetitorDivs[g]);d3.selectAll(f).classed(b,!0),this.currentDragCompetitorIndex=a}},h.prototype.stopDrag=function(){if(this.dragging){this.dragging=!1;for(var a=[],b=this.getDragClassName(),c=0;c<this.allCompetitorDivs.size();c+=1)$(this.allCompetitorDivs[c]).hasClass(b)&&a.push(c);d3.selectAll("div.competitor."+b).classed(b,!1),d3.event.currentTarget===document||(this.currentDragCompetitorIndex!==d||this.isMouseOffBottomOfCompetitorList())&&(1===a.length?this.toggleCompetitor(a[0]):this.inverted?this.competitorSelection.bulkDeselect(a):this.competitorSelection.bulkSelect(a)),this.dragStartCompetitorIndex=null,this.currentDragCompetitorIndex=null,d3.event.stopPropagation()}},h.prototype.width=function(){return $(this.listDiv.node()).width()},h.prototype.setHeight=function(a){$(this.listDiv.node()).height(a-$(this.buttonsPanel.node()).height())},h.prototype.getAllVisibleIndexes=function(){return d3.range(this.allCompetitorDetails.length).filter(function(a){return this.allCompetitorDetails[a].visible},this)},h.prototype.selectAllFiltered=function(){this.competitorSelection.bulkSelect(this.getAllVisibleIndexes())},h.prototype.selectNoneFiltered=function(){this.competitorSelection.bulkDeselect(this.getAllVisibleIndexes())},h.prototype.selectNone=function(){this.competitorSelection.selectNone()},h.prototype.isSelected=function(a){return null!==this.competitorSelection&&this.competitorSelection.isSelected(a)},h.prototype.selectCrossingRunners=function(){if(this.competitorSelection.selectCrossingRunners(this.allCompetitorDetails),this.competitorSelection.isSingleRunnerSelected()){var a=this.allCompetitors[this.competitorSelection.getSingleRunnerIndex()].name,b=this.lastFilterString.length>0,c=b?"RaceGraphNoCrossingRunnersFiltered":"RaceGraphNoCrossingRunners";this.alerter(g(c,{$$NAME$$:a}))}},h.prototype.enableOrDisableCrossingRunnersButton=function(){this.crossingRunnersButton.node().disabled=!this.competitorSelection.isSingleRunnerSelected()},h.prototype.setChartType=function(a){this.crossingRunnersButton.style("display",a.isRaceGraph?"block":"none")},h.prototype.selectionChanged=function(){var a=this;this.listDiv.selectAll("div.competitor").data(d3.range(this.competitorSelection.count)).classed("selected",function(b,c){return a.isSelected(c)})},h.prototype.toggleCompetitor=function(a){this.competitorSelection.toggle(a)},h.prototype.setCompetitorList=function(b,c){this.allCompetitors=b,this.allCompetitorDetails=this.allCompetitors.map(function(b){return{competitor:b,normedName:a(b.name),visible:!0}
}),null!==this.placeholderDiv&&(this.placeholderDiv.remove(),this.placeholderDiv=null);var d=this.listDiv.selectAll("div.competitor").data(this.allCompetitors),e=this;d.enter().append("div").classed("competitor",!0).classed("selected",function(a,b){return e.isSelected(b)}),d.selectAll("span").remove(),c&&d.append("span").classed("competitorClassLabel",!0).text(function(a){return a.className}),d.append("span").classed("nonfinisher",function(a){return!a.completed()}).text(function(a){return a.completed()?a.name:"* "+a.name}),d.exit().remove(),0===this.allCompetitors.length&&(this.placeholderDiv=this.listDiv.append("div").classed("competitorListPlaceholder",!0).text(f("NoCompetitorsStarted"))),this.allButton.property("disabled",0===this.allCompetitors.length),this.noneButton.property("disabled",0===this.allCompetitors.length),this.filter.property("disabled",0===this.allCompetitors.length),d.on("mousedown",function(a,b){e.startDrag(b)}).on("mousemove",function(a,b){e.mouseMove(b)}).on("mouseup",function(){e.stopDrag()}),this.updateFilter()},h.prototype.setSelection=function(a){null!==this.competitorSelection&&this.competitorSelection.deregisterChangeHandler(this.handler);var b=this;this.competitorSelection=a,this.handler=function(){b.selectionChanged()},this.competitorSelection.registerChangeHandler(this.handler),this.selectionChanged()},h.prototype.getFilterText=function(){return this.filter.node().value},h.prototype.setFilterText=function(a){this.filter.node().value=a,this.updateFilterIfChanged()},h.prototype.updateFilter=function(){var b=this.filter.node().value,c=a(b);this.allCompetitorDetails.forEach(function(a){a.visible=a.normedName.indexOf(c)>=0});var d=this;this.listDiv.selectAll("div.competitor").style("display",function(a,b){return d.allCompetitorDetails[b].visible?null:"none"})},h.prototype.updateFilterIfChanged=function(){var a=this.getFilterText();a!==this.lastFilterString&&(this.updateFilter(),this.lastFilterString=a,this.fireChangeHandlers())},h.prototype.updateFilterIfChangedDelayed=function(){var a=this;setTimeout(function(){a.updateFilterIfChanged()},1)},SplitsBrowser.Controls.CompetitorList=h}(),function(){"use strict";function a(a){if(this.changeHandlers=[],this.label=null,this.dropDown=null,this.allLanguages=c(),!(this.allLanguages.length<2)){d3.select(a).append("div").classed("topRowStartSpacer",!0);var b=d3.select(a).append("div").classed("topRowStart",!0);this.label=b.append("span");var f=this;this.dropDown=b.append("select").node(),$(this.dropDown).bind("change",function(){f.onLanguageChanged()});var g=d3.select(this.dropDown).selectAll("option").data(this.allLanguages);g.enter().append("option"),g.attr("value",function(a){return a}).text(function(a){return e(a)}),g.exit().remove(),this.setLanguage(d()),this.setMessages()}}var b=SplitsBrowser.getMessage,c=SplitsBrowser.getAllLanguages,d=SplitsBrowser.getLanguage,e=SplitsBrowser.getLanguageName,f=SplitsBrowser.setLanguage;a.prototype.setMessages=function(){this.label.text(b("LanguageSelectorLabel"))},a.prototype.registerChangeHandler=function(a){-1===this.changeHandlers.indexOf(a)&&this.changeHandlers.push(a)},a.prototype.setLanguage=function(a){var b=this.allLanguages.indexOf(a);b>=0&&(this.dropDown.selectedIndex=b,this.onLanguageChanged())},a.prototype.onLanguageChanged=function(){f(this.dropDown.options[this.dropDown.selectedIndex].value),this.changeHandlers.forEach(function(a){a()})},SplitsBrowser.Controls.LanguageSelector=a}(),function(){"use strict";function a(a){this.changeHandlers=[],this.otherClassesEnabled=!0;var b=d3.select(a).append("div").classed("topRowStart",!0);this.labelSpan=b.append("span");var c=this;this.dropDown=b.append("select").node(),$(this.dropDown).bind("change",function(){c.updateOtherClasses(d3.set()),c.onSelectionChanged()}),this.otherClassesContainer=d3.select(a).append("div").attr("id","otherClassesContainer").classed("topRowStart",!0).style("display","none"),this.otherClassesCombiningLabel=this.otherClassesContainer.append("span").classed("otherClassCombining",!0),this.otherClassesSelector=this.otherClassesContainer.append("div").classed("otherClassSelector",!0).style("display","inline-block"),this.otherClassesSpan=this.otherClassesSelector.append("span"),this.otherClassesList=d3.select(a).append("div").classed("otherClassList",!0).style("position","absolute").style("display","none"),this.otherClassesSelector.on("click",function(){c.showHideClassSelector()}),this.setClasses([]),this.selectedOtherClassIndexes=d3.set(),$(document).click(function(a){var b=c.otherClassesList.node();if("none"!==b.style.display){var d=$("div.otherClassList,div.otherClassSelector");d.is(a.target)||0!==d.has(a.target).length||(b.style.display="none")}}),$(document).keydown(function(a){27===a.which&&c.otherClassesList.style("display","none")}),this.setMessages()}var b=SplitsBrowser.throwInvalidData,c=SplitsBrowser.getMessage;a.prototype.setMessages=function(){this.labelSpan.text(c("ClassSelectorLabel")),this.otherClassesCombiningLabel.text(c("AdditionalClassSelectorLabel"))},a.prototype.setOtherClassesEnabled=function(a){this.otherClassesCombiningLabel.classed("disabled",!a),this.otherClassesSelector.classed("disabled",!a),this.otherClassesEnabled=a},a.prototype.setClasses=function(a){if($.isArray(a)){this.classes=a;var d;0===a.length?(this.dropDown.disabled=!0,d=[c("NoClassesLoadedPlaceholder")]):(this.dropDown.disabled=!1,d=a.map(function(a){return a.name}));var e=d3.select(this.dropDown).selectAll("option").data(d);e.enter().append("option"),e.attr("value",function(a,b){return b.toString()}).text(function(a){return a}),e.exit().remove(),this.updateOtherClasses(d3.set())}else b("ClassSelector.setClasses: classes is not an array")},a.prototype.registerChangeHandler=function(a){-1===this.changeHandlers.indexOf(a)&&this.changeHandlers.push(a)},a.prototype.selectClasses=function(a){a.length>0&&a.every(function(a){return a>=0&&a<this.dropDown.options.length},this)&&(this.dropDown.selectedIndex=a[0],this.updateOtherClasses(d3.set(a.slice(1))),this.onSelectionChanged())},a.prototype.getSelectedClasses=function(){var a=[this.dropDown.selectedIndex];return this.selectedOtherClassIndexes.forEach(function(b){a.push(parseInt(b,10))}),a},a.prototype.onSelectionChanged=function(){var a=this.getSelectedClasses();this.changeHandlers.forEach(function(b){b(a)})},a.prototype.updateOtherClassText=function(){var a=this.selectedOtherClassIndexes.values();a.sort(d3.ascending);var b;b=0===a.length?c("NoAdditionalClassesSelectedPlaceholder"):a.map(function(a){return this.classes[a].name},this).join(", "),this.otherClassesSpan.text(b)},a.prototype.updateOtherClasses=function(a){this.otherClassesList.style("display","none"),this.selectedOtherClassIndexes=a,this.updateOtherClassText(),$("div.otherClassItem").off("click");var b,c=this;if(this.classes.length>0){var d=this.classes[this.dropDown.selectedIndex];b=d.course.getOtherClasses(d)}else b=[];var e=b.map(function(a){return this.classes.indexOf(a)},this),f=this.otherClassesList.selectAll("div").data(e);f.enter().append("div").classed("otherClassItem",!0),f.attr("id",function(a){return"courseClassIdx_"+a}).classed("selected",function(b){return a.has(b)}).text(function(a){return c.classes[a].name}),f.exit().remove(),e.length>0?this.otherClassesContainer.style("display",null):this.otherClassesContainer.style("display","none");var g=$(this.otherClassesSelector.node()).offset(),h=$(this.otherClassesSelector.node()).outerHeight();this.otherClassesList.style("left",g.left+"px").style("top",g.top+h+"px"),$("div.otherClassItem").each(function(a,b){$(b).on("click",function(){c.toggleOtherClass(e[a])})})},a.prototype.showHideClassSelector=function(){this.otherClassesEnabled&&this.otherClassesList.style("display","none"===this.otherClassesList.style("display")?null:"none")},a.prototype.toggleOtherClass=function(a){this.selectedOtherClassIndexes.has(a)?this.selectedOtherClassIndexes.remove(a):this.selectedOtherClassIndexes.add(a),d3.select("div#courseClassIdx_"+a).classed("selected",this.selectedOtherClassIndexes.has(a)),this.updateOtherClassText(),this.onSelectionChanged()},a.prototype.retranslate=function(){this.setMessages(),0===this.classes.length&&d3.select(this.dropDown.options[0]).text(c("NoClassesLoadedPlaceholder")),0===this.selectedOtherClassIndexes.values().length&&this.otherClassesSpan.text(c("NoAdditionalClassesSelectedPlaceholder"))},SplitsBrowser.Controls.ClassSelector=a}(),function(){"use strict";function a(a,b){this.changeHandlers=[],this.classes=null,this.currentRunnerIndex=null,this.previousCompetitorList=null,this.parent=a,this.alerter=b,this.hasWinner=!1,this.previousSelectedIndex=-1;var c=d3.select(a).append("div").classed("topRowStart",!0);this.comparisonSelectorLabel=c.append("span").classed("comparisonSelectorLabel",!0);var e=this;this.dropDown=c.append("select").attr("id",g).node(),$(this.dropDown).bind("change",function(){e.onSelectionChanged()}),this.optionsList=d3.select(this.dropDown).selectAll("option").data(d),this.optionsList.enter().append("option"),this.optionsList.attr("value",function(a,b){return b.toString()}),this.optionsList.exit().remove(),this.runnerDiv=d3.select(a).append("div").classed("topRowStart",!0).style("display","none").style("padding-left","20px"),this.runnerSpan=this.runnerDiv.append("span").classed("comparisonSelectorLabel",!0),this.runnerDropDown=this.runnerDiv.append("select").attr("id",h).node(),$(this.runnerDropDown).bind("change",function(){e.onSelectionChanged()}),this.dropDown.selectedIndex=f,this.previousSelectedIndex=f,this.setMessages()}var b=SplitsBrowser.getMessage,c=SplitsBrowser.getMessageWithFormatting,d=[{nameKey:"CompareWithWinner",selector:function(a){return a.getWinnerCumTimes()},requiresWinner:!0,percentage:""},{nameKey:"CompareWithFastestTime",selector:function(a){return a.getFastestCumTimes()},requiresWinner:!1,percentage:""}],e=[5,25,50,100];e.forEach(function(a){d.push({nameKey:"CompareWithFastestTimePlusPercentage",selector:function(b){return b.getFastestCumTimesPlusPercentage(a)},requiresWinner:!1,percentage:a})}),d.push({nameKey:"CompareWithAnyRunner",selector:null,requiresWinner:!0,percentage:""});var f=1,g="comparisonSelector",h="runnerSelector";a.prototype.setMessages=function(){this.comparisonSelectorLabel.text(b("ComparisonSelectorLabel")),this.runnerSpan.text(b("CompareWithAnyRunnerLabel")),this.optionsList.text(function(a){return c(a.nameKey,{$$PERCENT$$:a.percentage})})},a.prototype.registerChangeHandler=function(a){-1===this.changeHandlers.indexOf(a)&&this.changeHandlers.push(a)},a.prototype.isAnyRunnerSelected=function(){return this.dropDown.selectedIndex===d.length-1},a.prototype.setCourseClassSet=function(a){this.courseClassSet=a,this.setRunners()},a.prototype.setRunners=function(){var a=this.courseClassSet.allCompetitors,b=d3.range(a.length).filter(function(b){return a[b].completed()}),c=a.filter(function(a){return a.completed()});this.hasWinner=c.length>0;var e=d3.select(this.runnerDropDown).selectAll("option").data(c);if(e.enter().append("option"),e.attr("value",function(a,c){return b[c].toString()}).text(function(a){return a.name}),e.exit().remove(),null===this.previousCompetitorList)this.currentRunnerIndex=0;else if(this.hasWinner){var f=this.previousCompetitorList[this.currentRunnerIndex],g=this.courseClassSet.allCompetitors.indexOf(f);this.currentRunnerIndex=Math.max(g,0)}else d[this.dropDown.selectedIndex].requiresWinner&&this.setComparisonType(1,null);this.runnerDropDown.selectedIndex=this.currentRunnerIndex,this.previousCompetitorList=this.courseClassSet.allCompetitors},a.prototype.setEnabled=function(a){d3.select(this.parent).selectAll("span.comparisonSelectorLabel").classed("disabled",!a),this.dropDown.disabled=!a,this.runnerDropDown.disabled=!a},a.prototype.getComparisonFunction=function(){if(this.isAnyRunnerSelected()){var a=this;return function(b){return b.getCumulativeTimesForCompetitor(a.currentRunnerIndex)}}return d[this.dropDown.selectedIndex].selector},a.prototype.getComparisonType=function(){var a,b=this.dropDown.selectedIndex;return b===d.length-1?(this.runnerDropDown.selectedIndex<0&&(this.runnerDropDown.selectedIndex=0),a=this.courseClassSet.allCompetitors[this.runnerDropDown.selectedIndex]):a=null,{index:b,runner:a}},a.prototype.setComparisonType=function(a,b){if(a>=0&&a<d.length)if(a===d.length-1){var c=this.courseClassSet.allCompetitors.indexOf(b);c>=0&&(this.dropDown.selectedIndex=a,this.runnerDropDown.selectedIndex=c,this.onSelectionChanged())}else this.dropDown.selectedIndex=a,this.onSelectionChanged()},a.prototype.onSelectionChanged=function(){var a=Math.max(this.runnerDropDown.selectedIndex,0),e=d[this.dropDown.selectedIndex];!this.hasWinner&&e.requiresWinner?(this.alerter(c("CannotCompareAsNoWinner",{$$OPTION$$:b(e.nameKey)})),this.dropDown.selectedIndex=this.previousSelectedIndex):(this.runnerDiv.style("display",this.isAnyRunnerSelected()?null:"none"),this.currentRunnerIndex=0===this.runnerDropDown.options.length?0:parseInt(this.runnerDropDown.options[a].value,10),this.previousSelectedIndex=this.dropDown.selectedIndex,this.changeHandlers.forEach(function(a){a(this.getComparisonFunction())},this))},SplitsBrowser.Controls.ComparisonSelector=a}(),function(){"use strict";function a(a){this.div=d3.select(a).append("div").classed("topRowEnd",!0).attr("id",c);var b=this.div.selectAll("div").data(e).enter().append("div").style("display","inline-block");b.append("input").attr("id",function(a){return d+a}).attr("type","checkbox").attr("checked",function(a){return g.indexOf(a)>=0?"checked":null}),this.statisticLabels=b.append("label").attr("for",function(a){return d+a}).classed("statisticsSelectorLabel",!0);var f=this;$("input",this.div.node()).bind("change",function(){return f.onCheckboxChanged()}),this.handlers=[],this.setMessages()}var b=SplitsBrowser.getMessage,c="statisticSelector",d="statisticCheckbox",e=["TotalTime","SplitTime","BehindFastest","TimeLoss"],f=["StatisticsTotalTime","StatisticsSplitTime","StatisticsBehindFastest","StatisticsTimeLoss"],g=["SplitTime","TimeLoss"];a.prototype.setMessages=function(){this.statisticLabels.text(function(a,c){return b(f[c])})},a.prototype.clearAll=function(){this.div.selectAll("input").attr("checked",null)},a.prototype.setEnabled=function(a){this.div.selectAll("label.statisticsSelectorLabel").classed("disabled",!a),this.div.selectAll("input").attr("disabled",a?null:"disabled")},a.prototype.registerChangeHandler=function(a){-1===this.handlers.indexOf(a)&&this.handlers.push(a)},a.prototype.deregisterChangeHandler=function(a){var b=this.handlers.indexOf(a);-1!==b&&this.handlers.splice(b,1)},a.prototype.getVisibleStatistics=function(){var a={};return this.div.selectAll("input")[0].forEach(function(b,c){a[e[c]]=b.checked}),a},a.prototype.setVisibleStatistics=function(a){this.div.selectAll("input")[0].forEach(function(b,c){b.checked=a[e[c]]||!1}),this.onCheckboxChanged()},a.prototype.onCheckboxChanged=function(){var a=this.getVisibleStatistics();this.handlers.forEach(function(b){b(a)})},SplitsBrowser.Controls.StatisticsSelector=a}(),function(){"use strict";function a(a,b){this.changeHandlers=[],this.chartTypes=b,this.raceGraphDisabledNotifier=null,this.lastSelectedIndex=0;var c=d3.select(a).append("div").classed("topRowStart",!0);this.labelSpan=c.append("span");var d=this;this.dropDown=c.append("select").node(),$(this.dropDown).bind("change",function(){d.onSelectionChanged()}),this.optionsList=d3.select(this.dropDown).selectAll("option").data(b),this.optionsList.enter().append("option"),this.optionsList.attr("value",function(a,b){return b.toString()}),this.optionsList.exit().remove(),this.setMessages()}var b=SplitsBrowser.getMessage;a.prototype.setMessages=function(){this.labelSpan.text(b("ChartTypeSelectorLabel")),this.optionsList.text(function(a){return b(a.nameKey)})},a.prototype.setRaceGraphDisabledNotifier=function(a){this.raceGraphDisabledNotifier=a,null!==this.raceGraphDisabledNotifier&&this.chartTypes[this.dropDown.selectedIndex].isRaceGraph&&(this.raceGraphDisabledNotifier(),this.dropDown.selectedIndex=0,this.onSelectionChanged())},a.prototype.registerChangeHandler=function(a){-1===this.changeHandlers.indexOf(a)&&this.changeHandlers.push(a)},a.prototype.getChartType=function(){return this.chartTypes[Math.max(this.dropDown.selectedIndex,0)]},a.prototype.setChartType=function(a){var b=this.chartTypes.indexOf(a);b>=0&&(this.dropDown.selectedIndex=b,this.onSelectionChanged())},a.prototype.onSelectionChanged=function(){null!==this.raceGraphDisabledNotifier&&this.chartTypes[this.dropDown.selectedIndex].isRaceGraph&&(this.raceGraphDisabledNotifier(),this.dropDown.selectedIndex=Math.max(this.lastSelectedIndex,0)),this.changeHandlers.forEach(function(a){a(this.chartTypes[this.dropDown.selectedIndex])},this),this.lastSelectedIndex=this.dropDown.selectedIndex},SplitsBrowser.Controls.ChartTypeSelector=a}(),function(){"use strict";function a(a){this.parent=a;var c="originalDataCheckbox";this.containerDiv=a.append("div").classed("topRowStart",!0).attr("id",b),this.containerDiv.append("div").classed("topRowStartSpacer",!0);var d=this.containerDiv.append("span"),e=this;this.checkbox=d.append("input").attr("type","checkbox").attr("id",c).on("click",function(){e.fireChangeHandlers()}).node(),this.label=d.append("label").attr("for",c).classed("originalDataSelectorLabel",!0),this.handlers=[],this.setMessages()}var b="originalDataSelectorContainer",c=SplitsBrowser.getMessage;a.prototype.setMessages=function(){this.label.text(c("ShowOriginalData")),this.containerDiv.attr("title",c("ShowOriginalDataTooltip"))},a.prototype.registerChangeHandler=function(a){-1===this.handlers.indexOf(a)&&this.handlers.push(a)},a.prototype.deregisterChangeHandler=function(a){var b=this.handlers.indexOf(a);-1!==b&&this.handlers.splice(b,1)},a.prototype.fireChangeHandlers=function(){this.handlers.forEach(function(a){a(this.checkbox.checked)},this)},a.prototype.isOriginalDataSelected=function(){return this.checkbox.checked},a.prototype.selectOriginalData=function(){this.checkbox.checked=!0,this.fireChangeHandlers()},a.prototype.setVisible=function(a){this.containerDiv.style("display",a?null:"none")},a.prototype.setEnabled=function(a){this.parent.selectAll("label.originalDataSelectorLabel").classed("disabled",!a),this.checkbox.disabled=!a},SplitsBrowser.Controls.OriginalDataSelector=a}(),function(){"use strict";function a(a,b){if(a===b)return 0;if(""===a||""===b||a[0]!==b[0])return b>a?-1:1;var c=/^[^0-9]+/.exec(a);if(null!==c&&c.length>0){var d=c[0];if(0<d.length&&d.length<a.length&&b.substring(0,d.length)===d){var e=parseInt(a.substring(d.length),10),f=parseInt(b.substring(d.length),10);if(!isNaN(e)&&!isNaN(f))return e-f}}return b>a?-1:1}function b(a){return a.map(function(a){var b=a.nextControls.slice(0);return b[b.length-1]===h.FINISH&&(b[b.length-1]=f("FinishName")),{course:a.course,nextControls:b.join(", ")}})}var c=10,d=240,e=SplitsBrowser.formatTime,f=SplitsBrowser.getMessage,g=SplitsBrowser.getMessageWithFormatting,h=SplitsBrowser.Model.Course,i={};i.getFastestSplitsPopupData=function(a,b){var d=a.getFastestSplitsTo(c,b);return d=d.map(function(a){return{time:a.split,name:a.name,highlight:!1}}),{title:f("SelectedClassesPopupHeader"),data:d,placeholder:f("SelectedClassesPopupPlaceholder")}},i.getFastestSplitsForLegPopupData=function(a,b,c){var d=a.getCourse(),e=d.getControlCode(c-1),i=d.getControlCode(c),j=e===h.START?f("StartName"):e,k=i===h.FINISH?f("FinishName"):i,l=g("FastestLegTimePopupHeader",{$$START$$:j,$$END$$:k}),m=a.getPrimaryClassName(),n=b.getFastestSplitsForLeg(e,i).map(function(a){return{name:a.name,className:a.className,time:a.split,highlight:a.className===m}});return{title:l,data:n,placeholder:null}},i.getCompetitorsVisitingCurrentControlPopupData=function(a,b,c,i){var j,k=a.getCourse().getControlCode(c),l=Math.round(i)-d/2,m=Math.round(i)+d/2,n=b.getCompetitorsAtControlInTimeRange(k,l,m),o=a.getPrimaryClassName(),p=n.map(function(a){return{name:a.name,className:a.className,time:a.time,highlight:a.className===o}});j=k===h.START?f("StartName"):k===h.FINISH?f("FinishName"):g("ControlName",{$$CODE$$:k});var q=g("NearbyCompetitorsPopupHeader",{$$START$$:e(l),$$END$$:e(m),$$CONTROL$$:j});return{title:q,data:p,placeholder:f("NoNearbyCompetitors")}},i.getNextControlData=function(c,d,e){var i=Math.min(e,c.controls.length),j=c.getControlCode(i),k=d.getNextControlsAfter(j);k.sort(function(b,c){return a(b.course.name,c.course.name)});var l=j===h.START?f("StartName"):g("ControlName",{$$CODE$$:j});return{thisControl:l,nextControls:b(k)}},SplitsBrowser.Model.ChartPopupData=i}(),function(){"use strict";function a(a,b){this.shown=!1,this.mouseIn=!1,this.popupDiv=d3.select(a).append("div"),this.popupDiv.classed("chartPopup",!0).style("display","none").style("position","absolute"),this.dataHeader=this.popupDiv.append("div").classed("chartPopupHeader",!0).append("span");var c=this.popupDiv.append("div").classed("chartPopupTableContainer",!0);this.dataTable=c.append("table"),this.popupDiv.selectAll(".nextControls").style("display","none");for(var d in b)b.hasOwnProperty(d)&&$(this.popupDiv.node()).on(d,b[d]);var e=this;$(this.popupDiv.node()).mouseenter(function(){e.mouseIn=!0}),$(this.popupDiv.node()).mouseleave(function(){e.mouseIn=!1})}var b=SplitsBrowser.formatTime;a.prototype.isShown=function(){return this.shown},a.prototype.isMouseIn=function(){return this.mouseIn},a.prototype.setData=function(a,c){this.dataHeader.text(a.title);var d=this.dataTable.selectAll("tr").data(a.data);d.enter().append("tr"),d.classed("highlighted",function(a){return a.highlight}),d.selectAll("td").remove(),d.append("td").text(function(a){return b(a.time)}),c&&d.append("td").text(function(a){return a.className}),d.append("td").text(function(a){return a.name}),d.exit().remove(),0===a.data.length&&null!==a.placeholder&&this.dataTable.append("tr").append("td").text(a.placeholder)},a.prototype.setNextControlData=function(a){this.dataHeader.text(a.thisControl);var b=this.dataTable.selectAll("tr").data(a.nextControls);b.enter().append("tr"),b.selectAll("td").remove(),b.classed("highlighted",!1),b.append("td").text(function(a){return a.course.name}),b.append("td").text("-->"),b.append("td").text(function(a){return a.nextControls}),b.exit().remove()},a.prototype.setLocation=function(a){this.popupDiv.style("left",a.x+"px").style("top",a.y+"px")},a.prototype.show=function(a){this.popupDiv.style("display",null),this.shown=!0,this.setLocation(a)},a.prototype.hide=function(){this.popupDiv.style("display","none"),this.shown=!1},a.prototype.height=function(){return $(this.popupDiv.node()).height()},SplitsBrowser.Controls.ChartPopup=a}(),function(){"use strict";function a(a,b){var c;return c=null===b?"-":s(b)?"?":b.toString(),n+p(a)+" ("+c+")"}function b(a,b){return""===b?a:a+" ("+b+")"}function c(a){return a.completed()&&a.isNonCompetitive?q("NonCompetitiveShort"):a.isNonFinisher?q("DidNotFinishShort"):a.isDisqualified?q("DisqualifiedShort"):a.isOverMaxTime?q("OverMaxTimeShort"):a.completed()?"":q("MispunchedShort")}function d(a){this.parent=a,this.xScale=null,this.yScale=null,this.overallWidth=-1,this.overallHeight=-1,this.contentWidth=-1,this.contentHeight=-1,this.numControls=-1,this.selectedIndexes=[],this.currentCompetitorData=null,this.isPopupOpen=!1,this.popupUpdateFunc=null,this.maxStartTimeLabelWidth=0,this.mouseOutTimeout=null,this.selectedIndexesOrderedByLastYValue=[],this.referenceCumTimes=[],this.referenceCumTimesSorted=[],this.referenceCumTimeIndexes=[],this.fastestCumTimes=[],this.isMouseIn=!1,this.currentControlIndex=null,this.actualControlIndex=null,this.controlLine=null,this.svg=d3.select(this.parent).append("svg").attr("id",g),this.svgGroup=this.svg.append("g"),this.setLeftMargin(i.left);var b=this,c=function(a){b.onMouseMove(a)},d=function(a){b.onMouseUp(a)},e=function(a){b.onMouseDown(a)};$(this.svg.node()).mouseenter(function(a){b.onMouseEnter(a)}).mousemove(c).mouseleave(function(a){b.onMouseLeave(a)}).mousedown(e).mouseup(d),$(this.svg.node()).contextmenu(function(a){a.preventDefault()}),this.textSizeElement=this.svg.append("text").attr("fill","transparent").attr("id",f);var h={mousemove:c,mousedown:e,mouseup:d};this.popup=new u(a,h),$(document).mouseup(function(){b.popup.hide()})}function e(a){var b=a.filter(r);return b.length>0?d3.max(b):0}var f="sb-text-size-element",g="chart",h=10,i={top:18,right:0,bottom:18,left:53},j=10,k=10,l=1,m=3,n="\xa0\xa0\xa0\xa0",o=["#FF0000","#4444FF","#00FF00","#000000","#CC0066","#000099","#FFCC00","#884400","#9900FF","#CCCC00","#888800","#CC6699","#00DD00","#3399FF","#BB00BB","#00DDDD","#FF00FF","#0088BB","#888888","#FF99FF","#55BB33"],p=SplitsBrowser.formatTime,q=SplitsBrowser.getMessage,r=SplitsBrowser.isNotNullNorNaN,s=SplitsBrowser.isNaNStrict,t=SplitsBrowser.Model.ChartPopupData,u=SplitsBrowser.Controls.ChartPopup;d.prototype.setLeftMargin=function(a){this.currentLeftMargin=a,this.svgGroup.attr("transform","translate("+this.currentLeftMargin+","+i.top+")")},d.prototype.getPopupLocation=function(a){return{x:a.pageX+h,y:Math.max(a.pageY-this.popup.height()/2,0)}},d.prototype.getFastestSplitsPopupData=function(){return t.getFastestSplitsPopupData(this.courseClassSet,this.currentControlIndex)},d.prototype.getFastestSplitsForCurrentLegPopupData=function(){return t.getFastestSplitsForLegPopupData(this.courseClassSet,this.eventData,this.currentControlIndex)},d.prototype.setCurrentChartTime=function(a){var b=a.pageY-$(this.svg.node()).offset().top-i.top;this.currentChartTime=Math.round(60*this.yScale.invert(b))+this.referenceCumTimes[this.currentControlIndex]},d.prototype.getCompetitorsVisitingCurrentControlPopupData=function(){return t.getCompetitorsVisitingCurrentControlPopupData(this.courseClassSet,this.eventData,this.currentControlIndex,this.currentChartTime)},d.prototype.getNextControlData=function(){return t.getNextControlData(this.courseClassSet.getCourse(),this.eventData,this.actualControlIndex)},d.prototype.onMouseEnter=function(a){null!==this.mouseOutTimeout&&(clearTimeout(this.mouseOutTimeout),this.mouseOutTimeout=null),this.isMouseIn=!0,this.updateControlLineLocation(a)},d.prototype.onMouseMove=function(a){this.isMouseIn&&null!==this.xScale&&this.updateControlLineLocation(a)},d.prototype.onMouseLeave=function(){var a=this;this.mouseOutTimeout=setTimeout(function(){a.popup.isMouseIn()||(a.isMouseIn=!1,a.removeControlLine())},1)},d.prototype.onMouseDown=function(a){var b=this;setTimeout(function(){b.showPopupDialog(a)},1)},d.prototype.onMouseUp=function(a){this.popup.hide(),a.preventDefault()},d.prototype.showPopupDialog=function(a){if(this.isMouseIn&&null!==this.currentControlIndex){var b=!1,c=this;!this.isRaceGraph||a.which!==l&&a.which!==m?a.which===l?(this.popupUpdateFunc=function(){c.popup.setData(c.getFastestSplitsPopupData(),!1)},b=!0):a.which===m&&this.hasControls&&(this.popupUpdateFunc=function(){c.popup.setData(c.getFastestSplitsForCurrentLegPopupData(),!0)},b=!0):this.hasControls&&(this.setCurrentChartTime(a),this.popupUpdateFunc=function(){c.popup.setData(c.getCompetitorsVisitingCurrentControlPopupData(),!0)},b=!0),b&&(this.updatePopupContents(a),this.popup.show(this.getPopupLocation(a)))}},d.prototype.updatePopupContents=function(a){var b=a.pageY-$(this.svg.node()).offset().top,c=this.hasControls&&b<i.top;c?this.updateNextControlInformation():this.popupUpdateFunc()},d.prototype.updateNextControlInformation=function(){this.hasControls&&this.popup.setNextControlData(this.getNextControlData())},d.prototype.drawControlLine=function(a){this.currentControlIndex=a,this.updateCompetitorStatistics();var b=this.xScale(this.referenceCumTimes[a]);this.controlLine=this.svgGroup.append("line").attr("x1",b).attr("y1",0).attr("x2",b).attr("y2",this.contentHeight).attr("class","controlLine").node()},d.prototype.updateControlLineLocation=function(a){var b=$(this.svg.node()),c=b.offset(),d=a.pageX-c.left,e=a.pageY-c.top;if(this.currentLeftMargin<=d&&d<b.width()-i.right&&e<b.height()-i.bottom){var f,g=this.xScale.invert(d-this.currentLeftMargin),h=d3.bisect(this.referenceCumTimesSorted,g);if(h>=this.referenceCumTimesSorted.length)f=this.referenceCumTimesSorted.length-1;else{var j=Math.abs(this.referenceCumTimesSorted[h]-g),k=Math.abs(g-this.referenceCumTimesSorted[h-1]);f=j>k?h-1:h}var l=this.referenceCumTimeIndexes[f];(null===this.actualControlIndex||this.actualControlIndex!==l)&&(this.removeControlLine(),this.actualControlIndex=l,this.drawControlLine(Math.max(this.minViewableControl,l))),this.popup.isShown()&&null!==this.currentControlIndex&&(this.isRaceGraph&&this.setCurrentChartTime(a),this.updatePopupContents(a),this.popup.setLocation(this.getPopupLocation(a)))}else this.removeControlLine(),this.popup.hide()},d.prototype.removeControlLine=function(){this.currentControlIndex=null,this.actualControlIndex=null,this.updateCompetitorStatistics(),null!==this.controlLine&&(d3.select(this.controlLine).remove(),this.controlLine=null)},d.prototype.getTimesBehindFastest=function(a,b){var c=b.map(function(a){return this.courseClassSet.allCompetitors[a]},this),d=this.fastestCumTimes[a]-this.fastestCumTimes[a-1],e=c.map(function(b){var c=b.getSplitTimeTo(a);return null===c?null:c-d});return e},d.prototype.getTimeLosses=function(a,b){var c=b.map(function(a){return this.courseClassSet.allCompetitors[a]},this),d=c.map(function(b){return b.getTimeLossAt(a)});return d},d.prototype.updateCompetitorStatistics=function(){var d=this.selectedIndexesOrderedByLastYValue.map(function(a){return this.courseClassSet.allCompetitors[a]},this),e=d.map(function(a){return b(a.name,c(a))});if(null!==this.currentControlIndex&&this.currentControlIndex>0){if(this.visibleStatistics.TotalTime){var f=d.map(function(a){return a.getCumulativeTimeTo(this.currentControlIndex)},this),g=d.map(function(a){return a.getCumulativeRankTo(this.currentControlIndex)},this);e=d3.zip(e,f,g).map(function(b){return b[0]+a(b[1],b[2])})}if(this.visibleStatistics.SplitTime){var h=d.map(function(a){return a.getSplitTimeTo(this.currentControlIndex)},this),i=d.map(function(a){return a.getSplitRankTo(this.currentControlIndex)},this);e=d3.zip(e,h,i).map(function(b){return b[0]+a(b[1],b[2])})}if(this.visibleStatistics.BehindFastest){var j=this.getTimesBehindFastest(this.currentControlIndex,this.selectedIndexesOrderedByLastYValue);e=d3.zip(e,j).map(function(a){return a[0]+n+p(a[1])})}if(this.visibleStatistics.TimeLoss){var k=this.getTimeLosses(this.currentControlIndex,this.selectedIndexesOrderedByLastYValue);e=d3.zip(e,k).map(function(a){return a[0]+n+p(a[1])})}}this.currentCompetitorData.forEach(function(a,b){a.label=e[b]}),d3.selectAll("text.competitorLabel").text(function(a){return a.label})},d.prototype.getTickFormatter=function(){var a=this;return function(b,c){return 0===c?q("StartNameShort"):c===a.numControls+1?q("FinishNameShort"):c.toString()}},d.prototype.getTextWidth=function(a){return this.textSizeElement.text(a).node().getBBox().width},d.prototype.getTextHeight=function(a){return this.textSizeElement.text(a).node().getBBox().height},d.prototype.getMaxGraphEndTextWidth=function(){if(0===this.selectedIndexes.length)return 0;var a=this.selectedIndexes.map(function(a){var d=this.courseClassSet.allCompetitors[a];return this.getTextWidth(b(d.name,c(d)))},this);return d3.max(a)+this.determineMaxStatisticTextWidth()},d.prototype.getMaxTimeAndRankTextWidth=function(b,c){var d=0,f=0,g=this.selectedIndexes.map(function(a){return this.courseClassSet.allCompetitors[a]},this);d3.range(1,this.numControls+2).forEach(function(a){var h=g.map(function(c){return c[b](a)});d=Math.max(d,e(h));var i=g.map(function(b){return b[c](a)});f=Math.max(f,e(i))});var h=a(d,f);return this.getTextWidth(h)},d.prototype.getMaxSplitTimeAndRankTextWidth=function(){return this.getMaxTimeAndRankTextWidth("getSplitTimeTo","getSplitRankTo")},d.prototype.getMaxCumulativeTimeAndRankTextWidth=function(){return this.getMaxTimeAndRankTextWidth("getCumulativeTimeTo","getCumulativeRankTo")},d.prototype.getMaxTimeBehindFastestWidth=function(){for(var a=0,b=1;b<=this.numControls+1;b+=1){var c=this.getTimesBehindFastest(b,this.selectedIndexes);
a=Math.max(a,e(c))}return this.getTextWidth(n+p(a))},d.prototype.getMaxTimeLossWidth=function(){for(var a=0,b=0,c=1;c<=this.numControls+1;c+=1){var d=this.getTimeLosses(c,this.selectedIndexes),e=d.filter(r);e.length>0&&(a=Math.max(a,d3.max(e)),b=Math.min(b,d3.min(e)))}return Math.max(this.getTextWidth(n+p(a)),this.getTextWidth(n+p(b)))},d.prototype.determineMaxStatisticTextWidth=function(){var a=0;return this.visibleStatistics.TotalTime&&(a+=this.getMaxCumulativeTimeAndRankTextWidth()),this.visibleStatistics.SplitTime&&(a+=this.getMaxSplitTimeAndRankTextWidth()),this.visibleStatistics.BehindFastest&&(a+=this.getMaxTimeBehindFastestWidth()),this.visibleStatistics.TimeLoss&&(a+=this.getMaxTimeLossWidth()),a},d.prototype.determineMaxStartTimeLabelWidth=function(a){var b;return b=a.competitorNames.length>0?d3.max(a.competitorNames.map(function(a){return this.getTextWidth("00:00:00 "+a)},this)):0},d.prototype.createScales=function(a){this.xScale=d3.scale.linear().domain(a.xExtent).range([0,this.contentWidth]),this.yScale=d3.scale.linear().domain(a.yExtent).range([0,this.contentHeight]),this.xScaleMinutes=d3.scale.linear().domain([a.xExtent[0]/60,a.xExtent[1]/60]).range([0,this.contentWidth])},d.prototype.drawBackgroundRectangles=function(){var a=this.referenceCumTimes.slice(0);a.sort(d3.ascending);for(var b=1;b<a.length;)a[b]===a[b-1]?a.splice(b,1):b+=1;var c=this,d=this.svgGroup.selectAll("rect").data(d3.range(a.length-1));d.enter().append("rect"),d.attr("x",function(b){return c.xScale(a[b])}).attr("y",0).attr("width",function(b){return c.xScale(a[b+1])-c.xScale(a[b])}).attr("height",this.contentHeight).attr("class",function(a){return 0===a%2?"background1":"background2"}),d.exit().remove()},d.prototype.determineYAxisTickFormatter=function(a){if(this.isRaceGraph){var b=0===a.dataColumns.length?[]:a.dataColumns[0].ys;if(0===b.length)return function(a){return p(60*a)};var c=this.yScale;return function(a){var d=d3.min(b.map(function(b){return Math.abs(c(b)-c(a))}));return d>=k?p(Math.round(60*a)):""}}return null},d.prototype.drawAxes=function(a,b){var c=this.determineYAxisTickFormatter(b),d=d3.svg.axis().scale(this.xScale).orient("top").tickFormat(this.getTickFormatter()).tickValues(this.referenceCumTimes),e=d3.svg.axis().scale(this.yScale).tickFormat(c).orient("left"),f=d3.svg.axis().scale(this.xScaleMinutes).orient("bottom");this.svgGroup.selectAll("g.axis").remove(),this.svgGroup.append("g").attr("class","x axis").call(d),this.svgGroup.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("x",-(this.contentHeight-6)).attr("y",6).attr("dy",".71em").style("text-anchor","start").text(a),this.svgGroup.append("g").attr("class","x axis").attr("transform","translate(0,"+this.contentHeight+")").call(f).append("text").attr("x",60).attr("y",-5).style("text-anchor","start").text(q("LowerXAxisChartLabel"))},d.prototype.drawChartLines=function(a){var b=this,c=function(c){return a.dataColumns.some(function(a){return r(a.ys[c])})?d3.svg.line().x(function(a){return b.xScale(a.x)}).y(function(a){return b.yScale(a.ys[c])}).defined(function(a){return r(a.ys[c])}).interpolate("linear"):d3.svg.line().x(0).y(0).defined(function(a,b){return 0===b})};this.svgGroup.selectAll("path.graphLine").remove(),this.svgGroup.selectAll("line.aroundDubiousTimes").remove(),d3.range(this.numLines).forEach(function(d){var e=o[this.selectedIndexes[d]%o.length],f=function(){b.highlight(b.selectedIndexes[d])},g=function(){b.unhighlight()};this.svgGroup.append("path").attr("d",c(d)(a.dataColumns)).attr("stroke",e).attr("class","graphLine competitor"+this.selectedIndexes[d]).on("mouseenter",f).on("mouseleave",g).append("title").text(a.competitorNames[d]),a.dubiousTimesInfo[d].forEach(function(b){this.svgGroup.append("line").attr("x1",this.xScale(a.dataColumns[b.start].x)).attr("y1",this.yScale(a.dataColumns[b.start].ys[d])).attr("x2",this.xScale(a.dataColumns[b.end].x)).attr("y2",this.yScale(a.dataColumns[b.end].ys[d])).attr("stroke",e).attr("class","aroundDubiousTimes competitor"+this.selectedIndexes[d]).on("mouseenter",f).on("mouseleave",g).append("title").text(a.competitorNames[d])},this)},this)},d.prototype.highlight=function(a){this.svg.selectAll("path.graphLine.competitor"+a).classed("selected",!0),this.svg.selectAll("line.competitorLegendLine.competitor"+a).classed("selected",!0),this.svg.selectAll("text.competitorLabel.competitor"+a).classed("selected",!0),this.svg.selectAll("text.startLabel.competitor"+a).classed("selected",!0),this.svg.selectAll("line.aroundDubiousTimes.competitor"+a).classed("selected",!0)},d.prototype.unhighlight=function(){this.svg.selectAll("path.graphLine.selected").classed("selected",!1),this.svg.selectAll("line.competitorLegendLine.selected").classed("selected",!1),this.svg.selectAll("text.competitorLabel.selected").classed("selected",!1),this.svg.selectAll("text.startLabel.selected").classed("selected",!1),this.svg.selectAll("line.aroundDubiousTimes.selected").classed("selected",!1)},d.prototype.drawCompetitorStartTimeLabels=function(a){var b=a.dataColumns[0],c=this,d=this.svgGroup.selectAll("text.startLabel").data(this.selectedIndexes);d.enter().append("text"),d.attr("x",-7).attr("y",function(d,e){return c.yScale(b.ys[e])+c.getTextHeight(a.competitorNames[e])/4}).attr("class",function(a){return"startLabel competitor"+a}).on("mouseenter",function(a){c.highlight(a)}).on("mouseleave",function(){c.unhighlight()}).text(function(c,d){return p(Math.round(60*b.ys[d]))+" "+a.competitorNames[d]}),d.exit().remove()},d.prototype.removeCompetitorStartTimeLabels=function(){this.svgGroup.selectAll("text.startLabel").remove()},d.prototype.adjustCompetitorLegendLabelsDownwardsIfNecessary=function(){for(var a=1;a<this.numLines;a+=1){var b=this.currentCompetitorData[a-1],c=this.currentCompetitorData[a];c.y<b.y+b.textHeight&&(c.y=b.y+b.textHeight)}},d.prototype.adjustCompetitorLegendLabelsUpwardsIfNecessary=function(a){if(this.numLines>0&&this.currentCompetitorData[this.numLines-1].y>this.contentHeight){this.currentCompetitorData[this.numLines-1].y=Math.max(a,this.contentHeight);for(var b=this.numLines-2;b>=0;b-=1){var c=this.currentCompetitorData[b+1],d=this.currentCompetitorData[b];if(!(d.y+d.textHeight>c.y))break;d.y=c.y-d.textHeight}}},d.prototype.drawCompetitorLegendLabels=function(a){var d=0;if(0===a.dataColumns.length)this.currentCompetitorData=[];else{var e=a.dataColumns[a.dataColumns.length-1];this.currentCompetitorData=d3.range(this.numLines).map(function(a){var f=this.selectedIndexes[a],g=this.courseClassSet.allCompetitors[f].name,h=this.getTextHeight(g);return d+=h,{label:b(g,c(this.courseClassSet.allCompetitors[f])),textHeight:h,y:r(e.ys[a])?this.yScale(e.ys[a]):null,colour:o[f%o.length],index:f}},this),d-=this.currentCompetitorData[this.numLines-1].textHeight;for(var f=null,g=this.numLines-1;g>=0;g-=1)null===this.currentCompetitorData[g].y&&(this.currentCompetitorData[g].y=null===f?this.contentHeight:f-this.currentCompetitorData[g].textHeight,f=this.currentCompetitorData[g].y)}this.currentCompetitorData.sort(function(a,b){return a.y-b.y}),this.selectedIndexesOrderedByLastYValue=this.currentCompetitorData.map(function(a){return a.index}),this.adjustCompetitorLegendLabelsDownwardsIfNecessary(),this.adjustCompetitorLegendLabelsUpwardsIfNecessary(d);var h=this.svgGroup.selectAll("line.competitorLegendLine").data(this.currentCompetitorData);h.enter().append("line");var i=this;h.attr("x1",this.contentWidth+1).attr("y1",function(a){return a.y}).attr("x2",this.contentWidth+j+1).attr("y2",function(a){return a.y}).attr("stroke",function(a){return a.colour}).attr("class",function(a){return"competitorLegendLine competitor"+a.index}).on("mouseenter",function(a){i.highlight(a.index)}).on("mouseleave",function(){i.unhighlight()}),h.exit().remove();var k=this.svgGroup.selectAll("text.competitorLabel").data(this.currentCompetitorData);k.enter().append("text"),k.attr("x",this.contentWidth+j+2).attr("y",function(a){return a.y+a.textHeight/4}).attr("class",function(a){return"competitorLabel competitor"+a.index}).on("mouseenter",function(a){i.highlight(a.index)}).on("mouseleave",function(){i.unhighlight()}).text(function(a){return a.label}),k.exit().remove()},d.prototype.adjustContentSize=function(){var a=8,b=this.getMaxGraphEndTextWidth();this.setLeftMargin(Math.max(this.maxStartTimeLabelWidth+a,i.left)),this.contentWidth=Math.max(this.overallWidth-this.currentLeftMargin-i.right-b-(j+2),100),this.contentHeight=Math.max(this.overallHeight-i.top-i.bottom,100)},d.prototype.setSize=function(a,b){this.overallWidth=a,this.overallHeight=b,$(this.svg.node()).width(a).height(b),this.adjustContentSize()},d.prototype.clearGraph=function(){this.svgGroup.selectAll("*").remove()},d.prototype.sortReferenceCumTimes=function(){var a=d3.map();this.referenceCumTimes.forEach(function(b,c){a.has(b)||a.set(b,c)}),this.referenceCumTimesSorted=this.referenceCumTimes.slice(0),this.referenceCumTimesSorted.sort(d3.ascending);for(var b=this.referenceCumTimesSorted.length-1;b>0;b-=1)this.referenceCumTimesSorted[b]===this.referenceCumTimesSorted[b-1]&&this.referenceCumTimesSorted.splice(b,1);this.referenceCumTimeIndexes=this.referenceCumTimesSorted.map(function(b){return a.get(b)})},d.prototype.drawChart=function(a,b,c,d){var e=a.chartData;this.numControls=e.numControls,this.numLines=e.competitorNames.length,this.selectedIndexes=b,this.referenceCumTimes=a.referenceCumTimes,this.fastestCumTimes=a.fastestCumTimes,this.eventData=a.eventData,this.courseClassSet=a.courseClassSet,this.hasControls=a.courseClassSet.getCourse().hasControls(),this.isRaceGraph=d.isRaceGraph,this.minViewableControl=d.minViewableControl,this.visibleStatistics=c,this.maxStatisticTextWidth=this.determineMaxStatisticTextWidth(),this.maxStartTimeLabelWidth=this.isRaceGraph?this.determineMaxStartTimeLabelWidth(e):0,this.sortReferenceCumTimes(),this.adjustContentSize(),this.createScales(e),this.drawBackgroundRectangles(),this.drawAxes(q(d.yAxisLabelKey),e),this.drawChartLines(e),this.drawCompetitorLegendLabels(e),this.removeControlLine(),this.isRaceGraph?this.drawCompetitorStartTimeLabels(e):this.removeCompetitorStartTimeLabels()},SplitsBrowser.Controls.Chart=d}(),function(){"use strict";function a(a){this.parent=a,this.courseClass=null,this.div=null,this.headerSpan=null,this.table=null,this.buildTable()}function b(a){var b=0,c=1;return a.forEach(function(a){a.getAllOriginalCumulativeTimes().forEach(function(a){if(h(a))for(;j>b&&Math.abs(a-Math.round(a*c)/c)>1e-7*a;)b+=1,c*=10})}),b}function c(a){return a.isNonStarter?f("DidNotStartShort"):a.isNonFinisher?f("DidNotFinishShort"):a.isDisqualified?f("DisqualifiedShort"):a.isOverMaxTime?f("OverMaxTimeShort"):a.completed()?d(a.totalTime):f("MispunchedShort")}var d=SplitsBrowser.formatTime,e=SplitsBrowser.Model.compareCompetitors,f=SplitsBrowser.getMessage,g=SplitsBrowser.getMessageWithFormatting,h=SplitsBrowser.isNotNullNorNaN,i="\xa0",j=2;a.prototype.buildTable=function(){this.div=d3.select(this.parent).append("div").attr("id","resultsTableContainer"),this.headerSpan=this.div.append("div").append("span").classed("resultsTableHeader",!0),this.table=this.div.append("table").classed("resultsTable",!0),this.table.append("thead").append("tr"),this.table.append("tbody")},a.prototype.populateTable=function(){function a(a,b,c,d,e,f){var g=a.append("td");g.append("span").classed("dubious",e).text(b),g.append("br"),g.append("span").classed("dubious",f).text(c),d&&g.classed(d,!0)}var h=this.courseClass.name+", ";h+=1===this.courseClass.numControls?f("ResultsTableHeaderSingleControl"):g("ResultsTableHeaderMultipleControls",{$$NUM$$:this.courseClass.numControls});var j=this.courseClass.course;null!==j.length&&(h+=", "+g("ResultsTableHeaderCourseLength",{$$DISTANCE$$:j.length.toFixed(1)})),null!==j.climb&&(h+=", "+g("ResultsTableHeaderClimb",{$$CLIMB$$:j.climb})),this.headerSpan.text(h);var k=[f("ResultsTableHeaderControlNumber"),f("ResultsTableHeaderName"),f("ResultsTableHeaderTime")],l=this.courseClass.course.controls;k=null===l?k.concat(d3.range(1,this.courseClass.numControls+1)):k.concat(l.map(function(a,b){return b+1+i+"("+a+")"})),k.push(f("FinishName"));var m=this.table.select("thead tr").selectAll("th").data(k);m.enter().append("th"),m.text(function(a){return a}),m.exit().remove();var n=this.table.select("tbody");n.selectAll("tr").remove();var o=this.courseClass.competitors.slice(0);o.sort(e);var p=0,q=0,r=b(o);o.forEach(function(b,e){var g=n.append("tr"),h=g.append("td");b.isNonCompetitive?(h.text(f("NonCompetitiveShort")),p+=1):b.completed()&&((0===e||o[e-1].totalTime!==b.totalTime)&&(q=e+1-p),h.text(q)),a(g,b.name,b.club,!1,!1),a(g,c(b),i,"time",!1,!1),d3.range(1,this.courseClass.numControls+2).forEach(function(c){var e=b.isCumulativeTimeDubious(c),f=b.isSplitTimeDubious(c);a(g,d(b.getOriginalCumulativeTimeTo(c),r),d(b.getOriginalSplitTimeTo(c),r),"time",e,f)})},this)},a.prototype.setClass=function(a){this.courseClass=a,this.populateTable(),"none"!==this.div.style("display")&&this.adjustTableCellWidths()},a.prototype.adjustTableCellWidths=function(){var a=d3.select("tbody tr td:last-child").node();$("tbody td.time").width($(a).width())},a.prototype.show=function(){this.div.style("display",null),this.adjustTableCellWidths()},a.prototype.hide=function(){this.div.style("display","none")},a.prototype.retranslate=function(){this.populateTable(),"none"!==this.div.style("display")&&this.adjustTableCellWidths()},SplitsBrowser.Controls.ResultsTable=a}(),function(){"use strict";function a(a,b){return a.replace(new RegExp(b.source,"g"),"")}function b(a,b){var c=t.exec(a);if(null===c)return null;for(var d=d3.map(),e=0;e<b.classes.length;e+=1)d.set(b.classes[e].name,b.classes[e]);var f=decodeURIComponent(c[1]).split(";");f=d3.set(f).values();var g=f.filter(function(a){return d.has(a)}).map(function(a){return d.get(a)});if(0===g.length)return null;var h=g[0].course;return g=g.filter(function(a){return a.course===h}),new s(g)}function c(b,c,d){b=a(b,t);var e=d.map(function(a){return c.classes[a].name});return b+"&class="+encodeURIComponent(e.join(";"))}function d(a){var b=u.exec(a);if(null===b)return null;var c=b[1];return r.hasOwnProperty(c)?r[c]:null}function e(b,c){b=a(b,u);for(var d in r)if(r.hasOwnProperty(d)&&r[d]===c)return b+"&chartType="+encodeURIComponent(d);return b}function f(a,b){var c=v.exec(a);if(null===c)return null;var d=decodeURIComponent(c[1]),e=w.indexOf(d);if(e>=1)return{index:e,runner:null};if(0===e&&null!==b){var f=b.allCompetitors.some(function(a){return a.completed()});return f?{index:0,runner:null}:null}if(null===b)return null;for(var g=0;g<b.allCompetitors.length;g+=1){var h=b.allCompetitors[g];if(h.name===d&&h.completed())return{index:w.length,runner:h}}return null}function g(b,c,d){b=a(b,v);var e=null;return"number"==typeof c&&c>=0&&c<w.length?e=w[c]:null!==d&&(e=d.name),null===e?b:b+"&compareWith="+encodeURIComponent(e)}function h(a,b){if(null===b)return null;var c=x.exec(a);if(null===c)return null;var d=decodeURIComponent(c[1]).split(";");if(d.indexOf("*")>=0)return d3.range(0,b.allCompetitors.length);d=d3.set(d).values();var e=b.allCompetitors.map(function(a){return a.name}),f=[];return d.forEach(function(a){var b=e.indexOf(a);b>=0&&f.push(b)}),f.sort(d3.ascending),0===f.length?null:f}function i(b,c,d){b=a(b,x);var e=d.map(function(a){return c.allCompetitors[a]});if(0===e.length)return b;if(e.length===c.allCompetitors.length)return b+"&selected=*";var f=e.map(function(a){return a.name}).join(";");return b+"&selected="+encodeURIComponent(f)}function j(a){var b=y.exec(a);if(null===b)return null;var c=decodeURIComponent(b[1]).split(";"),d={};z.forEach(function(a){d[a]=!1});for(var e=0;e<c.length;e+=1){var f=c[e];if(d.hasOwnProperty(f))d[f]=!0;else if(""!==f)return null}return d}function k(b,c){b=a(b,y);var d=z.filter(function(a){return c.hasOwnProperty(a)&&c[a]});return b+"&stats="+encodeURIComponent(d.join(";"))}function l(a){var b=A.exec(a);return null!==b&&"1"===b[1]}function m(b,c){return b=a(b,A),c?b+"&showOriginal=1":b}function n(a){var b=B.exec(a);return null===b?"":decodeURIComponent(b[1])}function o(b,c){return b=a(b,B),""===c?b:b+"&filterText="+encodeURIComponent(c)}function p(a,c){var e=b(a,c),g=null===e?null:e.classes.map(function(a){return c.classes.indexOf(a)});return{classes:g,chartType:d(a),compareWith:f(a,e),selected:h(a,e),stats:j(a),showOriginal:l(a),filterText:n(a)}}function q(a,b,d,f){return a=c(a,b,f.classes),a=e(a,f.chartType),a=g(a,f.compareWith.index,f.compareWith.runner),a=i(a,d,f.selected),a=k(a,f.stats),a=m(a,f.showOriginal),a=o(a,f.filterText),a=a.replace(/^\??&/,"")}var r=SplitsBrowser.Model.ChartTypes,s=SplitsBrowser.Model.CourseClassSet,t=/(?:^|&|\?)class=([^&]+)/,u=/(?:^|&|\?)chartType=([^&]+)/,v=/(?:^|&|\?)compareWith=([^&]+)/,w=["Winner","FastestTime","FastestTimePlus5","FastestTimePlus25","FastestTimePlus50","FastestTimePlus100"],x=/(?:^|&|\?)selected=([^&]+)/,y=/(?:^|&|\?)stats=([^&]*)/,z=["TotalTime","SplitTime","BehindFastest","TimeLoss"],A=/(?:^|&|\?)showOriginal=([^&]*)/,B=/(?:^|&|\?)filterText=([^&]*)/;SplitsBrowser.parseQueryString=p,SplitsBrowser.formatQueryString=q}(),function(){"use strict";function a(a){this.options=a,this.eventData=null,this.classes=null,this.currentClasses=[],this.chartData=null,this.referenceCumTimes=null,this.fastestCumTimes=null,this.previousCompetitorList=[],this.topBarHeight=a&&a.topBar&&$(a.topBar).length>0?$(a.topBar).outerHeight(!0):0,this.selection=null,this.courseClassSet=null,this.languageSelector=null,this.classSelector=null,this.comparisonSelector=null,this.originalDataSelector=null,this.statisticsSelector=null,this.competitorList=null,this.chart=null,this.topPanel=null,this.mainPanel=null,this.buttonsPanel=null,this.competitorListContainer=null,this.container=null,this.currentResizeTimeout=null}function b(a){alert(a)}function c(){alert(i("RaceGraphDisabledAsStartTimesMissing"))}function d(a,b){var c=d3.select("body").append("div").classed("sbErrors",!0);c.append("h1").text(i("LoadFailedHeader")),c.append("p").text(k(a,b))}function e(a,b,c){"success"===b?SplitsBrowser.readEvent(a,c):d("LoadFailedStatusNotSuccess",{$$STATUS$$:b})}function f(a,b,c){d("LoadFailedReadError",{$$ERROR$$:c})}var g=100,h=SplitsBrowser.Version,i=SplitsBrowser.getMessage,j=SplitsBrowser.tryGetMessage,k=SplitsBrowser.getMessageWithFormatting,l=SplitsBrowser.initialiseMessages,m=SplitsBrowser.Model,n=m.CompetitorSelection,o=m.CourseClassSet,p=m.ChartTypes,q=SplitsBrowser.Input.parseEventData,r=SplitsBrowser.DataRepair.repairEventData,s=SplitsBrowser.DataRepair.transferCompetitorData,t=SplitsBrowser.parseQueryString,u=SplitsBrowser.formatQueryString,v=SplitsBrowser.Controls,w=v.LanguageSelector,x=v.ClassSelector,y=v.ChartTypeSelector,z=v.ComparisonSelector,A=v.OriginalDataSelector,B=v.StatisticsSelector,C=v.CompetitorList,D=v.Chart,E=v.ResultsTable;a.prototype.enableOrDisableRaceGraph=function(){var a=this.courseClassSet.allCompetitors.some(function(a){return a.lacksStartTime()});this.chartTypeSelector.setRaceGraphDisabledNotifier(a?c:null)},a.prototype.setEvent=function(a){this.eventData=a,this.classes=a.classes,null!==this.classSelector&&this.classSelector.setClasses(this.classes)},a.prototype.drawLogo=function(){this.logoSvg=this.topPanel.append("svg").classed("topRowStart",!0),this.logoSvg.style("width","19px").style("height","19px").style("margin-bottom","-3px"),this.logoSvg.append("rect").attr("x","0").attr("y","0").attr("width","19").attr("height","19").attr("fill","white"),this.logoSvg.append("polygon").attr("points","0,19 19,0 19,19").attr("fill","red"),this.logoSvg.append("polyline").attr("points","0.5,0.5 0.5,18.5 18.5,18.5 18.5,0.5 0.5,0.5 0.5,18.5").attr("stroke","black").attr("fill","none"),this.logoSvg.append("polyline").attr("points","1,12 5,8 8,14 17,11").attr("fill","none").attr("stroke","blue").attr("stroke-width","2"),this.logoSvg.selectAll("*").append("title"),this.setLogoMessages()},a.prototype.setLogoMessages=function(){this.logoSvg.selectAll("title").text(k("ApplicationVersion",{$$VERSION$$:h}))},a.prototype.addSpacer=function(){this.topPanel.append("div").classed("topRowStartSpacer",!0)},a.prototype.addLanguageSelector=function(){this.languageSelector=new w(this.topPanel.node())},a.prototype.addClassSelector=function(){this.classSelector=new x(this.topPanel.node()),null!==this.classes&&this.classSelector.setClasses(this.classes)},a.prototype.addChartTypeSelector=function(){var a=[p.SplitsGraph,p.RaceGraph,p.PositionAfterLeg,p.SplitPosition,p.PercentBehind,p.ResultsTable];this.chartTypeSelector=new y(this.topPanel.node(),a)},a.prototype.addComparisonSelector=function(){this.comparisonSelector=new z(this.topPanel.node(),b),null!==this.classes&&this.comparisonSelector.setClasses(this.classes)},a.prototype.addOriginalDataSelector=function(){this.originalDataSelector=new A(this.topPanel)},a.prototype.addDirectLink=function(){this.directLink=this.topPanel.append("a").classed("topRowStart",!0).attr("id","directLinkAnchor").attr("href",document.location.href),this.setDirectLinkMessages()},a.prototype.setDirectLinkMessages=function(){this.directLink.attr("title",j("DirectLinkToolTip","")).text(i("DirectLink"))},a.prototype.updateDirectLink=function(){var a={classes:this.classSelector.getSelectedClasses(),chartType:this.chartTypeSelector.getChartType(),compareWith:this.comparisonSelector.getComparisonType(),selected:this.selection.getSelectedIndexes(),stats:this.statisticsSelector.getVisibleStatistics(),showOriginal:this.courseClassSet.hasDubiousData()&&this.originalDataSelector.isOriginalDataSelected(),filterText:this.competitorList.getFilterText()},b=document.location.search,c=u(b,this.eventData,this.courseClassSet,a),d=document.location.href;this.directLink.attr("href",d.substring(0,d.length-b.length)+"?"+c.replace(/^\?+/,""))},a.prototype.addCompetitorList=function(){this.competitorList=new C(this.mainPanel.node(),b)},a.prototype.buildUi=function(){var a=d3.select("body");a.style("overflow","hidden"),this.container=a.append("div").attr("id","sbContainer"),this.topPanel=this.container.append("div"),this.drawLogo(),this.addLanguageSelector(),this.addSpacer(),this.addClassSelector(),this.addSpacer(),this.addChartTypeSelector(),this.addSpacer(),this.addComparisonSelector(),this.addOriginalDataSelector(),this.addSpacer(),this.addDirectLink(),this.statisticsSelector=new B(this.topPanel.node()),this.topPanel.append("div").style("clear","both"),this.mainPanel=this.container.append("div"),this.addCompetitorList(),this.chart=new D(this.mainPanel.node()),this.resultsTable=new E(this.container.node()),this.resultsTable.hide();var b=this;$(window).resize(function(){b.handleWindowResize()}),$("input:text").bind("selectstart",function(a){a.stopPropagation()}),$(this.container.node()).bind("selectstart",function(){return!1})},a.prototype.registerChangeHandlers=function(){var a=this;this.languageSelector.registerChangeHandler(function(){a.retranslate()}),this.classSelector.registerChangeHandler(function(b){a.selectClasses(b)}),this.chartTypeSelector.registerChangeHandler(function(b){a.selectChartTypeAndRedraw(b)}),this.comparisonSelector.registerChangeHandler(function(b){a.selectComparison(b)}),this.originalDataSelector.registerChangeHandler(function(b){a.showOriginalOrRepairedData(b)}),this.competitorList.registerChangeHandler(function(){a.handleFilterTextChanged()})},a.prototype.handleWindowResize=function(){null!==this.currentResizeTimeout&&clearTimeout(this.currentResizeTimeout);var a=this;this.currentResizeTimeout=setTimeout(function(){a.postResizeHook()},g)},a.prototype.postResizeHook=function(){this.currentResizeTimeout=null,this.setCompetitorListHeight(),this.setChartSize(),this.redraw()},a.prototype.getHorizontalMargin=function(){var a=$("body"),b=$(this.container.node());return a.outerWidth(!0)-a.width()+(b.outerWidth()-b.width())},a.prototype.getVerticalMargin=function(){var a=$("body"),b=$(this.container.node());return a.outerHeight(!0)-a.height()+(b.outerHeight()-b.height())},a.prototype.getUsableHeight=function(){var a=$(window).outerHeight()-this.getVerticalMargin()-this.topBarHeight,b=$(this.topPanel.node()).height();return a-b},a.prototype.setCompetitorListHeight=function(){this.competitorList.setHeight(this.getUsableHeight())},a.prototype.setChartSize=function(){var a=this.getHorizontalMargin(),b=this.getVerticalMargin(),c=2,d=$(window).width()-a,e=$(window).height()-b-this.topBarHeight;$(this.container.node()).width(d).height(e);var f=d-this.competitorList.width()-c,g=this.getUsableHeight();this.chart.setSize(f,g)},a.prototype.drawChart=function(){if(!this.chartTypeSelector.getChartType().isResultsTable){this.currentVisibleStatistics=this.statisticsSelector.getVisibleStatistics(),null!==this.selectionChangeHandler&&this.selection.deregisterChangeHandler(this.selectionChangeHandler),null!==this.statisticsChangeHandler&&this.statisticsSelector.deregisterChangeHandler(this.statisticsChangeHandler);var a=this;this.selectionChangeHandler=function(){a.competitorList.enableOrDisableCrossingRunnersButton(),a.redraw(),a.updateDirectLink()},this.selection.registerChangeHandler(this.selectionChangeHandler),this.statisticsChangeHandler=function(b){a.currentVisibleStatistics=b,a.redraw(),a.updateDirectLink()},this.statisticsSelector.registerChangeHandler(this.statisticsChangeHandler),this.updateControlEnabledness();var b=this.comparisonSelector.getComparisonFunction();this.referenceCumTimes=b(this.courseClassSet),this.fastestCumTimes=this.courseClassSet.getFastestCumTimes(),this.chartData=this.courseClassSet.getChartData(this.referenceCumTimes,this.selection.getSelectedIndexes(),this.chartTypeSelector.getChartType()),this.redrawChart()}},a.prototype.redrawChart=function(){var a={chartData:this.chartData,eventData:this.eventData,courseClassSet:this.courseClassSet,referenceCumTimes:this.referenceCumTimes,fastestCumTimes:this.fastestCumTimes};this.chart.drawChart(a,this.selection.getSelectedIndexes(),this.currentVisibleStatistics,this.chartTypeSelector.getChartType())},a.prototype.redraw=function(){var a=this.chartTypeSelector.getChartType();a.isResultsTable||(this.chartData=this.courseClassSet.getChartData(this.referenceCumTimes,this.selection.getSelectedIndexes(),a),this.redrawChart())},a.prototype.retranslate=function(){this.setLogoMessages(),this.languageSelector.setMessages(),this.classSelector.retranslate(),this.chartTypeSelector.setMessages(),this.comparisonSelector.setMessages(),this.originalDataSelector.setMessages(),this.setDirectLinkMessages(),this.statisticsSelector.setMessages(),this.competitorList.retranslate(),this.resultsTable.retranslate(),this.chartTypeSelector.getChartType().isResultsTable||this.redrawChart()},a.prototype.setClasses=function(a){this.currentClasses=a.map(function(a){return this.classes[a]},this),this.courseClassSet=new o(this.currentClasses),this.comparisonSelector.setCourseClassSet(this.courseClassSet),this.resultsTable.setClass(this.currentClasses[0]),this.enableOrDisableRaceGraph(),this.originalDataSelector.setVisible(this.courseClassSet.hasDubiousData())},a.prototype.initClasses=function(a){this.classSelector.selectClasses(a),this.setClasses(a),this.competitorList.setCompetitorList(this.courseClassSet.allCompetitors,this.currentClasses.length>1),this.selection=new n(this.courseClassSet.allCompetitors.length),this.competitorList.setSelection(this.selection),this.previousCompetitorList=this.courseClassSet.allCompetitors},a.prototype.selectClasses=function(a){a.length>0&&this.currentClasses.length>0&&this.classes[a[0]]===this.currentClasses[0]||this.selection.selectNone(),this.setClasses(a),this.competitorList.setCompetitorList(this.courseClassSet.allCompetitors,this.currentClasses.length>1),this.selection.migrate(this.previousCompetitorList,this.courseClassSet.allCompetitors),this.competitorList.selectionChanged(),this.chartTypeSelector.getChartType().isResultsTable||(this.setChartSize(),this.drawChart()),this.previousCompetitorList=this.courseClassSet.allCompetitors,this.updateDirectLink()},a.prototype.selectComparison=function(){this.drawChart(),this.updateDirectLink()},a.prototype.selectChartType=function(a){a.isResultsTable?(this.mainPanel.style("display","none"),this.container.style("width",null).style("height",null),d3.select("body").style("overflow",null),this.resultsTable.show()):(this.resultsTable.hide(),d3.select("body").style("overflow","hidden"),this.mainPanel.style("display",null),this.setChartSize()),this.updateControlEnabledness(),this.competitorList.setChartType(a)},a.prototype.selectChartTypeAndRedraw=function(a){this.selectChartType(a),this.drawChart(),this.updateDirectLink()},a.prototype.selectOriginalOrRepairedData=function(a){a?s(this.eventData):r(this.eventData),this.eventData.determineTimeLosses()},a.prototype.showOriginalOrRepairedData=function(a){this.selectOriginalOrRepairedData(a),this.drawChart(),this.updateDirectLink()},a.prototype.handleFilterTextChanged=function(){this.setChartSize(),this.redraw(),this.updateDirectLink()},a.prototype.updateControlEnabledness=function(){var a=this.chartTypeSelector.getChartType();this.classSelector.setOtherClassesEnabled(!a.isResultsTable),this.comparisonSelector.setEnabled(!a.isResultsTable),this.statisticsSelector.setEnabled(!a.isResultsTable),this.originalDataSelector.setEnabled(!a.isResultsTable),this.competitorList.enableOrDisableCrossingRunnersButton()},a.prototype.updateFromQueryString=function(a){null===a.classes?this.initClasses([0]):this.initClasses(a.classes),null!==a.chartType&&(this.chartTypeSelector.setChartType(a.chartType),this.selectChartType(a.chartType)),null!==a.compareWith&&this.comparisonSelector.setComparisonType(a.compareWith.index,a.compareWith.runner),null!==a.selected&&this.selection.setSelectedIndexes(a.selected),null!==a.stats&&this.statisticsSelector.setVisibleStatistics(a.stats),a.showOriginal&&this.courseClassSet.hasDubiousData()&&(this.originalDataSelector.selectOriginalData(),this.selectOriginalOrRepairedData(!0)),""!==a.filterText&&this.competitorList.setFilterText(a.filterText)},a.prototype.setDefaultSelectedClass=function(){this.initClasses([0])},SplitsBrowser.Viewer=a,SplitsBrowser.readEvent=function(b,c){var e;try{e=q(b)}catch(f){if("InvalidData"===f.name)return d("LoadFailedInvalidData",{$$MESSAGE$$:f.message}),void 0;throw f}if(null===e)d("LoadFailedUnrecognisedData",{});else{e.needsRepair()&&r(e),"string"==typeof c&&(c={topBar:c}),e.determineTimeLosses(),c&&c.defaultLanguage&&l(c.defaultLanguage);var g=new a(c);g.buildUi(),g.setEvent(e);var h=document.location.search;if(null!==h&&h.length>0){var i=t(h,e);g.updateFromQueryString(i)}else g.setDefaultSelectedClass();g.setCompetitorListHeight(),g.setChartSize(),g.drawChart(),g.registerChangeHandlers()}},SplitsBrowser.loadEvent=function(a,b){$.ajax({url:a,data:"",success:function(a,c){e(a,c,b)},dataType:"text",error:f})}}();