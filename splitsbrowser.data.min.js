/*!
 *  SplitsBrowser - Orienteering results analysis.
 *  
 *  Copyright (C) 2000-2020 Dave Ryder, Reinhard Balling, Andris Strazdins,
 *                          Ed Nash, Luke Woodward
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */
var SplitsBrowser={Version:"3.5.0",Model:{},Input:{},Controls:{},Messages:{}};!function(){"use strict";function e(t){this.name="InvalidData",this.message=t}function s(t){this.name="WrongFileFormat",this.message=t}SplitsBrowser.isTrue=function(t){return t},SplitsBrowser.isNotNull=function(t){return null!==t},SplitsBrowser.isNaNStrict=function(t){return t!=t},SplitsBrowser.isNotNullNorNaN=function(t){return null!==t&&t==t},e.prototype.toString=function(){return this.name+": "+this.message},SplitsBrowser.throwInvalidData=function(t){throw new e(t)},s.prototype.toString=function(){return this.name+": "+this.message},SplitsBrowser.throwWrongFileFormat=function(t){throw new s(t)},SplitsBrowser.hasProperty=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},SplitsBrowser.addIfNotNull=function(t,e){return null===t||null===e?null:t+e},SplitsBrowser.subtractIfNotNull=function(t,e){return null===t||null===e?null:t-e},SplitsBrowser.parseCourseLength=function(t){t=parseFloat(t.replace(",","."));return isFinite(t)?(500<=t&&(t/=1e3),t):null},SplitsBrowser.parseCourseClimb=function(t){t=parseInt(t,10);return SplitsBrowser.isNaNStrict(t)?null:t},SplitsBrowser.normaliseLineEndings=function(t){return t.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}}(),function(){"use strict";SplitsBrowser.NULL_TIME_PLACEHOLDER="-----";var i=SplitsBrowser.isNaNStrict;function o(t){return t<10?"0"+t:t.toString()}SplitsBrowser.formatTime=function(t,e){if(null===t)return SplitsBrowser.NULL_TIME_PLACEHOLDER;if(i(t))return"???";var s="";t<0&&(s="-",t=-t);var n=Math.floor(t/3600),r=Math.floor(t/60)%60,t=t%60;return 0<n&&(s+=n.toString()+":"),s+=o(r)+":",t<10&&(s+="0"),s+="number"==typeof e?t.toFixed(e):Math.round(100*t)/100},SplitsBrowser.formatTimeOfDay=function(t){var e=Math.floor(t/3600%24),s=Math.floor(t/60)%60,t=Math.floor(t%60);return o(e)+":"+o(s)+":"+o(t)},SplitsBrowser.parseTime=function(t){if(t=t.trim(),/^(-?\d+:)?-?\d+:-?\d\d([,.]\d+)?$/.test(t)){var t=t.replace(",",".").split(":"),e=0;return t.forEach(function(t){e=60*e+parseFloat(t)}),e}return null}}(),function(){"use strict";var i="number",t=SplitsBrowser.isNotNull,r=SplitsBrowser.isNaNStrict,e=SplitsBrowser.hasProperty,l=SplitsBrowser.addIfNotNull,n=SplitsBrowser.subtractIfNotNull,u=SplitsBrowser.throwInvalidData;function a(t){if(!$.isArray(t))throw new TypeError("Cumulative times must be an array - got "+typeof t+" instead");0===t.length?u("Array of cumulative times must not be empty"):0!==t[0]?u("Array of cumulative times must have zero as its first item"):1===t.length&&u("Array of cumulative times must contain more than just a single zero");for(var e=[],s=0;s+1<t.length;s+=1)e.push(n(t[s+1],t[s]));return e}function m(t,e,s,n,r){typeof t!=i&&u("Result order must be a number, got "+typeof t+" '"+t+"' instead"),typeof e!=i&&null!==e&&u("Start time must be a number, got "+typeof e+" '"+e+"' instead"),this.order=t,this.startTime=e,this.owner=r,this.isOKDespiteMissingTimes=!1,this.isNonCompetitive=!1,this.isNonStarter=!1,this.isNonFinisher=!1,this.isDisqualified=!1,this.isOverMaxTime=!1,this.originalSplitTimes=s,this.originalCumTimes=n,this.splitTimes=null,this.cumTimes=null,this.splitRanks=null,this.cumRanks=null,this.timeLosses=null,this.className=null,this.offsets=null,this.totalTime=null===n||-1<n.indexOf(null)?null:n[n.length-1]}function h(t,e,s){for(var n=[0],r=0;r<t.length;r+=1)for(var i=s(t[r]),o=1;o<i.length;o+=1)n.push(l(e[r],i[o]));return n}SplitsBrowser.Model.compareResults=function(t,e){return t.isDisqualified!==e.isDisqualified?t.isDisqualified?1:-1:t.totalTime===e.totalTime?t.order-e.order:null===t.totalTime?null===e.totalTime?0:1:null===e.totalTime?-1:t.totalTime-e.totalTime},m.prototype.setOKDespiteMissingTimes=function(){this.isOKDespiteMissingTimes=!0,null!==this.originalCumTimes&&(this.totalTime=this.originalCumTimes[this.originalCumTimes.length-1])},m.prototype.setNonCompetitive=function(){this.isNonCompetitive=!0},m.prototype.setNonStarter=function(){this.isNonStarter=!0},m.prototype.setNonFinisher=function(){this.isNonFinisher=!0},m.prototype.disqualify=function(){this.isDisqualified=!0},m.prototype.setOverMaxTime=function(){this.isOverMaxTime=!0},m.prototype.setClassName=function(t){this.className=t},m.prototype.setOffsets=function(t){this.offsets=t},m.fromOriginalCumTimes=function(t,e,s,n){return new m(t,e,a(s),s,n)},m.fromCumTimes=function(t,e,s,n){n=m.fromOriginalCumTimes(t,e,s,n);return n.splitTimes=n.originalSplitTimes,n.cumTimes=n.originalCumTimes,n},m.prototype.setRepairedCumulativeTimes=function(t){this.cumTimes=t,this.splitTimes=a(t)},m.prototype.completed=function(){return null!==this.totalTime&&!this.isDisqualified&&!this.isOverMaxTime},m.prototype.hasAnyTimes=function(){return this.originalCumTimes.slice(1).some(t)},m.prototype.getSplitTimeTo=function(t){return 0===t?0:this.splitTimes[t-1]},m.prototype.getOriginalSplitTimeTo=function(t){return this.isNonStarter?null:0===t?0:this.originalSplitTimes[t-1]},m.prototype.isSplitTimeDubious=function(t){return 0<t&&this.originalSplitTimes[t-1]!==this.splitTimes[t-1]},m.prototype.getCumulativeTimeTo=function(t){return this.cumTimes[t]},m.prototype.getOriginalCumulativeTimeTo=function(t){return this.isNonStarter?null:this.originalCumTimes[t]},m.prototype.isCumulativeTimeDubious=function(t){return this.originalCumTimes[t]!==this.cumTimes[t]},m.prototype.getSplitRankTo=function(t){return null===this.splitRanks?null:this.splitRanks[t]},m.prototype.getCumulativeRankTo=function(t){return null===this.cumRanks?null:this.cumRanks[t]},m.prototype.getTimeLossAt=function(t){return 0===t||null===this.timeLosses?null:this.timeLosses[t-1]},m.prototype.getAllCumulativeTimes=function(){return this.cumTimes},m.prototype.getAllOriginalCumulativeTimes=function(){return this.originalCumTimes},m.prototype.getAllSplitTimes=function(){return this.splitTimes},m.prototype.lacksStartTime=function(){return null===this.startTime&&this.splitTimes.some(t)},m.prototype.setSplitAndCumulativeRanks=function(t,e){null===t[0]&&null===e[0]||u("Split and cumulative ranks arrays must both start with null"),this.splitRanks=t,this.cumRanks=e},m.prototype.getCumTimesAdjustedToReference=function(s){return s.length!==this.cumTimes.length?u("Cannot adjust cumulative times because the numbers of times are different ("+this.cumTimes.length+" and "+s.length+")"):-1<s.indexOf(null)&&u("Cannot adjust cumulative times because a null value is in the reference data"),this.cumTimes.map(function(t,e){return n(t,s[e])})},m.prototype.getCumTimesAdjustedToReferenceWithStartAdded=function(t){var t=this.getCumTimesAdjustedToReference(t),e=this.startTime;return t.map(function(t){return l(t,e)})},m.prototype.getSplitPercentsBehindReferenceCumTimes=function(n){n.length!==this.cumTimes.length?u("Cannot determine percentages-behind because the numbers of times are different ("+this.cumTimes.length+" and "+n.length+")"):-1<n.indexOf(null)&&u("Cannot determine percentages-behind because a null value is in the reference data");var r=[0];return this.splitTimes.forEach(function(t,e){var s;null!==t&&0<(s=n[e+1]-n[e])?r.push(100*(t-s)/s):r.push(null)}),r},m.prototype.determineTimeLosses=function(s){var t,e,n;this.completed()&&(s.length!==this.splitTimes.length?u("Cannot determine time loss with "+this.splitTimes.length+" split times using "+s.length+" fastest splits"):s.some(r)&&u("Cannot determine time loss when there is a NaN value in the fastest splits"),s.some(function(t){return 0===t})||this.isOKDespiteMissingTimes||this.splitTimes.some(r)?this.timeLosses=this.splitTimes.map(function(){return NaN}):((t=this.splitTimes.map(function(t,e){return t/s[e]})).sort(d3.ascending),n=t.length%2==1?t[(t.length-1)/2]:(t[(e=t.length/2)-1]+t[e])/2,this.timeLosses=this.splitTimes.map(function(t,e){return Math.round(t-s[e]*n)})))},m.prototype.crosses=function(t,e){t.cumTimes.length!==this.cumTimes.length&&u("Two results with different numbers of controls cannot cross");for(var s,n,r,i=!1,o=!1,l=null===e||null===this.offsets?(s=0,this.cumTimes.length):(s=this.offsets[e],e+1===this.offsets.length?this.cumTimes.length:this.offsets[e+1]+1),a=s;a<l;a+=1){null!==this.cumTimes[a]&&null!==t.cumTimes[a]&&((n=this.startTime+this.cumTimes[a])<(r=t.startTime+t.cumTimes[a])?i=!0:r<n&&(o=!0))}return i&&o},m.prototype.isTimeOmitted=function(t){return r(t)||this.isOKDespiteMissingTimes&&null===t},m.prototype.getIndexesAroundOmittedTimes=function(t){for(var e=[],s=1;s+1<t.length;)if(this.isTimeOmitted(t[s])){for(var n=s;n+1<t.length&&this.isTimeOmitted(t[n+1]);)n+=1;n+1<t.length&&null!==t[s-1]&&null!==t[n+1]&&e.push({start:s-1,end:n+1}),s=n+1}else s+=1;return e},m.prototype.getControlIndexesAroundOmittedCumulativeTimes=function(){return this.getIndexesAroundOmittedTimes(this.cumTimes)},m.prototype.getControlIndexesAroundOmittedSplitTimes=function(){return this.getIndexesAroundOmittedTimes([0].concat(this.splitTimes))},m.prototype.getOwnerNameForLeg=function(t){return(e(this.owner,"members")&&null!==t?this.owner.members[t]:this.owner).name},m.prototype.determineAggregateStatus=function(t){if(t.some(function(t){return t.isDisqualified}))this.isDisqualified=!0;else if(t.every(function(t){return t.isNonStarter}))this.isNonStarter=!0;else{for(var e=-1;e+1<t.length;e+=1){var s=t[e+1];if(s.isNonStarter||s.isNonFinisher||!s.completed())break}for(var n=t.length;0<n;--n){if(!t[n-1].isNonStarter)break}if(e<t.length-1){if(e+1===n)return void(this.isNonFinisher=!0);if(e+2===n&&t[e+1].isNonFinisher)return void(this.isNonFinisher=!0)}t.some(function(t){return t.isOverMaxTime})?this.isOverMaxTime=!0:(t.some(function(t){return t.isNonCompetitive})&&(this.isNonCompetitive=!0),t.some(function(t){return t.isOKDespiteMissingTimes})&&this.setOKDespiteMissingTimes())}},m.createTeamResult=function(t,e,s){e.length<2&&u("Team results can only be created from at least two other results");var n,r,i=(r=[0],(n=e).forEach(function(t,e){var s=r[r.length-1],e=e+1<n.length?n[e+1]:null,e=null!==s&&null!==t.totalTime?s+t.totalTime:null!==e&&null!==e.startTime&&null!==n[0].startTime?e.startTime-n[0].startTime:null;r.push(e)}),r.slice(0,r.length-1));s.setMembers(e.map(function(t){return t.owner}));var o=h(e,i,function(t){return t.originalCumTimes}),s=m.fromOriginalCumTimes(t,e[0].startTime,o,s);return e.every(function(t){return null!==t.cumTimes})&&(s.cumTimes=h(e,i,function(t){return t.cumTimes}),s.splitTimes=a(s.cumTimes)),s.determineAggregateStatus(e),s},SplitsBrowser.Model.Result=m}(),function(){"use strict";function t(t,e){this.name=t,this.club=e,this.yearOfBirth=null,this.gender=null}t.prototype.setYearOfBirth=function(t){this.yearOfBirth=t},t.prototype.setGender=function(t){this.gender=t},SplitsBrowser.Model.Competitor=t}(),function(){"use strict";function t(t,e){this.name=t,this.club=e}t.prototype.setMembers=function(t){this.members=t},SplitsBrowser.Model.Team=t}(),function(){"use strict";var i=SplitsBrowser.isNotNullNorNaN,t=SplitsBrowser.throwInvalidData;function e(e,t,s){this.name=e,this.numControls=t,this.numbersOfControls=null,this.offsets=null,this.results=s,this.course=null,this.hasDubiousData=!1,this.isTeamClass=!1,this.results.forEach(function(t){t.setClassName(e)})}e.prototype.recordHasDubiousData=function(){this.hasDubiousData=!0},e.prototype.setIsTeamClass=function(t){this.isTeamClass=!0,this.numbersOfControls=t,this.offsets=[0];for(var e=1;e<t.length;e+=1)this.offsets.push(this.offsets[e-1]+t[e-1]+1);this.results.forEach(function(t){t.setOffsets(this.offsets)},this)},e.prototype.determineTimeLosses=function(){var e=d3.range(1,this.numControls+2).map(function(t){t=this.getFastestSplitTo(t);return null===t?null:t.split},this);this.results.forEach(function(t){t.determineTimeLosses(e)})},e.prototype.isEmpty=function(){return 0===this.results.length},e.prototype.setCourse=function(t){this.course=t},e.prototype.getFastestSplitTo=function(s){("number"!=typeof s||s<1||s>this.numControls+1)&&t("Cannot return splits to leg '"+s+"' in a course with "+this.numControls+" control(s)");var n=null,r=null;return this.results.forEach(function(t){var e=t.getSplitTimeTo(s);i(e)&&(null===n||e<n)&&(n=e,r=t)}),null===n?null:{split:n,name:r.owner.name}},e.prototype.getResultsAtControlInTimeRange=function(s,n,r){("number"!=typeof s||isNaN(s)||s<0||s>this.numControls+1)&&t("Control number must be a number between 0 and "+this.numControls+" inclusive");var i=[];return this.results.forEach(function(t){var e=t.getCumulativeTimeTo(s);null!==e&&null!==t.startTime&&(e=e+t.startTime,n<=e&&e<=r&&i.push({name:t.owner.name,time:e}))}),i},SplitsBrowser.Model.CourseClass=e}(),function(){"use strict";var i=SplitsBrowser.throwInvalidData;function t(t,e,s,n,r){this.name=t,this.classes=e,this.length=s,this.climb=n,this.controls=r}var l=t.START="__START__",a=t.FINISH="__FINISH__";t.prototype.getOtherClasses=function(e){var t=this.classes.filter(function(t){return t!==e});if(t.length!==this.classes.length)return t;i("Course.getOtherClasses: given class is not in this course")},t.prototype.getNumClasses=function(){return this.classes.length},t.prototype.hasControls=function(){return null!==this.controls},t.prototype.getControlCode=function(t){return 0===t?l:1<=t&&t<=this.controls.length?this.controls[t-1]:t===this.controls.length+1?a:void i("Cannot get control code of control "+t+" because it is out of range")},t.prototype.usesLeg=function(t,e){return 0<=this.getLegNumber(t,e)},t.prototype.getLegNumber=function(t,e){if(null===this.controls)return-1;if(t===l&&e===a)return 0===this.controls.length?1:-1;if(t===l)return 0<this.controls.length&&this.controls[0]===e?1:-1;if(e===a)return 0<this.controls.length&&this.controls[this.controls.length-1]===t?this.controls.length+1:-1;for(var s=1;s<this.controls.length;s+=1)if(this.controls[s-1]===t&&this.controls[s]===e)return s+1;return-1},t.prototype.getFastestSplitsForLeg=function(t,e){null===this.legs&&i("Cannot determine fastest splits for a leg because leg information is not available");var s=this.getLegNumber(t,e);s<0&&i("Leg from "+((t===l?"start":t)+" to "+(e===a?"end":e))+" not found in course "+this.name);var n=s,r=[];return this.classes.forEach(function(t){var e=t.getFastestSplitTo(n);null!==e&&r.push({name:e.name,className:t.name,split:e.split})}),r},t.prototype.getResultsAtControlInTimeRange=function(t,e,s){if(null===this.controls)return[];if(t===l)return this.getResultsAtControlNumInTimeRange(0,e,s);if(t===a)return this.getResultsAtControlNumInTimeRange(this.controls.length+1,e,s);for(var n=-1,r=[],i=function(t){r.push(t)};;){var o=this.controls.indexOf(t,n+1);if(o<0)return r;this.getResultsAtControlNumInTimeRange(o+1,e,s).forEach(i),n=o}},t.prototype.getResultsAtControlNumInTimeRange=function(t,s,n){var r=[];return this.classes.forEach(function(e){e.getResultsAtControlInTimeRange(t,s,n).forEach(function(t){r.push({name:t.name,time:t.time,className:e.name})})}),r},t.prototype.hasControl=function(t){return null!==this.controls&&-1<this.controls.indexOf(t)},t.prototype.getNextControls=function(t){if(null===this.controls)i("Course has no controls");else if(t===a)i("Cannot fetch next control after the finish");else{if(t===l)return[0===this.controls.length?a:this.controls[0]];for(var e=-1,s=[];;){var n=this.controls.indexOf(t,e+1);if(-1===n)break;n===this.controls.length-1?s.push(a):s.push(this.controls[n+1]),e=n}if(0!==s.length)return s;i("Control '"+t+"' not found on course "+this.name)}},SplitsBrowser.Model.Course=t}(),function(){"use strict";var s=SplitsBrowser.Model.Course;function t(t,e,s){this.classes=t,this.courses=e,this.warnings=s}t.prototype.determineTimeLosses=function(){this.classes.forEach(function(t){t.determineTimeLosses()})},t.prototype.needsRepair=function(){return this.classes.some(function(t){return t.results.some(function(t){return null===t.getAllCumulativeTimes()})})},t.prototype.getFastestSplitsForLeg=function(e,s){var n=[];return this.courses.forEach(function(t){t.usesLeg(e,s)&&(n=n.concat(t.getFastestSplitsForLeg(e,s)))}),n.sort(function(t,e){return d3.ascending(t.split,e.split)}),n},t.prototype.getResultsAtControlInTimeRange=function(e,s,n){var r=[];return this.courses.forEach(function(t){t.getResultsAtControlInTimeRange(e,s,n).forEach(function(t){r.push(t)})}),r.sort(function(t,e){return d3.ascending(t.time,e.time)}),r},t.prototype.getNextControlsAfter=function(e){var t=this.courses;return e!==s.START&&(t=t.filter(function(t){return t.hasControl(e)})),t.map(function(t){return{course:t,nextControls:t.getNextControls(e)}})},SplitsBrowser.Model.Event=t}(),function(){"use strict";var o=SplitsBrowser.isTrue,l=SplitsBrowser.isNotNull,a=SplitsBrowser.throwInvalidData,u=SplitsBrowser.throwWrongFileFormat,i=SplitsBrowser.normaliseLineEndings,m=SplitsBrowser.parseTime,h=SplitsBrowser.Model.Result.fromCumTimes,c=SplitsBrowser.Model.Competitor,p=SplitsBrowser.Model.compareResults,f=SplitsBrowser.Model.CourseClass,d=SplitsBrowser.Model.Course,g=SplitsBrowser.Model.Event;function C(t,s){var e=t.split(/\r?\n/).filter(o);0===e.length&&a("parseCourseClass got an empty list of lines");var n=e.shift().split(",");if(2===n.length){var r=n.shift(),t=n.shift(),i=parseInt(t,10);if(isNaN(i))a("Could not read control count: '"+t+"'");else{if(!(i<0&&0<e.length)){e=e.map(function(t,e){return function(t,e,s,n,r){for(var i=e.split(",");i.length>s+5&&i[3].match(/[^0-9.,:-]/);)i[2]+=","+i[3],i.splice(3,1);var o=i.length,l=((i.shift()||"")+" "+(i.shift()||"")).trim()||"<name unknown>";if(o!==s+5)return o=(o-=s+5)<0?-o+" too few":o+" too many",r.push("Competitor '"+l+"' appears to have the wrong number of split times - "+o+" (row "+(t+1)+" of class '"+n+"')"),null;var o=i.shift(),n=i.shift();0===(e=m(n))?e=null:n.match(/^\d+:\d\d:\d\d$/)||(e*=60);var a=[0],u=0;return i.map(function(t){t=m(t);null!==t&&0<t?(u+=t,a.push(u)):a.push(null)}),o=h(t+1,e,a,new c(l,o)),0===u&&o.setNonStarter(),o}(e,t,i,r,s)}).filter(l);return e.sort(p),new f(r,i,e)}a("Expected a non-negative control count, got "+i+" instead")}}else u("Expected first line to have two parts (class name and number of controls), got "+n.length+" part(s) instead")}SplitsBrowser.Input.CSV={parseEventData:function(t){/<html/i.test(t)&&u("Cannot parse this file as CSV as it appears to be HTML");var t=(t=(t=i(t)).replace(/,+\n/g,"\n").replace(/,+$/,"")).split(/\n\n/).map(function(t){return t.trim()}).filter(o),e=[],s=t.map(function(t){return C(t,e)});0===(s=s.filter(function(t){return!t.isEmpty()})).length&&a("No competitor data was found");for(var n=s.map(function(t){return new d(t.name,[t],null,null,null)}),r=0;r<s.length;r+=1)s[r].setCourse(n[r]);return new g(s,n,e)}}}(),function(){"use strict";var n=SplitsBrowser.throwInvalidData,r=SplitsBrowser.throwWrongFileFormat,u=SplitsBrowser.isNaNStrict,m=SplitsBrowser.hasProperty,i=SplitsBrowser.parseCourseLength,o=SplitsBrowser.parseCourseClimb,e=SplitsBrowser.normaliseLineEndings,h=SplitsBrowser.parseTime,c=SplitsBrowser.Model.Result.fromOriginalCumTimes,p=SplitsBrowser.Model.Competitor,s=SplitsBrowser.Model.CourseClass,C=SplitsBrowser.Model.Course,l=SplitsBrowser.Model.Event,a=[";",",","\t","\\"],f={};[44,46,60].forEach(function(t){f[t]={course:t-7,distance:t-6,climb:t-5,controlCount:t-4,placing:t-3,startPunch:t-2,finish:t-1,control1:t}}),[44,46].forEach(function(t){f[t].nonCompetitive=t-38,f[t].startTime=t-37,f[t].time=t-35,f[t].classifier=t-34,f[t].club=t-31,f[t].className=t-28}),f[44].combinedName=3,f[44].yearOfBirth=4,f[46].forename=4,f[46].surname=3,f[46].yearOfBirth=5,f[46].gender=6,f[60].forename=6,f[60].surname=5,f[60].yearOfBirth=7,f[60].gender=8,f[60].combinedName=3,f[60].nonCompetitive=10,f[60].startTime=11,f[60].time=13,f[60].classifier=14,f[60].club=20,f[60].className=26,f[60].classNameFallback=f[60].course,f[60].clubFallback=18;function d(t){return'"'===t[0]&&'"'===t[t.length-1]&&(t=t.substring(1,t.length-1).replace(/""/g,'"').trim()),t}function g(t){this.data=e(t),this.classes=d3.map(),this.courseDetails=d3.map(),this.classCoursePairs=[],this.columnIndexes=null,this.warnings=[]}g.prototype.identifyDelimiter=function(){this.lines.length<=1&&r("No data found to read");for(var t=this.lines[1],e=0;e<a.length;e+=1){var s=a[e];if(37<t.split(s).length)return s}r("Data appears not to be in the OE CSV format")},g.prototype.identifyFormatVariation=function(t){var e,s=this.lines[1].split(t),n=/^[A-Za-z0-9]+$/;for(e in f){if(m(f,e))if((e=parseInt(e,10))<s.length&&n.test(s[e])&&(""===s[e-2].trim()||null!==h(s[e-2]))&&(""===s[e-1].trim()||null!==h(s[e-1])))if(""!==s[f[e].controlCount].trim())return void(this.columnIndexes=f[e])}r("Did not find control 1 at any of the supported indexes")},g.prototype.getClassName=function(t){var e=t[this.columnIndexes.className];return""===e&&m(this.columnIndexes,"classNameFallback")&&(e=t[this.columnIndexes.classNameFallback]),e},g.prototype.getStartTime=function(t){var e=t[this.columnIndexes.startPunch];return""===e&&(e=t[this.columnIndexes.startTime]),h(e)},g.prototype.getNumControls=function(t,e){var s,n=this.getClassName(t);if(""===n.trim())return s=this.getName(t)||"<name unknown>",this.warnings.push("Could not find a class for competitor '"+s+"' (line "+e+")"),null;if(this.classes.has(n))return this.classes.get(n).numControls;n=parseInt(t[this.columnIndexes.controlCount],10);return isFinite(n)?n:(s=this.getName(t)||"<name unknown>",this.warnings.push("Could not read the control count '"+t[this.columnIndexes.controlCount]+"' for competitor '"+s+"' from line "+e),null)},g.prototype.readCumulativeTimes=function(t,e,s){for(var n=[0],r=0;r<s;r+=1){var i=this.columnIndexes.control1+1+2*r,i=i<t.length?t[i]:null,i=null===i?null:h(i);n.push(i)}var o,l,a=h(t[this.columnIndexes.time]);return null===a&&(o=this.getStartTime(t),l=h(t[this.columnIndexes.finish]),null!==o&&null!==l&&(a=l-o)),n.push(a),n},g.prototype.createClassIfNecessary=function(t,e){t=this.getClassName(t);this.classes.has(t)||this.classes.set(t,{numControls:e,results:[]})},g.prototype.createCourseIfNecessary=function(e,t){var s=e[this.columnIndexes.course];this.courseDetails.has(s)||(t=d3.range(0,t).map(function(t){return e[this.columnIndexes.control1+2*t]},this),this.courseDetails.set(s,{length:i(e[this.columnIndexes.distance]),climb:o(e[this.columnIndexes.climb]),controls:t}))},g.prototype.createClassCoursePairIfNecessary=function(t){var e=this.getClassName(t),s=t[this.columnIndexes.course];this.classCoursePairs.some(function(t){return t[0]===e&&t[1]===s})||this.classCoursePairs.push([e,s])},g.prototype.getName=function(t){var e="";return m(this.columnIndexes,"forename")&&m(this.columnIndexes,"surname")&&(e=(t[this.columnIndexes.forename]+" "+t[this.columnIndexes.surname]).trim()),""===e&&m(this.columnIndexes,"combinedName")&&(e=t[this.columnIndexes.combinedName]),e},g.prototype.addCompetitor=function(t,e){var s=this.getClassName(t),n=t[this.columnIndexes.placing],r=t[this.columnIndexes.club];""===r&&m(this.columnIndexes,"clubFallback")&&(r=t[this.columnIndexes.clubFallback]);var i=this.getStartTime(t),o=this.getName(t),l=""!==n&&u(parseInt(n,10));l&&o.substring(o.length-n.length)===n&&(o=o.substring(0,o.length-n.length).trim());var a,n=this.classes.get(s).results.length+1,o=new p(o,r),r=t[this.columnIndexes.yearOfBirth];""!==r&&(a=parseInt(r,10),u(a)||o.setYearOfBirth(a)),m(this.columnIndexes,"gender")&&("M"!==(a=t[this.columnIndexes.gender])&&"F"!==a||o.setGender(a));o=c(n,i,e,o);("1"===t[this.columnIndexes.nonCompetitive]||l)&&o.completed()&&o.setNonCompetitive();t=t[this.columnIndexes.classifier];""!==t?"0"===t&&0<=e.indexOf(null)&&null!==e[e.length-1]?o.setOKDespiteMissingTimes():"1"===t?o.setNonStarter():"2"===t?o.setNonFinisher():"4"===t?o.disqualify():"5"===t&&o.setOverMaxTime():o.hasAnyTimes()||o.setNonStarter(),this.classes.get(s).results.push(o)},g.prototype.readLine=function(t,e,s){""!==t.trim()&&((t=t.split(s).map(function(t){return t.trim()}).map(d)).length<37&&n("Too few items on line "+e+" of the input file: expected at least 37, got "+t.length),null!==(s=this.getNumControls(t,e))&&(e=this.readCumulativeTimes(t,e,s),this.createClassIfNecessary(t,s),this.createCourseIfNecessary(t,s),this.createClassCoursePairIfNecessary(t),this.addCompetitor(t,e)))},g.prototype.getMapsBetweenClassesAndCourses=function(){var s=d3.map(),n=d3.map();return this.classCoursePairs.forEach(function(t){var e=t[0],t=t[1];s.has(e)?s.get(e).push(t):s.set(e,[t]),n.has(t)?n.get(t).push(e):n.set(t,[e])}),{classesToCourses:s,coursesToClasses:n}},g.prototype.createClasses=function(){var t=this.classes.keys();return t.sort(),t.map(function(t){var e=this.classes.get(t);return new s(t,e.numControls,e.results)},this)},g.prototype.createCourseFromLinkedClassesAndCourses=function(t,e,s,n){for(var r,i,o=[t],l=[],a=[],u=[];0<o.length||0<l.length;){for(;0<o.length;){r=o.shift();for(var m=e.coursesToClasses.get(r),h=0;h<m.length;h+=1)i=m[h],l.indexOf(i)<0&&u.indexOf(i)<0&&l.push(i);a.push(r)}for(;0<l.length;){i=l.shift();for(var c=e.classesToCourses.get(i),p=0;p<c.length;p+=1)r=c[p],o.indexOf(r)<0&&a.indexOf(r)<0&&o.push(r);u.push(i)}}a.forEach(function(t){s.add(t)});var f=u.map(function(t){return n.get(t)}),d=this.courseDetails.get(t),g=new C(t,f,d.length,d.climb,d.controls);return f.forEach(function(t){t.setCourse(g)}),g},g.prototype.determineCourses=function(t){var e=this.getMapsBetweenClassesAndCourses(),s=d3.set(),n=d3.map();t.forEach(function(t){n.set(t.name,t)});var r=[];return e.coursesToClasses.keys().forEach(function(t){s.has(t)||(t=this.createCourseFromLinkedClassesAndCourses(t,e,s,n),r.push(t))},this),r},g.prototype.parseEventData=function(){this.warnings=[],this.lines=this.data.split(/\n/);var s=this.identifyDelimiter();this.identifyFormatVariation(s),this.lines.shift(),this.lines.forEach(function(t,e){this.readLine(t,e+1,s)},this);var t=this.createClasses();0===t.length&&0<this.warnings.length&&r("This file may have looked vaguely like an OE CSV file but no data could be read out of it");var e=this.determineCourses(t);return new l(t,e,this.warnings)},SplitsBrowser.Input.OE={},SplitsBrowser.Input.OE.parseEventData=function(t){return new g(t).parseEventData()}}(),function(){"use strict";var a=SplitsBrowser.isNotNull,m=SplitsBrowser.throwInvalidData,n=SplitsBrowser.throwWrongFileFormat,e=SplitsBrowser.parseCourseLength,r=SplitsBrowser.normaliseLineEndings,h=SplitsBrowser.parseTime,s=SplitsBrowser.Model.Result.fromOriginalCumTimes,i=SplitsBrowser.Model.Competitor,u=SplitsBrowser.Model.CourseClass,c=SplitsBrowser.Model.Course,p=SplitsBrowser.Model.Event,o=/<[^>]+>/g,l=/([0-9.,]+)\s*(?:Km|km)/,f=/(\d+)\s*(?:Cm|Hm|hm|m)/;function d(t){return null!==t&&""!==t}function g(t){return""!==(t=t.trim())&&isFinite(t)}function C(t){return t.split(/\s+/g).filter(d)}function v(t){return t.replace(o,"")}function T(t,e){for(var s,n=[];null!==(s=t.exec(e));)n.push(v(s[1]));return n}function S(t){return T(/<font[^>]*>(.*?)<\/font>/g,t)}function w(t){return T(/<td[^>]*>(.*?)<\/td>/g,t).map(function(t){return t.trim()})}function y(t){return w(t).filter(function(t){return""!==t})}function N(t){t=l.exec(t);return null===t?null:e(t[1])}function b(t){t=f.exec(t);return null===t?null:parseInt(t[1],10)}function O(t){for(var e=[],s=0;s<t.length;s+=1){var n=t[s],r=n.indexOf("(");-1<r&&")"===n[n.length-1]?(r=n.substring(r+1,n.length-1),e.push(r)):s+1===t.length?e.push(null):m("Unrecognised control header label: '"+n+"'")}return e}function x(t,e){for(;0<e.length&&"*"===e[e.length-1][0];)e.splice(e.length-1,1),t.splice(t.length-1,1)}function I(t,e,s,n,r,i){this.name=t,this.club=e,this.className=s,this.totalTime=n,this.cumTimes=r,this.competitive=i}I.prototype.isContinuation=function(){return""===this.name&&""===this.club&&null===this.className&&""===this.totalTime&&!this.competitive},I.prototype.append=function(t){if(!t.isContinuation())throw new Error("Can only append a continuation CompetitorParseRecord");this.cumTimes=this.cumTimes.concat(t.cumTimes)},I.prototype.toResult=function(t){var e=[0].concat(this.cumTimes),e=s(t,null,e,new i(this.name,this.club));return e.completed()&&!this.competitive&&e.setNonCompetitive(),e.hasAnyTimes()||e.setNonStarter(),e};function t(){this.precedingColumnCount=null}t.prototype.isTextOfThisFormat=function(t){return 0<=t.indexOf("<pre>")&&0<=t.indexOf("<font")},t.prototype.preprocess=function(t){var e=t.indexOf("<pre>");if(-1===e)throw new Error("Cannot find opening pre tag");var s=t.indexOf("\n",e),e=(t=(t=t.substring(s+1)).replace(/\n{2,}/g,"\n")).lastIndexOf("</pre>");return-1===e&&m("Found opening <pre> but no closing </pre>"),s=t.lastIndexOf("\n",e),(t=t.substring(0,s)).trim()},t.prototype.canIgnoreThisLine=function(t){return""===t},t.prototype.isCourseHeaderLine=function(t){return 2===S(t).length},t.prototype.parseCourseHeaderLine=function(t){var e=S(t);if(2!==e.length)throw new Error("Course header line should have two parts");var s=e[0],t=e[1],e=s.indexOf("("),e=-1<e?s.substring(0,e):s,s=N(t),t=b(t);return{name:e.trim(),distance:s,climb:t}},t.prototype.parseControlsLine=function(t){var e=t.lastIndexOf("</font>");return O(C((-1===e?t:t.substring(e+"</font>".length)).trim()))},t.prototype.readCompetitorSplitDataLine=function(t){for(var e=0;e<this.precedingColumnCount;e+=1){var s=t.indexOf("</font>");t=t.substring(s+"</font>".length)}return C(v(t))},t.prototype.parseCompetitor=function(t,e){var s=S(t),n=S(e);null===this.precedingColumnCount&&(l=s[1].trim(),this.precedingColumnCount=l.match(/^\d*$/)?4:3);var r=g(s[0]),i=s[this.precedingColumnCount-2].trim(),o=s[this.precedingColumnCount-1].trim(),l=n[this.precedingColumnCount-2].trim(),s=this.readCompetitorSplitDataLine(t),n=this.readCompetitorSplitDataLine(e);x(s=s.map(h),n);e=null;if(null!==i&&""!==i){for(var a=-1,u=0;u<this.precedingColumnCount;u+=1)a=t.indexOf("</font>",a+1);n=C(t.substring(0,a+"</font>".length).replace(/<font[^>]*>(.*?)<\/font>/g,""));0<n.length&&(e=n[0])}return new I(i,l,e,o,s,r)};function B(){this.timesOffset=null}B.prototype.isTextOfThisFormat=function(t){for(var e=-1,s=0;s<5;s+=1)if(-1===(e=t.indexOf("<table",e+1)))return!1;return!0},B.prototype.preprocess=function(t){var e=t.indexOf("</table>");-1===e&&m("Could not find any closing </table> tags");var s=(t=t.substring(e+"</table>".length)).indexOf("</div>"),e=t.indexOf("<table");return-1<s&&s<e&&(t=t.substring(s+"</div>".length)),(t=(t=(t=(t=(t=(t=t.replace(/>\n+</g,"><").replace(/><tr>/g,">\n<tr>").replace(/<\/tr></g,"</tr>\n<").replace(/><table/g,">\n<table").replace(/<\/table></g,"</table>\n<")).replace(/<\/col[^>]*>/g,"")).replace(/<tr[^>]*><td[^>]*>(?:<nobr>)?&nbsp;?(?:<\/nobr>)?<\/td><\/tr>/g,"")).replace(/<a id="[^"]*"><\/a>/g,"")).replace(/<div id="navigation">[\s\S]*?<\/div>/g,"")).replace("</body></html>","")).trim()},B.prototype.canIgnoreThisLine=function(t){if(-1<t.indexOf("<th>")){var e=T(/<th[^>]*>(.*?)<\/th>/g,t).filter(function(t){return""!==t});return this.timesOffset=e.length,!0}return""===t||-1<t.indexOf("<table")||-1<t.indexOf("</table>")},B.prototype.isCourseHeaderLine=function(t){return-1<t.indexOf('<td id="header"')},B.prototype.parseCourseHeaderLine=function(t){var e=y(t);0===e.length&&m("No parts found in course header line");var s=e[0],t=s.indexOf("(");-1<t&&(s=s.substring(0,t)),s=s.trim();for(var n=null,r=null,i=1;i<e.length;i+=1)null===n&&(n=N(e[i])),null===r&&(r=b(e[i]));return{name:s,distance:n,climb:r}},B.prototype.parseControlsLine=function(t){return O(y(t))},B.prototype.readCompetitorSplitDataLine=function(t){for(var e=w(t),t=this.timesOffset,s=e.length;0<s&&""===e[s-1];)--s;return e.slice(t,s).filter(d)},B.prototype.parseCompetitor=function(t,e){var s=w(t),n=w(e),r=g(s[0]),i=3===this.timesOffset?1:2,o=s[i],l=s[this.timesOffset-1],n=n[i],i=5===this.timesOffset&&""!==o?s[3]:null,s=this.readCompetitorSplitDataLine(t),t=this.readCompetitorSplitDataLine(e);x(s=s.map(h),t);e=s.filter(a).length;return e!==t.length&&m("Cumulative and split times do not have the same length: "+e+" cumulative times, "+t.length+" split times"),new I(o,n,i,l,s,r)};function D(){this.usesClasses=!1}function M(t,e,s){this.name=t,this.distance=e,this.climb=s,this.controls=[],this.competitors=[]}function F(t){this.recognizer=t,this.courses=[],this.currentCourse=null,this.lines=null,this.linePos=-1,this.currentCompetitor=null}D.prototype.isTextOfThisFormat=function(t){var e=t.indexOf("<table");if(0<=e){e=t.indexOf("<table",e+1);if(0<=e)if(t.indexOf("<table",e+1)<0)return!0}return!1},D.prototype.preprocess=function(t){var e=t.indexOf("</table>");return-1===e&&m("Could not find any closing </table> tags"),0<=t.indexOf('<td colspan="25">')&&(this.usesClasses=!0),(t=(t=(t=(t=t.substring(e+"</table>".length)).replace(/<tr[^>]*><td colspan=[^>]*>&nbsp;<\/td><\/tr>/g,"")).replace(/\n{2,}/g,"\n")).replace("</body>","").replace("</html>","")).trim()},D.prototype.canIgnoreThisLine=function(t){return""===t||-1<t.indexOf("<table")||-1<t.indexOf(
"</table>")||-1<t.indexOf("<hr>")},D.prototype.isCourseHeaderLine=function(t){return-1<t.indexOf('<tr class="clubName"')},D.prototype.parseCourseHeaderLine=function(t){var e=y(t);0===e.length&&m("No parts found in course header line");var s,n,t=e[0],e=/^(.*?)\s+\((\d+)m,\s*(\d+)m\)$/.exec(t),e=null===e?(s=t,n=null):(s=e[1],n=parseInt(e[2],10)/1e3,parseInt(e[3],10));return{name:s.trim(),distance:n,climb:e}},D.prototype.parseControlsLine=function(t){return y(t).map(function(t){var e=t.indexOf("-");return-1===e?null:t.substring(e+1)})},D.prototype.readCompetitorSplitDataLine=function(t){for(var e=this.usesClasses?5:4,s=t.length;0<s&&""===t[s-1];)--s;for(var n=[],r=e;r<s;r+=2){var i=t[r];d(i)&&n.push(i)}return n},D.prototype.parseCompetitor=function(t,e){for(var s=w(t),n=w(e),r=g(s[0]),i=s[2],o=s[this.usesClasses?4:3],l=this.usesClasses&&""!==i?s[3]:null,a=n[2],u=this.usesClasses?5:4;u<s.length&&u<n.length;u+=2)""!==s[u]&&""===n[u]&&(n[u]="----");t=this.readCompetitorSplitDataLine(s),e=this.readCompetitorSplitDataLine(n);return x(t=t.map(h),e),t.length!==e.length&&m("Cumulative and split times do not have the same length: "+t.length+" cumulative times, "+e.length+" split times"),new I(i,a,l,o,t,r)},M.prototype.addControls=function(t){this.controls=this.controls.concat(t)},M.prototype.hasAllControls=function(){return 0<this.controls.length&&null===this.controls[this.controls.length-1]},M.prototype.addCompetitor=function(t){if(t.competitive||t.cumTimes.length!==this.controls.length-1||t.cumTimes.push(null),null===h(t.totalTime)&&0===t.cumTimes.length)for(;t.cumTimes.length<this.controls.length;)t.cumTimes.push(null);t.cumTimes.length===this.controls.length?this.competitors.push(t):m("Competitor '"+t.name+"' should have "+this.controls.length+" cumulative times, but has "+t.cumTimes.length+" times")},F.prototype.tryGetLine=function(){return this.linePos+1<this.lines.length?(this.linePos+=1,this.lines[this.linePos]):null},F.prototype.addCurrentCompetitorIfNecessary=function(){null!==this.currentCompetitor&&(this.currentCourse.addCompetitor(this.currentCompetitor),this.currentCompetitor=null)},F.prototype.addCurrentCompetitorAndCourseIfNecessary=function(){this.addCurrentCompetitorIfNecessary(),null!==this.currentCourse&&this.courses.push(this.currentCourse)},F.prototype.readCompetitorLines=function(t){var e=this.tryGetLine();null===e&&m("Hit end of input data unexpectedly while parsing competitor: first line was '"+t+"'");e=this.recognizer.parseCompetitor(t,e);e.isContinuation()?null===this.currentCompetitor?m("First row of competitor data has no name nor time"):this.currentCompetitor.append(e):(this.addCurrentCompetitorIfNecessary(),this.currentCompetitor=e)},F.prototype.areClassesUniqueWithinCourses=function(){for(var t=d3.map(),e=0;e<this.courses.length;e+=1)for(var s=this.courses[e],n=0;n<s.competitors.length;n+=1){var r=s.competitors[n];if(t.has(r.className)){if(t.get(r.className)!==s.name)return!1}else t.set(r.className,s.name)}return!0},F.prototype.createOverallEventObject=function(){var s=this.areClassesUniqueWithinCourses(),t=[],o=[],l=this.courses.every(function(t){return t.competitors.every(function(t){return a(t.className)})});return this.courses.forEach(function(n){var r=d3.map();n.competitors.forEach(function(t){var e=l&&s?t.className:n.name;r.has(e)?r.get(e).push(t):r.set(e,[t])});var i=[];r.keys().forEach(function(t){var e=n.controls.length-1,s=r.get(t).map(function(t,e){return t.toResult(e+1)}),s=new u(t,e,s);i.push(s),o.push(s)},this);var e=new c(n.name,i,n.distance,n.climb,n.controls.slice(0,n.controls.length-1));t.push(e),i.forEach(function(t){t.setCourse(e)})},this),new p(o,t,[])},F.prototype.parse=function(t){for(this.lines=t.split("\n");;){var e,s=this.tryGetLine();if(null===s)break;this.recognizer.canIgnoreThisLine(s)||(this.recognizer.isCourseHeaderLine(s)?(this.addCurrentCompetitorAndCourseIfNecessary(),e=this.recognizer.parseCourseHeaderLine(s),this.currentCourse=new M(e.name,e.distance,e.climb)):null===this.currentCourse||(this.currentCourse.hasAllControls()?this.readCompetitorLines(s):(s=this.recognizer.parseControlsLine(s),this.currentCourse.addControls(s))))}return this.addCurrentCompetitorAndCourseIfNecessary(),0===this.courses.length&&m("No competitor data was found"),this.createOverallEventObject()};var L=[t,B,D];SplitsBrowser.Input.Html={},SplitsBrowser.Input.Html.parseEventData=function(t){t=r(t);for(var e=0;e<L.length;e+=1){var s=new L[e];if(s.isTextOfThisFormat(t))return t=s.preprocess(t),new F(s).parse(t)}n("No HTML recognizers recognised this as HTML they could parse")}}(),function(){"use strict";var n=SplitsBrowser.throwWrongFileFormat,r=SplitsBrowser.normaliseLineEndings,a=SplitsBrowser.parseTime,l=SplitsBrowser.parseCourseLength,u=SplitsBrowser.parseCourseClimb,m=SplitsBrowser.Model.Result.fromOriginalCumTimes,h=SplitsBrowser.Model.Competitor,o=SplitsBrowser.Model.CourseClass,c=SplitsBrowser.Model.Course,i=SplitsBrowser.Model.Event,e={controlsOffset:38,step:3,name:3,club:5,courseName:7,startTime:8,length:null,climb:null,placing:null,finishTime:null,allowMultipleCompetitorNames:!0},p=[",",";"],f=/^[A-Za-z0-9]+$/;function d(t){for(var e=t.length-1;0<=e&&""===t[e];)--e;t.splice(e+1,t.length-e-1)}function s(t){this.format=t,this.classes=d3.map(),this.delimiter=null,this.hasAnyStarters=!1,this.warnings=[],this.controlsTerminationOffset=null===t.finishTime?t.step:0}s.prototype.determineDelimiter=function(t){for(var e=0;e<p.length;e+=1){var s=p[e],n=t.split(s);if(d(n),n.length>this.format.controlsOffset)return s}return null},s.prototype.adjustLinePartsForMultipleCompetitors=function(t){if(this.format.allowMultipleCompetitorNames)for(;t.length>this.format.name+1&&t[this.format.name+1].match(/^\s\S/);)t[this.format.name]+=","+t[this.format.name+1],t.splice(this.format.name+1,1)},s.prototype.checkControlCodesAlphaNumeric=function(t){var e=t.split(this.delimiter);d(e),this.adjustLinePartsForMultipleCompetitors(e,this.format);for(var s=this.format.controlsOffset;s+this.controlsTerminationOffset<e.length;s+=this.format.step)f.test(e[s])||n("Data appears not to be in an alternative CSV format - data in cell "+s+" of the first row ('"+e[s]+"') is not an number")},s.prototype.addResultToCourse=function(t,e,s){if(this.classes.has(e)){var n=this.classes.get(e),r=t.getAllOriginalCumulativeTimes();r.length-1!==n.controls.length+1?this.warnings.push("Competitor '"+t.owner.name+"' has the wrong number of splits for course '"+e+"': expected "+(n.controls.length+1)+", actual "+(r.length-1)):n.results.push(t)}else{for(var i=[],o=this.format.controlsOffset;o+this.controlsTerminationOffset<s.length;o+=this.format.step)i.push(s[o]);r=null===this.format.length?null:l(s[this.format.length]),n=null===this.format.climb?null:u(s[this.format.climb]);this.classes.set(e,{length:r,climb:n,controls:i,results:[t]})}},s.prototype.readDataRow=function(t){var e=t.split(this.delimiter);if(d(e),this.adjustLinePartsForMultipleCompetitors(e),!(e.length<this.format.controlsOffset)){for(;(e.length-this.format.controlsOffset)%this.format.step!=0;)e.push("");for(var s,n=e[this.format.name],r=e[this.format.club],i=e[this.format.courseName],t=a(e[this.format.startTime]),o=[0],l=this.format.controlsOffset+1;l<e.length;l+=this.format.step)o.push(a(e[l]));null!==this.format.finishTime&&(s=a(e[this.format.finishTime]),s=null===t||null===s?null:s-t,o.push(s)),1!==o.length?(s=this.classes.has(i)?this.classes.get(i).results.length+1:1,r=m(s,t,o,new h(n,r)),null!==this.format.placing&&r.completed()&&(e[this.format.placing].match(/^\d*$/)||r.setNonCompetitive()),r.hasAnyTimes()?this.hasAnyStarters=!0:r.setNonStarter(),this.addResultToCourse(r,i,e)):""!==n&&this.warnings.push("Competitor '"+n+"' on course '"+(""===i?"(unnamed)":i)+"' has no times recorded")}},s.prototype.createClassesAndCourses=function(){var r=[],i=d3.map();this.classes.entries().forEach(function(t){var e=t.key,s=t.value,n=new o(e,s.controls.length,s.results);r.push(n);t=s.controls.join(",");i.has(t)?i.get(t).classes.push(n):i.set(t,{name:e,classes:[n],length:s.length,climb:s.climb,controls:s.controls})});var s=[];return i.values().forEach(function(t){var e=new c(t.name,t.classes,t.length,t.climb,t.controls);t.classes.forEach(function(t){t.setCourse(e)}),s.push(e)}),{classes:r,courses:s}},s.prototype.parseEventData=function(t){this.warnings=[];var e=(t=r(t)).split(/\n/);e.length<2&&n("Data appears not to be in an alternative CSV format - too few lines");t=e[1];this.delimiter=this.determineDelimiter(t),null===this.delimiter&&n("Data appears not to be in an alternative CSV format - first data line has fewer than "+this.format.controlsOffset+" parts when separated by any recognised delimiter"),this.checkControlCodesAlphaNumeric(t);for(var s=1;s<e.length;s+=1)this.readDataRow(e[s]);t=this.createClassesAndCourses();return this.hasAnyStarters||n("Data appears not to be in an alternative CSV format - data apparently could be read but everyone was a non-starter"),new i(t.classes,t.courses,this.warnings)},SplitsBrowser.Input.AlternativeCSV={parseTripleColumnEventData:function(t){return new s(e).parseEventData(t)}}}(),function(){"use strict";var r=SplitsBrowser.throwInvalidData,m=SplitsBrowser.throwWrongFileFormat,o=SplitsBrowser.isNaNStrict,s=SplitsBrowser.parseTime,h=SplitsBrowser.Model.Result.fromOriginalCumTimes,T=SplitsBrowser.Model.Result.createTeamResult,c=SplitsBrowser.Model.Competitor,S=SplitsBrowser.Model.Team,p=SplitsBrowser.Model.CourseClass,f=SplitsBrowser.Model.Course,d=SplitsBrowser.Model.Event;function i(t){return void 0===t}var g=/^\d{4}/,t={isOfThisVersion:function(t){return 0<=t.indexOf("IOFdata.dtd")},checkVersion:function(t){var e=$("> IOFVersion",t);0===e.length?m("Could not find IOFVersion element"):i(e=e.attr("version"))?m("Version attribute missing from IOFVersion element"):"2.0.3"!==e&&m("Found unrecognised IOF XML data format '"+e+"'");t=t.attr("status");i(t)||"complete"===t.toLowerCase()||r("Only complete IOF data supported; snapshot and delta are not supported")},readClassName:function(t){return $("> ClassShortName",t).text()},readTeamName:function(t){return $("> TeamName",t).text()},readTeamMemberResults:function(t){return $("> PersonResult",t)},readCourseFromClass:function(t,e){var s=$("> ClassShortName",t).text(),n=$("> PersonResult > Result",t).first(),r=null;return 0<n.length&&(0<(n=(t=$("> CourseLength",n)).text()).length&&(r=parseFloat(n),isFinite(r)?i(t=t.attr("unit"))||"m"===t?r/=1e3:"km"===t||("ft"===t?r/=3280:(e.push("Course '"+s+"' gives its length in a unit '"+t+"', but this unit was not recognised"),r=null)):(e.push("Course '"+s+"' specifies a course length that was not understood: '"+n+"'"),r=null))),{id:null,name:s,length:r,climb:null,numberOfControls:null}},getCompetitorNameElement:function(t){return $("> Person > PersonName",t)},readClubName:function(t){var e=$("> Club > ShortName",t).text();return""===e?$("> Club > Name",t).text():e},readDateOfBirth:function(t){return $("> Person > BirthDate > Date",t).text()},readStartTime:function(t){t=$("> StartTime > Clock",t).text();return""===t?null:s(t)},readTotalTime:function(t){t=$("> Time",t).text();return""===t?null:s(t)},getStatus:function(t){t=$("> CompetitorStatus",t);return 1===t.length?t.attr("value"):""},StatusNonCompetitive:"NotCompeting",StatusNonStarter:"DidNotStart",StatusNonFinisher:"DidNotFinish",StatusDisqualified:"Disqualified",StatusOverMaxTime:"OverTime",isAdditional:function(){return!1},readSplitTime:function(t){var e=$("> ControlCode",t).text();""===e&&(e=$("> Control > ControlCode",t).text()),""===e&&r("Control code missing for control");t=$("> Time",t).text();return{code:e,time:""===t?null:s(t)}}},e=/^\d\d\d\d-?\d\d-?\d\dT?(\d\d):?(\d\d)(?::?(\d\d))?/,n={isOfThisVersion:function(t){return 0<=t.indexOf("http://www.orienteering.org/datastandard/3.0")},checkVersion:function(t){var e=t.attr("iofVersion");i(e)?m("Could not find IOF version number"):"3.0"!==e&&m("Found unrecognised IOF XML data format '"+e+"'");t=t.attr("status");i(t)||"complete"===t.toLowerCase()||r("Only complete IOF data supported; snapshot and delta are not supported")},readClassName:function(t){return $("> Class > Name",t).text()},readTeamName:function(t){return $("> Name",t).text()},readTeamMemberResults:function(t){return $("> TeamMemberResult",t)},readCourseFromClass:function(t,e){var s,n=$("> Course",t),r=$("> Id",n).text()||null,i=$("> Name",n).text(),t=$("> Length",n).text();""===t?s=null:(s=parseInt(t,10),o(s)?(e.push("Course '"+i+"' specifies a course length that was not understood: '"+t+"'"),s=null):s/=1e3);t=$("> NumberOfControls",n).text(),t=parseInt(t,10);o(t)&&(t=null);n=$("> Climb",n).text(),n=parseInt(n,10);return o(n)&&(n=null),{id:r,name:i,length:s,climb:n,numberOfControls:t}},getCompetitorNameElement:function(t){return $("> Person > Name",t)},readClubName:function(t){var e=$("> Organisation > ShortName",t).text();return""===e?$("> Organisation > Name",t).text():e},readDateOfBirth:function(t){t=$("> Person > BirthDate",t).text(),t=g.exec(t);return null===t?null:parseInt(t[0],10)},readStartTime:function(t){t=$("> StartTime",t).text(),t=e.exec(t);return null===t?null:60*parseInt(t[1],10)*60+60*parseInt(t[2],10)+(i(t[3])?0:parseInt(t[3],10))},readTime:function(t){t=parseFloat(t);return isFinite(t)?t:null},readTotalTime:function(t){t=$("> Time",t).text();return n.readTime(t)},getStatus:function(t){return $("> Status",t).text()},StatusNonCompetitive:"NotCompeting",StatusNonStarter:"DidNotStart",StatusNonFinisher:"DidNotFinish",StatusDisqualified:"Disqualified",StatusOverMaxTime:"OverTime",isAdditional:function(t){return"Additional"===t.attr("status")},readSplitTime:function(t){var e,s=$("> ControlCode",t).text();return""===s&&r("Control code missing for control"),{code:s,time:"Missing"===t.attr("status")||""===(e=$("> Time",t).text())?null:n.readTime(e)}}},C=[t,n];function w(t,e,s,n){var r=$(t),i=s.getCompetitorNameElement(r),o=(m=i,u=$("> Given",m).text(),m=$("> Family",m).text(),""===u?m:""===m?u:u+" "+m);if(""===o)return n.push("Could not find a name for a competitor"),null;var l=s.readClubName(r),a=s.readDateOfBirth(r),t=g.exec(a),i=null===t?null:parseInt(t[0],10),u=$("> Person",r).attr("sex"),m=$("Result",r);if(0===m.length)return n.push("Could not find any result information for competitor '"+o+"'"),null;a=s.readStartTime(m),t=s.readTotalTime(m),r=s.getStatus(m),n=$("> SplitTime",m).toArray().filter(function(t){return!s.isAdditional($(t))}).map(function(t){return s.readSplitTime($(t))}),m=n.map(function(t){return t.code}),n=n.map(function(t){return t.time});n.unshift(0),n.push(r===s.StatusNonStarter?null:t);l=new c(o,l);null!==i&&l.setYearOfBirth(i),"M"!==u&&"F"!==u||l.setGender(u);l=h(e,a,n,l);return"OK"===r&&null!==t&&0<=n.indexOf(null)?l.setOKDespiteMissingTimes():r===s.StatusNonCompetitive?l.setNonCompetitive():r===s.StatusNonStarter?l.setNonStarter():r===s.StatusNonFinisher?l.setNonFinisher():r===s.StatusDisqualified?l.disqualify():r===s.StatusOverMaxTime&&l.setOverMaxTime(),{result:l,controls:m}}function v(t,e,s){var n=$(t),r={name:null,results:[],teamSize:null,controls:[],course:null};r.course=e.readCourseFromClass(n,s);t=e.readClassName(n);""===t&&(t="<unnamed class>"),r.name=t,r.course.numbersOfControls=null;var i=$("> PersonResult",n),o=$("> TeamResult",n);if(0<i.length&&0<o.length)return s.push("Class '"+t+"' has a combination of relay teams and individual results"),null;if(0<i.length)for(var l=0;l<i.length;l+=1)!function(t,e,s,n,r){if(null!==(n=w(t,e,n,r))){var i=n.result,o=n.controls;0!==s.results.length||i.isNonStarter&&0===o.length||(s.controls=o,null===s.course.numberOfControls&&(s.course.numberOfControls=s.controls.length));var l=i.getAllOriginalCumulativeTimes().length-2,a=null;if(!i.isNonStarter||0!=l)if(l!==s.course.numberOfControls)a="Competitor '"+i.owner.name+"' in class '"+s.name+"' has an unexpected number of controls: expected "+s.course.numberOfControls+", actual "+l;else for(var u=0;u<l;u+=1)if(s.controls[u]!==o[u]){a="Competitor '"+i.owner.name+"' has an unexpected control code at control "+(u+1)+": expected '"+s.controls[u]+"', actual '"+o[u]+"'";break}null===a?s.results.push(i):r.push(a)}}(i[l],l+1,r,e,s);else{if(!(0<o.length))return s.push("Class '"+t+"' has no competitors"),null;for(var a=0;a<o.length;a+=1)!function(t,e,s,n,r){var i=n.readTeamName(t),o=n.readClubName(t),l=n.readTeamMemberResults(t);if(0!==l.length)if(0!==s.results.length||1!==l.length){for(var a=[],u=[],m=0;m<l.length;m+=1){var h=w(l[m],e,n,r);if(null===h)return;a.push(h.result),u.push(h.controls)}for(m=1;m<l.length;m+=1){var c=$("> Result > FinishTime",l[m-1]).text(),p=$("> Result > StartTime",l[m]).text();if(!a[m].isNonStarter&&c!==p)return r.push("In team "+(""===i?"(unnamed team)":i)+" in class '"+s.name+"', "+a[m-1].owner.name+" does not finish at the same time as "+a[m].owner.name+" starts")}t=u.map(function(t){return t.length});if(0===s.results.length&&(s.teamSize=a.length,null===s.course.numbersOfControls&&(s.course.numbersOfControls=t)),a.length!==s.teamSize)r.push("Team "+(""===i?"(unnamed team)":"'"+i+"'")+" in class '"+s.name+"' has an unexpected number of members: expected "+s.teamSize+" but was actually "+a.length);else{for(var f=null,o=T(e,a,new S(i,o)),d=0;d<a.length;d+=1){var g=s.course.numbersOfControls[d],C=a[d],v=C.getAllOriginalCumulativeTimes().length-2;if(v!==g){f="Competitor '"+C.owner.name+"' in team '"+i+"' in class '"+s.name+"' has an unexpected number of controls: expected "+g+", actual "+v;break}}null===f?s.results.push(o):r.push(f)}}else r.push("Ignoring team "+(""===i?"(unnamed team)":i)+" with only a single member");else r.push("Ignoring team "+(""===i?"(unnamed team)":i)+" with no members")}(o[a],a+1,r,e,s)}return null===r.course.id&&0<r.controls.length&&(r.course.id=r.controls.join(",")),r}SplitsBrowser.Input.IOFXml={parseEventData:function(t){var e,s,i=function(t){for(var e=0;e<C.length;e+=1){var s=C[e];if(s.isOfThisVersion(t))return s}m("Data apparently not of any recognised IOF XML format")}(t),n=function(t){var e;try{e=$.parseXML(t)}catch(t){r("XML data not well-formed")}return 0===$("> *",$(e)).length&&r("XML data not well-formed: "+t),e}(t);e=n,s=i,t=$("> *",e),"ResultList"!==(e=t.prop("tagName"))&&m("Root element of XML document does not have expected name 'ResultList', got '"+e+"'"),s.checkVersion(t),0===(n=$("> ResultList > ClassResult",$(n)).toArray()).length&&r("No class result elements found");var o=[],l=[],a=d3.map(),u=[];return n.forEach(function(t){var e,s,n,r=v(t,i,u);null!==r&&(e=r.course,t=null!==r.teams&&null!==r.course.numbersOfControls&&0<r.course.numbersOfControls.length?(n=r.course.numbersOfControls.reduce(function(t,e){return t+e},0)+r.teamSize-1,!(s=r.controls=null)):(n=r.controls.length,s=e.id+","+r.controls.join(","),!1),n=new p(r.name,n,r.results),t&&n.setIsTeamClass(r.course.numbersOfControls),o.push(n),null!==e.id&&null!==s&&a.has(s)?a.get(s).classes.push(n):(e.classes=[n],e.controls=r.controls,l.push(e),null!==e.id&&a.set(s,e)))}),n=l.map(function(t){var e=new f(t.name,t.classes,t.length,t.climb,t.controls);return t.classes.forEach(function(t){t.setCourse(e)}),e}),new d(o,n,u)}}}(),function(){"use strict";var n=[SplitsBrowser.Input.CSV.parseEventData,SplitsBrowser.Input.OE.parseEventData,SplitsBrowser.Input.Html.parseEventData,SplitsBrowser.Input.AlternativeCSV.parseTripleColumnEventData,SplitsBrowser.Input.IOFXml.parseEventData];SplitsBrowser.Input.parseEventData=function(t){for(var e=0;e<n.length;e+=1){var s=n[e];try{return s(t)}catch(t){if("WrongFileFormat"!==t.name)throw t}}return null}}();